
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>PHA Process Optimizer â€“ Pro v2</title>
<style>
  :root{
    --primary:#2563eb;--primary-dark:#1e40af;--secondary:#10b981;--danger:#ef4444;--warning:#f59e0b;
    --dark:#1f2937;--light:#f9fafb;--border:#e5e7eb;--radius:12px;--shadow:0 20px 25px -5px rgba(0,0,0,.1)
  }
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,system-ui,sans-serif;
       background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px;color:#111827;-webkit-text-size-adjust:100%}
  .container{max-width:1400px;margin:0 auto;background:#fff;border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
  .header{display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between;background:#111827;color:#fff;padding:18px}
  .header h1{font-size:20px;font-weight:700}
  .header-controls{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  select#language{padding:8px 12px;border-radius:6px;border:1px solid rgba(255,255,255,.35);background:rgba(255,255,255,.12);color:#fff}
  .view-toggle{display:flex;gap:8px;background:rgba(255,255,255,.12);padding:4px;border-radius:8px}
  .view-toggle button{border:0;background:transparent;color:#fff;padding:8px 14px;border-radius:6px;cursor:pointer;font-weight:600}
  .view-toggle button.active{background:var(--primary);box-shadow:0 2px 8px rgba(37,99,235,.3)}
  .main{padding:24px}
  .tabs{display:flex;gap:8px;border-bottom:2px solid var(--border);overflow-x:auto;padding-bottom:8px}
  .tab{border:0;background:transparent;padding:10px 16px;font-weight:600;color:#374151;border-bottom:3px solid transparent;cursor:pointer;white-space:nowrap}
  .tab.active{color:var(--primary);border-bottom-color:var(--primary)}
  .tabpage{display:none;animation:fade .25s}.tabpage.active{display:block}
  @keyframes fade{from{opacity:.0;transform:translateY(6px)} to{opacity:1;transform:none}}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px;margin:16px 0 24px}
  .group label{display:block;font-weight:700;margin:0 0 6px;color:#111827;font-size:14px}
  .group input,.group select,.group textarea{width:100%;padding:12px;border:2px solid var(--border);border-radius:8px;background:#fff;color:#212529;font-size:15px;transition:.2s}
  .group input:focus,.group select:focus,.group textarea:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(37,99,235,.15)}
  .group textarea{min-height:100px;resize:vertical}
  .hint{color:#6b7280;font-size:12px;margin-top:4px}
  .tablewrap{overflow:auto;border:1px solid var(--border);border-radius:8px}
  table{width:100%;border-collapse:collapse}
  th,td{padding:10px;border-bottom:1px solid var(--border);text-align:left}
  th{background:var(--light);position:sticky;top:0}
  tr:hover{background:#f5f7ff}
  .badge{display:inline-block;padding:4px 10px;border-radius:999px;font-weight:700;font-size:12px}
  .ok{background:#d1fae5;color:#065f46}.warn{background:#fee7c2;color:#92400e}.crit{background:#ffe1e1;color:#9b1c1c}
  .card{background:#f9fafb;border:1px solid var(--border);border-left:4px solid var(--warning);border-radius:10px;padding:16px;margin:12px 0}
  .photos{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:12px}
  .photo{position:relative;border-radius:8px;overflow:hidden;aspect-ratio:1;background:#eef2ff}
  .photo img{width:100%;height:100%;object-fit:cover}
  .photo button{position:absolute;top:6px;right:6px;width:28px;height:28px;border-radius:50%;border:0;background:var(--danger);color:#fff;font-weight:900;cursor:pointer}
  .btn{border:0;padding:12px 18px;border-radius:8px;font-weight:800;cursor:pointer}
  .btn.primary{background:var(--primary);color:#fff}.btn.secondary{background:#f3f4f6;border:2px solid var(--border)}
  .actions{display:flex;gap:12px;flex-wrap:wrap}
  .fab{position:fixed;right:18px;bottom:18px;width:56px;height:56px;border-radius:50%;border:0;background:var(--primary);color:#fff;font-size:22px;display:flex;align-items:center;justify-content:center;box-shadow:0 12px 25px rgba(37,99,235,.35);cursor:pointer}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  .row .group{flex:1 1 220px}
  .muted{color:#6b7280}
  @media (max-width:768px){body{padding:0}.container{border-radius:0}.main{padding:16px}.group input,.group select,.group textarea{font-size:16px;min-height:44px}}
  /* Flash Control Guide Styles */
  .flash-tabs{display:flex;flex-wrap:wrap;gap:8px;border-bottom:2px solid #dee2e6;padding-bottom:8px;margin:16px 0}
  .flash-tab{border:0;background:#f8f9fa;padding:8px 12px;font-weight:600;color:#495057;border-radius:6px 6px 0 0;cursor:pointer;white-space:nowrap;transition:.2s;font-size:14px}
  .flash-tab.active{background:linear-gradient(135deg,#1e3c72,#2a5298);color:#fff}
  .flash-tab:hover:not(.active){background:#e9ecef}
  .flash-content{display:none;animation:fade .25s}.flash-content.active{display:block}
  .machine-screen{background:linear-gradient(to bottom,#1a1a1a,#0d0d0d);border-radius:10px;padding:25px;margin:25px 0;box-shadow:0 8px 25px rgba(0,0,0,.5);border:4px solid #333}
  .screen-header{background:linear-gradient(to right,#2d2d2d,#1a1a1a);color:#00ff00;padding:12px 20px;border-radius:5px;margin-bottom:20px;font-family:'Courier New',monospace;font-size:1.2em;font-weight:bold;border:2px solid #00ff00;box-shadow:0 0 15px rgba(0,255,0,.3);display:flex;justify-content:space-between;align-items:center}
  .screen-time{font-size:.9em;opacity:.8}
  .parameter-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:15px;margin-top:20px}
  .parameter{background:#2d2d2d;padding:18px;border-radius:8px;border:2px solid #444;transition:all .3s}
  .parameter:hover{border-color:#00ff00;box-shadow:0 0 10px rgba(0,255,0,.2)}
  .parameter-label{color:#00bfff;font-size:.9em;margin-bottom:8px;font-weight:bold;text-transform:uppercase;letter-spacing:.5px}
  .parameter-value{color:#fff;font-size:1.4em;font-weight:bold;font-family:'Courier New',monospace;margin-bottom:5px}
  .parameter-unit{color:#ffaa00;font-size:.85em;margin-left:5px}
  .parameter-note{color:#999;font-size:.8em;margin-top:5px;font-style:italic}
  .stage-indicator{background:#1a1a1a;border:2px solid #ffaa00;border-radius:8px;padding:15px;margin:20px 0;color:#ffaa00;font-weight:bold}
  .process-flow{display:flex;flex-direction:column;gap:15px;margin:20px 0}
  .flow-step{display:flex;align-items:center;background:white;padding:20px;border-radius:8px;border-left:5px solid #1e3c72;box-shadow:0 2px 8px rgba(0,0,0,.1);transition:transform .3s}
  .flow-step:hover{transform:translateX(10px);box-shadow:0 4px 12px rgba(0,0,0,.15)}
  .flow-number{background:linear-gradient(135deg,#1e3c72,#2a5298);color:white;width:50px;height:50px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.5em;font-weight:bold;margin-right:20px;flex-shrink:0}
  .flow-content{flex:1}
  .flow-title{font-size:1.2em;font-weight:bold;color:#1e3c72;margin-bottom:8px}
  .flow-description{color:#666;line-height:1.6}
  .checklist{background:#f8f9fa;padding:20px;border-radius:8px;margin:20px 0}
  .checklist-item{display:flex;align-items:flex-start;padding:12px;margin:8px 0;background:white;border-radius:5px;border:1px solid #dee2e6;transition:all .3s}
  .checklist-item:hover{border-color:#1e3c72;box-shadow:0 2px 8px rgba(30,60,114,.1)}
  .checklist-checkbox{width:24px;height:24px;margin-right:15px;cursor:pointer;flex-shrink:0}
  .checklist-text{flex:1;line-height:1.6}
  .diagram{background:white;padding:30px;border-radius:10px;margin:20px 0;border:2px solid #dee2e6}
  .diagram svg{width:100%;height:auto}
  .print-button{background:#28a745;color:white;padding:12px 25px;border:none;border-radius:5px;font-size:1em;font-weight:bold;cursor:pointer;margin:10px 5px;transition:background .3s}
  .print-button:hover{background:#218838}
  .success-box{background:linear-gradient(135deg,#11998e,#38ef7d);color:white;padding:20px;border-radius:8px;margin:20px 0;border-left:5px solid #099268}
  .success-box h3{margin-bottom:10px;font-size:1.3em}
  .emphasis{color:#1e3c72;font-weight:bold}
  .calculator{background:#f8f9fa;padding:25px;border-radius:10px;margin:20px 0;border:2px solid #dee2e6}
  .calc-input-group{margin:15px 0}
  .calc-input-group label{display:block;font-weight:bold;margin-bottom:8px;color:#495057}
  .calc-input-group input{width:100%;padding:12px;border:2px solid #ced4da;border-radius:5px;font-size:1em;transition:border-color .3s;color:#212529;background:#fff}
  .calc-input-group input:focus{outline:none;border-color:#1e3c72}
  .calc-button{background:linear-gradient(135deg,#1e3c72,#2a5298);color:white;padding:12px 30px;border:none;border-radius:5px;font-size:1.1em;font-weight:bold;cursor:pointer;transition:transform .2s;margin:10px 5px}
  .calc-button:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(30,60,114,.3)}
  .calc-result{background:white;padding:20px;border-radius:8px;margin-top:20px;border:2px solid #1e3c72}
  .calc-result h4{color:#1e3c72;margin-bottom:10px}
  .calc-result-value{font-size:1.8em;font-weight:bold;color:#2a5298;margin:10px 0}
  .formula{background:#f0f0f0;padding:15px;border-radius:5px;margin:15px 0;font-family:'Courier New',monospace;font-size:1.1em;border-left:4px solid #1e3c72}
  /* Process Log Styles */
  .log-container{background:#f8f9fa;padding:20px;border-radius:10px;margin:20px 0}
  .log-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:10px}
  .log-table{width:100%;border-collapse:collapse;background:white;border-radius:8px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,.1)}
  .log-table thead{background:linear-gradient(135deg,#1e3c72,#2a5298);color:white}
  .log-table th{padding:12px 8px;text-align:center;font-weight:bold;font-size:.9em;border-right:1px solid rgba(255,255,255,.2)}
  .log-table th:last-child{border-right:none}
  .log-table td{padding:8px 4px;text-align:center;border-bottom:1px solid #dee2e6;border-right:1px solid #dee2e6;color:#212529}
  .log-table td:last-child{border-right:none}
  .log-table tbody tr:hover{background:#f8f9fa}
  .log-table tbody tr:nth-child(even){background:#f9fafb}
  .number-input-group{display:flex;align-items:center;justify-content:center;gap:4px;min-width:100px}
  .number-input-group input{width:70px;padding:8px 4px;border:2px solid #ced4da;border-radius:4px;text-align:center;font-size:14px;-moz-appearance:textfield;color:#212529;background:#fff}
  .number-input-group input::-webkit-outer-spin-button,.number-input-group input::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}
  .number-input-group input:focus{outline:none;border-color:#1e3c72;box-shadow:0 0 0 2px rgba(30,60,114,.1)}
  .btn-increment{width:28px;height:28px;border:none;background:linear-gradient(135deg,#2a5298,#1e3c72);color:white;border-radius:4px;cursor:pointer;font-weight:bold;font-size:16px;display:flex;align-items:center;justify-content:center;transition:all .2s}
  .btn-increment:hover{transform:scale(1.1);box-shadow:0 2px 8px rgba(30,60,114,.3)}
  .btn-increment:active{transform:scale(.95)}
  .log-note-input{width:100%;padding:8px;border:2px solid #ced4da;border-radius:4px;font-size:13px;resize:vertical;min-height:40px;color:#212529;background:#fff}
  .log-note-input:focus{outline:none;border-color:#1e3c72;box-shadow:0 0 0 2px rgba(30,60,114,.1)}
  .btn-log-action{padding:10px 20px;border:none;border-radius:5px;font-weight:bold;cursor:pointer;transition:all .2s;font-size:14px}
  .btn-add-log{background:linear-gradient(135deg,#11998e,#38ef7d);color:white}
  .btn-add-log:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(17,153,142,.3)}
  .btn-delete-log{background:#ef4444;color:white;padding:6px 12px;font-size:12px;border-radius:4px}
  .btn-delete-log:hover{background:#dc2626}
  .btn-export-log{background:#f59e0b;color:white}
  .btn-export-log:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(245,158,11,.3)}
  .btn-clear-log{background:#6b7280;color:white}
  .btn-clear-log:hover{background:#4b5563}
  .log-empty{text-align:center;padding:40px;color:#6b7280;font-style:italic}
  .log-timestamp{color:#6b7280;font-size:12px;font-style:italic}
  /* Search/Filter Styles */
  .filter-container{background:white;padding:15px;border-radius:8px;margin-bottom:20px;box-shadow:0 2px 8px rgba(0,0,0,.1)}
  .filter-row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .filter-input{flex:1;min-width:200px;padding:10px;border:2px solid #ced4da;border-radius:5px;font-size:14px;color:#212529;background:#fff}
  .filter-input:focus{outline:none;border-color:#1e3c72;box-shadow:0 0 0 2px rgba(30,60,114,.1)}
  .btn-filter{padding:10px 20px;background:#1e3c72;color:white;border:none;border-radius:5px;cursor:pointer;font-weight:bold}
  .btn-filter:hover{background:#2a5298}
  /* Template Styles */
  .template-container{background:#f0f7ff;padding:15px;border-radius:8px;margin-bottom:20px;border-left:4px solid #1e3c72}
  .template-buttons{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  .btn-template{padding:8px 16px;background:#3b82f6;color:white;border:none;border-radius:5px;cursor:pointer;font-size:13px;font-weight:600}
  .btn-template:hover{background:#2563eb}
  .btn-template.load{background:#10b981}
  .btn-template.load:hover{background:#059669}
  .btn-template.delete{background:#ef4444}
  .btn-template.delete:hover{background:#dc2626}
  /* Photo Attachment Styles */
  .photo-upload-area{background:#f9fafb;border:2px dashed #cbd5e1;border-radius:8px;padding:20px;text-align:center;cursor:pointer;transition:all .3s;margin:10px 0}
  .photo-upload-area:hover{border-color:#1e3c72;background:#f0f7ff}
  .photo-upload-area.dragover{border-color:#1e3c72;background:#e0f2fe;transform:scale(1.02)}
  .photo-preview-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:10px;margin-top:10px}
  .photo-preview-item{position:relative;aspect-ratio:1;border-radius:8px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,.1)}
  .photo-preview-item img{width:100%;height:100%;object-fit:cover}
  .photo-remove-btn{position:absolute;top:4px;right:4px;width:24px;height:24px;background:#ef4444;color:white;border:none;border-radius:50%;cursor:pointer;font-size:16px;line-height:1;font-weight:bold}
  .photo-remove-btn:hover{background:#dc2626}
  /* Calculator/Recommendation Styles */
  .calc-recommendation{background:linear-gradient(135deg,#fef3c7,#fde68a);padding:20px;border-radius:10px;margin:20px 0;border-left:5px solid #f59e0b;box-shadow:0 4px 12px rgba(245,158,11,.2)}
  .calc-recommendation h4{color:#92400e;margin-bottom:15px;font-size:1.2em}
  .recommendation-item{background:white;padding:15px;border-radius:8px;margin:10px 0;border-left:4px solid #10b981}
  .recommendation-item.warning{border-left-color:#ef4444}
  .recommendation-item.caution{border-left-color:#f59e0b}
  .weight-calc-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin:15px 0}
  .weight-input-box{background:white;padding:15px;border-radius:8px;border:2px solid #dee2e6}
  .weight-input-box label{display:block;font-weight:bold;margin-bottom:8px;color:#495057;font-size:14px}
  .weight-input-box input{width:100%;padding:10px;border:2px solid #ced4da;border-radius:5px;font-size:14px;color:#212529;background:#fff}
  .weight-input-box input:focus{outline:none;border-color:#1e3c72}
  .density-display{background:linear-gradient(135deg,#e0f2fe,#bae6fd);padding:15px;border-radius:8px;text-align:center;font-size:18px;font-weight:bold;color:#0c4a6e}
  /* Chart Container Styles */
  .chart-container{background:white;padding:20px;border-radius:10px;margin:20px 0;box-shadow:0 2px 8px rgba(0,0,0,.1)}
  .chart-controls{display:flex;gap:10px;margin-bottom:15px;flex-wrap:wrap}
  .chart-toggle-btn{padding:8px 16px;border:2px solid #1e3c72;background:white;color:#1e3c72;border-radius:5px;cursor:pointer;font-weight:600;transition:all .2s}
  .chart-toggle-btn.active{background:#1e3c72;color:white}
  .chart-toggle-btn:hover:not(.active){background:#f0f7ff}
  @media (max-width:768px){
    .log-table{font-size:12px}
    .log-table th,.log-table td{padding:6px 3px}
    .number-input-group{min-width:80px;gap:2px}
    .number-input-group input{width:50px;font-size:12px;padding:6px 2px}
    .btn-increment{width:24px;height:24px;font-size:14px}
    .log-note-input{font-size:12px;min-height:35px}
    .btn-log-action{padding:8px 16px;font-size:13px}
    .log-header{flex-direction:column;align-items:stretch}
  }
</style>
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#2563eb">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<link rel="apple-touch-icon" href="icons/icon-192.png">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>ğŸ”¬ <span data-i18n="title">PHA Process Optimizer</span></h1>
    <div class="header-controls">
      <select id="language"><option value="ko">í•œêµ­ì–´</option><option value="en">English</option></select>
      <div class="view-toggle"><button id="btnDesktop" class="active" onclick="setView('desktop')">PC</button><button id="btnMobile" onclick="setView('mobile')">ğŸ“±</button></div>
    </div>
  </div>

  <div class="main">
    <div class="tabs">
      <button class="tab active" data-tab="proc" data-i18n="tab_proc">ê³µì • ì¡°ê±´</button>
      <button class="tab" data-tab="ts" data-i18n="tab_ts">íŠ¸ëŸ¬ë¸”ìŠˆíŒ…</button>
      <button class="tab" data-tab="hist" data-i18n="tab_hist">ì´ë ¥ ê´€ë¦¬</button>
      <button class="tab" data-tab="ana" data-i18n="tab_ana">ë°ì´í„° ë¶„ì„</button>
      <button class="tab" data-tab="calc" data-i18n="tab_calc">ê³„ì‚°ê¸°</button>
      <button class="tab" data-tab="props" data-i18n="tab_props">ë¬¼ì„± DB</button>
      <button class="tab" data-tab="photos" data-i18n="tab_photos">ì‚¬ì§„</button>
      <button class="tab" data-tab="flash" data-i18n="tab_flash">í”Œë˜ì‹œ ì œì–´</button>
    </div>

    <!-- Process Conditions -->
    <section id="proc" class="tabpage active">
      <div class="grid">
        <div class="group">
          <label data-i18n="series">ìƒ˜í”Œ ì‹œë¦¬ì¦ˆ</label>
          <select id="grade" onchange="rebuildForm()"></select>
        </div>
        <div class="group">
          <label data-i18n="process">ê°€ê³µ ìœ í˜•</label>
          <select id="process" onchange="rebuildForm()">
            <option value="sheet">ì‹œíŠ¸ ì••ì¶œ (Sheet)</option>
            <option value="extrusion">í”„ë¡œíŒŒì¼/ì¼ë°˜ ì••ì¶œ (Extrusion)</option>
            <option value="injection">ì‚¬ì¶œ ì„±í˜• (Injection)</option>
            <option value="blownfilm">ë¸”ë¡œìš´ í•„ë¦„ (Blown Film)</option>
            <option value="blowmolding">ë¸”ë¡œìš° ëª°ë”© (Blow Molding)</option>
            <option value="castfilm">ìºìŠ¤íŠ¸ í•„ë¦„ (Cast Film)</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div class="group">
          <button class="btn secondary" onclick="openRecoEditor()">ğŸ›  ê¶Œì¥ ê°€ì´ë“œ ìˆ˜ì •</button>
          <div class="hint">í˜„ì¬ ì„ íƒí•œ <b>í”„ë¡œíŒŒì¼Ã—ê³µì •</b>ì— í•œí•´ min/maxë¥¼ í¸ì§‘í•©ë‹ˆë‹¤. â€˜ì´ˆê¸°í™”â€™ë¡œ ì›ë³µ ê°€ëŠ¥.</div>
        </div>
      </div>

      <div id="dynamicFields" class="grid"></div>

      <div class="group">
        <label data-i18n="notes">ğŸ“ íŠ¹ì´ì‚¬í•­ ë©”ëª¨</label>
        <textarea id="notes" placeholder=""></textarea>
        <div class="hint" id="tsHint"></div>
      </div>

      <div class="row">
        <input id="importCSV" type="file" accept=".csv" style="display:none" />
        <input id="importJSON" type="file" accept=".json,application/json" style="display:none" />
        <button class="btn primary" onclick="saveEntry()" data-i18n="save">ì €ì¥ ë° ë¶„ì„</button>
        <button class="btn secondary" onclick="exportHistory()" data-i18n="export">ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
        <button class="btn secondary" onclick="triggerImport('csv')">CSV ê°€ì ¸ì˜¤ê¸°</button>
        <button class="btn secondary" onclick="triggerImport('json')">JSON ê°€ì ¸ì˜¤ê¸°</button>
        <button class="btn secondary" onclick="resetForm()" data-i18n="reset">ì´ˆê¸°í™”</button>
      </div>

      <div class="tablewrap" style="margin-top:18px">
        <table>
          <thead><tr>
            <th data-i18n="param">íŒŒë¼ë¯¸í„°</th><th data-i18n="current">í˜„ì¬ê°’</th>
            <th data-i18n="range">ê¶Œì¥ ë²”ìœ„</th><th data-i18n="status">ìƒíƒœ</th>
          </tr></thead>
          <tbody id="paramTable"></tbody>
        </table>
      </div>
    </section>

    <!-- Troubleshooting -->
    <section id="ts" class="tabpage">
      <div id="tsContainer"></div>
    </section>

    <!-- History -->
    <section id="hist" class="tabpage">
      <div class="tablewrap">
        <table>
          <thead><tr>
            <th data-i18n="when">ë‚ ì§œ/ì‹œê°„</th><th data-i18n="h_grade">ìƒ˜í”Œ</th><th data-i18n="h_proc">ê³µì •</th>
            <th data-i18n="h_key">ì£¼ìš” íŒŒë¼ë¯¸í„°</th><th data-i18n="h_result">ê²°ê³¼</th><th data-i18n="h_note">ë©”ëª¨</th>
          </tr></thead>
          <tbody id="histBody"></tbody>
        </table>
      </div>
    </section>

    <!-- Analysis -->
    <section id="ana" class="tabpage" style="text-align:center">
      <div style="margin:24px 0"><h3>ğŸ“Š <span data-i18n="ana_head">ë°ì´í„° ë¶„ì„</span></h3></div>
      <div class="card" id="anaCard"><div id="anaText" class="hint">ë¶„ì„ ë°ì´í„° ë¡œë”© ì¤‘...</div></div>
    </section>

    <!-- Calculators -->
    <section id="calc" class="tabpage">
      <h3 style="margin:8px 0">ğŸ§® ê³µì • KPI ê³„ì‚°ê¸°</h3>
      <div class="card">
        <h4>â‘  ì²´ë¥˜ì‹œê°„ (Residence Time)</h4>
        <div class="row">
          <div class="group"><label>ì¬ë£Œ ë°€ë„ (ìš©ìœµ, kg/mÂ³)</label><input id="kpi_rho" type="number" placeholder="900~1250"></div>
          <div class="group"><label>í™€ë“œì—… ìš©ì  (L)</label><input id="kpi_holdVol" type="number" placeholder="ì˜ˆ: 2.5"></div>
          <div class="group"><label>í™€ë“œì—… ì§ˆëŸ‰ (kg)</label><input id="kpi_holdMass" type="number" placeholder="ë¯¸ì…ë ¥ ì‹œ ë°€ë„Ã—ìš©ì ìœ¼ë¡œ ê³„ì‚°"></div>
          <div class="group"><label>ìŠ¤ë£¨í’‹ (kg/h)</label><input id="kpi_rate" type="number" placeholder="ì˜ˆ: 15"></div>
        </div>
        <div class="hint">â€» í™€ë“œì—… ì§ˆëŸ‰ ë¯¸ì…ë ¥ ì‹œ <b>ì§ˆëŸ‰ = ë°€ë„Ã—ìš©ì /1000</b>ë¡œ ì¶”ì •.</div>
        <div class="row"><div class="group"><button class="btn primary" onclick="calcResidence()">ê³„ì‚°</button></div><div class="group"><div id="kpi_res_out" class="muted">ê²°ê³¼: -</div></div></div>
      </div>

      <div class="card">
        <h4>â‘¡ ì‚¬ì¶œí’ˆ ëƒ‰ê°ì‹œê°„ ì˜ˆì¸¡</h4>
        <div class="row">
          <div class="group"><label>ë‘ê»˜ t (mm)</label><input id="cool_t" type="number" placeholder="ì˜ˆ: 2.0"></div>
          <div class="group"><label>ì—´í™•ì‚°ìœ¨ Î± (mmÂ²/s)</label><input id="cool_alpha" type="number" placeholder="ì˜ˆ: 0.12"></div>
          <div class="group"><label>ìš©ìœµì˜¨ë„ Tm (Â°C)</label><input id="cool_Tm" type="number" placeholder="ì˜ˆ: 170"></div>
          <div class="group"><label>ê¸ˆí˜•ì˜¨ë„ Tmold (Â°C)</label><input id="cool_Tmold" type="number" placeholder="ì˜ˆ: 30"></div>
          <div class="group"><label>ì´ì ì˜¨ë„ Teject (Â°C)</label><input id="cool_Te" type="number" placeholder="ì˜ˆ: 60"></div>
        </div>
        <div class="hint">ëª¨ë¸: 1D í‰íŒ ëƒ‰ê° ê·¼ì‚¬ì¹˜ <code>t_c â‰ˆ (tÂ²/(Ï€Â²Î±))Â·ln[(T_mâˆ’T_mold)/(T_eâˆ’T_mold)]</code></div>
        <div class="row"><div class="group"><button class="btn primary" onclick="calcCooling()">ê³„ì‚°</button></div><div class="group"><div id="cool_out" class="muted">ê²°ê³¼: -</div></div></div>
      </div>

      <div class="card">
        <h4>â‘¢ ë¸”ë¡œìš´ í•„ë¦„ ë‘ê»˜</h4>
        <div class="row">
          <div class="group"><label>í† ì¶œëŸ‰ Q (kg/h)</label><input id="bf_Q" type="number" placeholder="ì˜ˆ: 20"></div>
          <div class="group"><label>ìš©ìœµ ë°€ë„ Ï (kg/mÂ³)</label><input id="bf_rho" type="number" placeholder="ì˜ˆ: 950"></div>
          <div class="group"><label>ê¸ˆí˜• ì§ê²½ D_die (mm)</label><input id="bf_D" type="number" placeholder="ì˜ˆ: 80"></div>
          <div class="group"><label>BUR</label><input id="bf_BUR" type="number" step="0.1" placeholder="ì˜ˆ: 2.5"></div>
          <div class="group"><label>í…Œì´í¬ì—… ì†ë„ v (m/min)</label><input id="bf_v" type="number" placeholder="ì˜ˆ: 30"></div>
          <div class="group"><label>ë‹¤ì´ ê°­ g (mm, ì„ íƒ)</label><input id="bf_gap" type="number" placeholder="ì˜ˆ: 1.0"></div>
        </div>
        <div class="hint">ê¸°ë³¸ì‹: <code>t â‰ˆ (Q/Ï) / (Ï€Â·D_dieÂ·BURÂ·v)</code> (Âµm ë³€í™˜ í¬í•¨). ì„ íƒì ìœ¼ë¡œ ê°­ ê¸°ë°˜ <code>t0=g/2</code>, <code>DDR=v / v_exit</code> ì‚¬ìš©.</div>
        <div class="row"><div class="group"><button class="btn primary" onclick="calcBlownFilm()">ê³„ì‚°</button></div><div class="group"><div id="bf_out" class="muted">ê²°ê³¼: -</div></div></div>
      </div>
    </section>

    <!-- Materials DB -->
    <section id="props" class="tabpage">
      <div class="row">
        <div class="group">
          <label>Grade</label>
          <select id="mat_grade"></select>
        </div>
        <div class="group">
          <label>ë™ì‘</label>
          <div class="row">
            <button class="btn secondary" onclick="importMatJSON()">JSON ê°€ì ¸ì˜¤ê¸°</button>
            <button class="btn secondary" onclick="exportMatJSON()">JSON ë‚´ë³´ë‚´ê¸°</button>
            <button class="btn secondary" onclick="editMat()">í¸ì§‘</button>
          </div>
        </div>
      </div>
      <div class="tablewrap">
        <table>
          <thead><tr><th>í•­ëª©</th><th>ê°’</th><th>ë‹¨ìœ„/ì¡°ê±´</th></tr></thead>
          <tbody id="mat_tbody"></tbody>
        </table>
      </div>
      <div class="hint">â€» ì›¹ì—ì„œ ì§ì ‘ TDS URLì„ ë¶ˆëŸ¬ì˜¤ë ¤ë©´ CORS ì œì•½ì´ ìˆì–´, ê°„ë‹¨í•œ ë¡œì»¬ ì„œë²„ ì‚¬ìš© ë˜ëŠ” JSON ì—…ë¡œë“œ ë°©ì‹ ê¶Œì¥.</div>
      <input id="mat_file" type="file" accept="application/json,.json" style="display:none">
    </section>

    <!-- Photos Tab -->
    <section id="photos" class="tabpage">
      <h3 style="margin:8px 0">ğŸ“· <span data-i18n="photos_head">Photo Manager</span></h3>
      <div class="group">
        <button class="btn primary" onclick="triggerPhotoUpload()">ì‚¬ì§„ ì—…ë¡œë“œ</button>
        <input id="photoUpload" type="file" accept="image/*" multiple style="display:none">
      </div>
      <div id="photoGrid" class="photos"></div>
    </section>

    <!-- Flash Control Tab -->
    <section id="flash" class="tabpage">
      <h2 style="color:#1e3c72;margin-bottom:20px">ğŸ”§ PHA 36-ìºë¹„í‹° í”Œë˜ì‹œ ì œì–´ í˜„ì¥ ê°€ì´ë“œ</h2>
      <p style="font-size:1.1em;color:#666;margin-bottom:20px">ì••ë ¥-ë™ê¸°í˜• 4ë‹¨ ì œì–´ + ëŸ¬ë„ˆ ë³´í˜¸ í†µí•© ì†”ë£¨ì…˜ (P3HB4: S1000P/A1000P | 36-ìºë¹„í‹° | í”Œë˜ì‹œ â‰¤0.02mm)</p>

      <!-- Flash Control Sub-tabs -->
      <div class="flash-tabs">
        <button class="flash-tab active" onclick="showFlashTab(0)">ğŸ“‹ ì „ì²´ ê°œìš”</button>
        <button class="flash-tab" onclick="showFlashTab(1)">âš™ï¸ ê¸°ê³„ ì„¤ì •</button>
        <button class="flash-tab" onclick="showFlashTab(2)">ğŸ§® ê³„ì‚°ê¸°</button>
        <button class="flash-tab" onclick="showFlashTab(3)">ğŸ“Š í”„ë¡œì„¸ìŠ¤ í”Œë¡œìš°</button>
        <button class="flash-tab" onclick="showFlashTab(4)">âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸</button>
        <button class="flash-tab" onclick="showFlashTab(5)">ğŸ”§ ë¬¸ì œ í•´ê²°</button>
        <button class="flash-tab" onclick="showFlashTab(6)">ğŸ“ ê³µì • ë¡œê·¸</button>
        <button class="flash-tab" onclick="showFlashTab(7)">ğŸ“– ì‚¬ìš© ì„¤ëª…ì„œ</button>
      </div>

      <!-- Flash Tab 0: Overview -->
      <div class="flash-content active" id="flash-tab-0">
        <h3 style="color:#1e3c72;margin-bottom:20px">ì œì–´ ì „ëµ í•µì‹¬ ê°œìš”</h3>

        <div class="success-box">
          <h3>ğŸ¯ ì œì–´ ì›ì¹™</h3>
          <p><strong>"ëŸ¬ë„ˆê°€ ëŒ€ë¶€ë¶„ ì°° ë•Œê¹Œì§€ëŠ” ì••ë ¥ ì œí•œìœ¼ë¡œ ë³´í˜¸í•˜ê³ , ìºë¹„í‹° ì¶©ì „ ì´í›„ëŠ” ìºë¹„í‹°ì•• ê¸°ë°˜ìœ¼ë¡œ ë‹¬ë¦°ë‹¤"</strong></p>
          <p>í”Œë˜ì‹œì˜ ê·¼ë³¸ ì›ì¸ì€ ê¸ˆí˜• ì†ìƒ ë˜ëŠ” ìºë¹„í‹°ì••ì´ í´ë¨í”„ í•œê³„ë¥¼ ì´ˆê³¼í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ ì „ëµì€ ë‘ ê°€ì§€ ì›ì¸ì„ ëª¨ë‘ êµ¬ì¡°ì ìœ¼ë¡œ ì°¨ë‹¨í•©ë‹ˆë‹¤.</p>
        </div>

        <h3 style="color:#1e3c72;margin:30px 0 15px 0">4ë‹¨ ì œì–´ ë¡œì§</h3>

        <div class="process-flow">
          <div class="flow-step">
            <div class="flow-number">V0</div>
            <div class="flow-content">
              <div class="flow-title">Runner-Protect (ì••ë ¥ ì œí•œ ì†ë„ ì œì–´)</div>
              <div class="flow-description">
                ëŸ¬ë„ˆ ì²´ì ì˜ ì•½ 90%ê¹Œì§€ëŠ” <span class="emphasis">ì••ë ¥ ìƒí•œì„ ê±¸ì–´ ì¤‘ì†</span>ìœ¼ë¡œ ì±„ì›ë‹ˆë‹¤.
                ìƒí•œì€ í´ë¨í”„ ëŒ€ë¹„ 80% ì´ë‚´ë¡œ ì„¤ì •í•˜ì—¬ ìŠ¤í”„ë£¨ í”Œë˜ì‹œì™€ ì „ë‹¨ë°œì—´ì„ ì°¨ë‹¨í•©ë‹ˆë‹¤.
                ëŸ¬ë„ˆì—ì„œì˜ ê³¼ì „ë‹¨ê³¼ ì „ë‹¨ë°œì—´ì„ ê·¼ë³¸ì ìœ¼ë¡œ ì–µì œí•˜ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤.
              </div>
            </div>
          </div>

          <div class="flow-step">
            <div class="flow-number">V1</div>
            <div class="flow-content">
              <div class="flow-title">ìºë¹„í‹° ì¶©ì „ ê³ ì† (92-96%)</div>
              <div class="flow-description">
                ê²Œì´íŠ¸ ëŒì… ì´í›„ì—ëŠ” ì–‡ì€ë²½ ì¶©ì „ì„± í™•ë³´ë¥¼ ìœ„í•´ <span class="emphasis">ê³ ì†</span>ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
                ë‹¨, ë…¸ì¦/ì‚¬ì¶œì•• ìƒí•œì„ ì„¤ì •í•´ ì••ë ¥ í­ì£¼ë¥¼ ì–µì œí•©ë‹ˆë‹¤.
                v/p ì „í™˜ì€ ë§ˆì§€ë§‰ ì¶©ì „ ìºë¹„í‹°ì˜ ì••ë ¥ ê¸‰ìƒìŠ¹ì ì„ íŠ¸ë¦¬ê±°ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
              </div>
            </div>
          </div>

          <div class="flow-step">
            <div class="flow-number">V2</div>
            <div class="flow-content">
              <div class="flow-title">EoF ë¸Œë ˆì´í¬ (ì¢…ë‹¨ ê°ì†)</div>
              <div class="flow-description">
                ì¶©ì „ ë(End of Fill) 4-8mm êµ¬ê°„ì—ì„œ <span class="emphasis">ì„ í˜• ê°ì†</span>ìœ¼ë¡œ
                ì••ë ¥ ì˜¤ë²„ìŠˆíŠ¸ë¥¼ ì œê±°í•©ë‹ˆë‹¤. ê¸‰ê²©í•œ ì••ë ¥ ìƒìŠ¹ì„ ë°©ì§€í•˜ì—¬ í”Œë˜ì‹œ ë°œìƒ ìœ„í—˜ì„ ë‚®ì¶¥ë‹ˆë‹¤.
              </div>
            </div>
          </div>

          <div class="flow-step">
            <div class="flow-number">V3</div>
            <div class="flow-content">
              <div class="flow-title">ë³´ì•• ë¨í”„-ì¸/ì¡°ê¸° ì¢…ë£Œ</div>
              <div class="flow-description">
                ê²Œì´íŠ¸ ë™ê²° ì‹œì ì„ ì‚°ì •í•˜ê³  <span class="emphasis">P1(ì§§ê²Œ) â†’ P2(ë‚®ê²Œ)</span> 2ë‹¨ ë¨í”„ë¡œ ìœ ì§€í•œ ë’¤
                ë™ê²° ì§í›„ ì¦‰ì‹œ ì¢…ë£Œí•©ë‹ˆë‹¤. ë©€í‹° ìºë¹„í‹°ì˜ ë¹„ë™ì‹œ ë™ê²°ì— ëŒ€ì‘í•˜ê¸° ìœ„í•´
                ìµœì•… ê²½ë¡œ(ìµœí›„ ë™ê²° ìºë¹„í‹°) ê¸°ì¤€ìœ¼ë¡œ ë³´ì••ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.
              </div>
            </div>
          </div>
        </div>

        <h3 style="color:#1e3c72;margin:30px 0 15px 0">ë³´ì¡° ì œì–´ ìš”ì†Œ</h3>

        <table>
          <thead>
            <tr>
              <th>êµ¬ë¶„</th>
              <th>ì œì–´ ë°©ë²•</th>
              <th>ëª©ì </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>ëŸ¬ë„ˆ ì „ë‹¨ ê´€ë¦¬</strong></td>
              <td>ëŸ¬ë„ˆ R ì¦ëŒ€ ë˜ëŠ” V0 ì†ë„ í•˜í–¥</td>
              <td>ì „ë‹¨ë¥  ì–µì œë¡œ ì „ë‹¨ë°œì—´Â·ì ë„ë¶•ê´´ ë°©ì§€</td>
            </tr>
            <tr>
              <td><strong>ìŠ¤í”„ë£¨ êµ­ë¶€ ëƒ‰ê°</strong></td>
              <td>ìŠ¤í”„ë£¨/1ì°¨ ë¶„ê¸°ì— -2~-5Â°C ì €ì˜¨ ì¸ì„œíŠ¸</td>
              <td>íŒŒíŒ… ë¼ì¸ì— ì”°ë§ ìŠ¤í‚¨ ì¡°ê¸° í˜•ì„±</td>
            </tr>
            <tr>
              <td><strong>ê²Œì´íŠ¸ ë™ê²° ê· ì§ˆí™”</strong></td>
              <td>ê²Œì´íŠ¸ êµ¬ê²½ Â±0.02mm ë¯¸ì„¸ ì¡°ì •</td>
              <td>ë™ê²° ì‹œê°„ í¸ì°¨ â‰¤0.1së¡œ ê· ì§ˆí™”</td>
            </tr>
            <tr>
              <td><strong>ìš©ìœµ ì•ˆì •ì„±</strong></td>
              <td>ìµœì € ìš©ìœµì˜¨ë„, ì²´ë¥˜ì‹œê°„Â·rpmÂ·ë°±í”„ë ˆì…” ì €ê°</td>
              <td>PHA Î²-elimination ì—´ë¶„í•´ ì–µì œ, MW ë³´ì¡´</td>
            </tr>
            <tr>
              <td><strong>ê²°ì •í™” ê°€ì†</strong></td>
              <td>BNÂ·íƒˆí¬ 0.05-0.20 wt% ì €ë†ë„ ì²¨ê°€</td>
              <td>Tc ìƒìŠ¹Â·tÂ½ ë‹¨ì¶•ìœ¼ë¡œ ìŠ¤í‚¨ ì¡°ê¸° í˜•ì„±</td>
            </tr>
          </tbody>
        </table>

        <div class="warning-box">
          <h3>âš ï¸ PHA ì¬ë£Œ íŠ¹ì„± ì£¼ì˜ì‚¬í•­</h3>
          <p><strong>Î²-elimination ì—´ë¶„í•´:</strong> PHB ê³„ì—´ì€ ì•½ 190Â°C ì´ìƒì—ì„œ ê¸‰ì† ì—´ë¶„í•´ê°€ ë°œìƒí•˜ë©° ë¶„ìëŸ‰ì´ í•˜ë½í•©ë‹ˆë‹¤.
          ê°€ëŠ¥í•œ ìµœì € ìš©ìœµì˜¨ë„ë¡œ ê°€ê³µí•˜ê³  ì²´ë¥˜ì‹œê°„ì„ ìµœì†Œí™”í•´ì•¼ í•©ë‹ˆë‹¤.</p>
          <p><strong>ì¢ì€ ê°€ê³µì°½:</strong> ìœµì  ê·¼ì²˜ì—ì„œ ê°€ê³µí•´ì•¼ í•˜ë©° ê³¼ì—´ ì‹œ ê°€ìŠ¤ ë°œìƒê³¼ ì ë„ í•˜ë½ì´ ë™ë°˜ë©ë‹ˆë‹¤.</p>
          <p><strong>ëŠë¦° ê²°ì •í™”:</strong> ì¼ë°˜ PE/PP ëŒ€ë¹„ ê²°ì •í™” ì†ë„ê°€ ëŠë ¤ ê²Œì´íŠ¸ ë™ê²° ì‹œê°„ì´ ê¸¸ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        </div>
      </div>

      <!-- Flash Tab 1: Machine Settings -->
      <div class="flash-content" id="flash-tab-1">
        <h3 style="color:#1e3c72;margin-bottom:20px">ê¸°ê³„ ì„¤ì • í™”ë©´</h3>
        <button class="print-button" onclick="window.print()">ğŸ–¨ï¸ ì„¤ì •ê°’ ì¸ì‡„</button>

        <!-- V0 Stage -->
        <div class="machine-screen">
          <div class="screen-header">
            <span>V0 STAGE: RUNNER PROTECTION</span>
            <span class="screen-time">ëŸ¬ë„ˆ ë³´í˜¸ êµ¬ê°„</span>
          </div>
          <div class="stage-indicator">â–¶ ì„¤ì • ëª©ì : ëŸ¬ë„ˆ ì²´ì  90%ê¹Œì§€ ì••ë ¥ ì œí•œ ì¤‘ì† ì¶©ì „ - ìŠ¤í”„ë£¨ í”Œë˜ì‹œ ë°©ì§€</div>
          <div class="parameter-grid">
            <div class="parameter">
              <div class="parameter-label">Injection Velocity V0</div>
              <div class="parameter-value">30-50<span class="parameter-unit">mm/s</span></div>
              <div class="parameter-note">ì¤‘ì† ì„¤ì • (ëŸ¬ë„ˆ ì¶©ì „ìš©)</div>
            </div>
            <div class="parameter">
              <div class="parameter-label">Pressure Limit</div>
              <div class="parameter-value">0.8 Ã— F_clamp/A_proj<span class="parameter-unit">bar</span></div>
              <div class="parameter-note">í´ë¨í”„ í•œê³„ì˜ 80% ì´ë‚´</div>
            </div>
            <div class="parameter">
              <div class="parameter-label">Switchover Position</div>
              <div class="parameter-value">0.9 Ã— V_runner<span class="parameter-unit">mm</span></div>
              <div class="parameter-note">ëŸ¬ë„ˆ ì²´ì ì˜ 90% ì§€ì </div>
            </div>
            <div class="parameter">
              <div class="parameter-label">Shear Rate Control</div>
              <div class="parameter-value">Î³Ì‡ = 4Q/(Ï€RÂ³)<span class="parameter-unit">sâ»Â¹</span></div>
              <div class="parameter-note">ëŸ¬ë„ˆ ì „ë‹¨ë¥  ëª¨ë‹ˆí„°ë§</div>
            </div>
          </div>
        </div>

        <!-- V1 Stage -->
        <div class="machine-screen">
          <div class="screen-header">
            <span>V1 STAGE: HIGH-SPEED CAVITY FILL</span>
            <span class="screen-time">ìºë¹„í‹° ê³ ì† ì¶©ì „</span>
          </div>
          <div class="stage-indicator">â–¶ ì„¤ì • ëª©ì : ì–‡ì€ë²½ ì¶©ì „ì„± í™•ë³´ - ê²Œì´íŠ¸ ëŒì… í›„ ê³ ì† ì¶©ì „</div>
          <div class="parameter-grid">
            <div class="parameter">
              <div class="parameter-label">Injection Velocity V1</div>
              <div class="parameter-value">80-150<span class="parameter-unit">mm/s</span></div>
              <div class="parameter-note">ì–‡ì€ë²½ ì¶©ì „ìš© ê³ ì†</div>
            </div>
            <div class="parameter">
              <div class="parameter-label">Injection Pressure Limit</div>
              <div class="parameter-value">ì„¤ì • ìœ ì§€<span class="parameter-unit">bar</span></div>
              <div class="parameter-note">ì••ë ¥ í­ì£¼ ë°©ì§€</div>
            </div>
            <div class="parameter">
              <div class="parameter-label">Fill Range</div>
              <div class="parameter-value">92-96<span class="parameter-unit">%</span></div>
              <div class="parameter-note">V1 ì‘ë™ êµ¬ê°„</div>
            </div>
            <div class="parameter">
              <div class="parameter-label">Cavity Pressure Sensor</div>
              <div class="parameter-value">dP/dt Peak<span class="parameter-unit">ê°ì§€</span></div>
              <div class="parameter-note">ë§ˆì§€ë§‰ ì¶©ì „ ìºë¹„í‹° ê¸°ì¤€</div>
            </div>
          </div>
        </div>

        <!-- V2 Stage -->
        <div class="machine-screen">
          <div class="screen-header">
            <span>V2 STAGE: END-OF-FILL DECELERATION</span>
            <span class="screen-time">ì¶©ì „ ë ê°ì†</span>
          </div>
          <div class="stage-indicator">â–¶ ì„¤ì • ëª©ì : ì••ë ¥ ì˜¤ë²„ìŠˆíŠ¸ ì œê±° - EoF êµ¬ê°„ ì„ í˜• ê°ì†</div>
          <div class="parameter-grid">
            <div class="parameter">
              <div class="parameter-label">Injection Velocity V2</div>
              <div class="parameter-value">20-40<span class="parameter-unit">mm/s</span></div>
              <div class="parameter-note">ì„ í˜• ê°ì† ëª©í‘œ ì†ë„</div>
            </div>
            <div class="parameter">
              <div class="parameter-label">Deceleration Start Point</div>
              <div class="parameter-value">EoF -4~-8<span class="parameter-unit">mm</span></div>
              <div class="parameter-note">ì¶©ì „ ë 4-8mm ì „</div>
            </div>
            <div class="parameter">
              <div class="parameter-label">Ramp Type</div>
              <div class="parameter-value">Linear<span class="parameter-unit">Ramp-down</span></div>
              <div class="parameter-note">ì„ í˜• ê°ì† í”„ë¡œíŒŒì¼</div>
            </div>
            <div class="parameter">
              <div class="parameter-label">Pressure Monitoring</div>
              <div class="parameter-value">ì‹¤ì‹œê°„<span class="parameter-unit">ëª¨ë‹ˆí„°ë§</span></div>
              <div class="parameter-note">ì••ë ¥ ìŠ¤íŒŒì´í¬ ê°ì§€</div>
            </div>
          </div>
        </div>

        <!-- V3/Packing Stage -->
        <div class="machine-screen">
          <div class="screen-header">
            <span>V3 STAGE: PACKING PRESSURE CONTROL</span>
            <span class="screen-time">ë³´ì•• ì œì–´</span>
          </div>
          <div class="stage-indicator">â–¶ ì„¤ì • ëª©ì : ê²Œì´íŠ¸ ë™ê²°ê¹Œì§€ë§Œ ë³´ì•• ìœ ì§€ - ê³¼ë³´ì•• ë°©ì§€</div>
          <div class="parameter-grid">
            <div class="parameter">
              <div class="parameter-label">Packing Pressure P1</div>
              <div class="parameter-value">30-45% Ã— P_inj_peak<span class="parameter-unit">bar</span></div>
              <div class="parameter-note">1ë‹¨ ë³´ì•• (ì§§ê²Œ)</div>
            </div>
            <div class="parameter">
              <div class="parameter-label">Packing Time P1</div>
              <div class="parameter-value">0.1-0.3<span class="parameter-unit">s</span></div>
              <div class="parameter-note">1ë‹¨ ë³´ì•• ì‹œê°„</div>
            </div>
            <div class="parameter">
              <div class="parameter-label">Packing Pressure P2</div>
              <div class="parameter-value">15-30% Ã— P_inj_peak<span class="parameter-unit">bar</span></div>
              <div class="parameter-note">2ë‹¨ ë³´ì•• (ë‚®ê²Œ)</div>
            </div>
            <div class="parameter">
              <div class="parameter-label">Packing Time P2</div>
              <div class="parameter-value">ê²Œì´íŠ¸ ë™ê²°ê¹Œì§€<span class="parameter-unit">s</span></div>
              <div class="parameter-note">ì¤‘ëŸ‰-ì‹œê°„ ê³¡ì„ ìœ¼ë¡œ ê²°ì •</div>
            </div>
          </div>
          <div class="info-box">
            <h3>ğŸ“Œ ê²Œì´íŠ¸ ë™ê²°(Gate Seal) ì‹œí—˜ ë°©ë²•</h3>
            <p><strong>1ë‹¨ê³„:</strong> ë³´ì•• ì‹œê°„ì„ 0.5ì´ˆë¶€í„° ì‹œì‘í•˜ì—¬ 0.5ì´ˆì”© ì¦ê°€ì‹œí‚¤ë©´ì„œ ìƒ·ì„ ì§„í–‰í•©ë‹ˆë‹¤.</p>
            <p><strong>2ë‹¨ê³„:</strong> ê° ìƒ·ë§ˆë‹¤ ì œí’ˆ ë¬´ê²Œë¥¼ ì •ë°€í•˜ê²Œ ì¸¡ì •í•©ë‹ˆë‹¤.</p>
            <p><strong>3ë‹¨ê³„:</strong> ë¬´ê²Œê°€ ë” ì´ìƒ ì¦ê°€í•˜ì§€ ì•ŠëŠ” ì‹œì ì´ ê²Œì´íŠ¸ ë™ê²° ì‹œì ì…ë‹ˆë‹¤.</p>
            <p><strong>4ë‹¨ê³„:</strong> ìµœí›„ ë™ê²° ìºë¹„í‹° ê¸°ì¤€ìœ¼ë¡œ ë³´ì•• ì¢…ë£Œ ì‹œê°„ì„ ì„¤ì •í•©ë‹ˆë‹¤.</p>
          </div>
        </div>

        <!-- Temperature Control -->
        <div class="machine-screen">
          <div class="screen-header">
            <span>TEMPERATURE CONTROL</span>
            <span class="screen-time">ì˜¨ë„ ì œì–´</span>
          </div>
          <div class="stage-indicator">â–¶ ì„¤ì • ëª©ì : ìŠ¤í”„ë£¨ êµ­ë¶€ ëƒ‰ê° + ìš©ìœµ ì•ˆì •ì„± í™•ë³´</div>
          <div class="parameter-grid">
            <div class="parameter">
              <div class="parameter-label">Mold Temp (Cavity)</div>
              <div class="parameter-value">T_base<span class="parameter-unit">Â°C</span></div>
              <div class="parameter-note">ìºë¹„í‹° ê¸°ì¤€ ì˜¨ë„</div>
            </div>
            <div class="parameter">
              <div class="parameter-label">Mold Temp (Sprue/Parting)</div>
              <div class="parameter-value">T_base -2~-5<span class="parameter-unit">Â°C</span></div>
              <div class="parameter-note">ìŠ¤í”„ë£¨/íŒŒíŒ…ë¼ì¸ ì €ì˜¨ëŒ€</div>
            </div>
            <div class="parameter">
              <div class="parameter-label">Barrel Temp (Rear Zone)</div>
              <div class="parameter-value">ìµœì € ê°€ê³µì˜¨ë„<span class="parameter-unit">Â°C</span></div>
              <div class="parameter-note">PHA ì—´ë¶„í•´ ì–µì œ</div>
            </div>
            <div class="parameter">
              <div class="parameter-label">Material Drying</div>
              <div class="parameter-value">65-80Â°C, 6-24h<span class="parameter-unit"></span></div>
              <div class="parameter-note">ìˆ˜ë¶„ ì œê±° í•„ìˆ˜</div>
            </div>
            <div class="parameter">
              <div class="parameter-label">Residence Time</div>
              <div class="parameter-value">ìµœì†Œí™”<span class="parameter-unit">min</span></div>
              <div class="parameter-note">ì—´ë¶„í•´ ë°©ì§€</div>
            </div>
            <div class="parameter">
              <div class="parameter-label">Screw RPM</div>
              <div class="parameter-value">ì €ê°<span class="parameter-unit">rpm</span></div>
              <div class="parameter-note">ì „ë‹¨ë°œì—´ ì–µì œ</div>
            </div>
            <div class="parameter">
              <div class="parameter-label">Back Pressure</div>
              <div class="parameter-value">ìµœì†Œ<span class="parameter-unit">bar</span></div>
              <div class="parameter-note">ê³¼ë„í•œ ì „ë‹¨ ë°©ì§€</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Flash Tab 2: Calculator -->
      <div class="flash-content" id="flash-tab-2">
        <h3 style="color:#1e3c72;margin-bottom:20px">ì„¤ì •ê°’ ê³„ì‚°ê¸°</h3>

        <!-- Clamp Tonnage Calculator -->
        <div class="calculator">
          <h3 style="color:#1e3c72;margin-bottom:20px">1. í´ë¨í”„ í†¤ìˆ˜ ê³„ì‚°ê¸°</h3>
          <div class="calc-input-group">
            <label>ìºë¹„í‹° í‰ê·  ì••ë ¥ P_avg (bar):</label>
            <input type="number" id="flash-p-avg" placeholder="ì˜ˆ: 500" value="500">
          </div>
          <div class="calc-input-group">
            <label>ì œí’ˆ íˆ¬ì˜ ë©´ì  A_proj (cmÂ²):</label>
            <input type="number" id="flash-a-proj" placeholder="ì˜ˆ: 2000" value="2000">
          </div>
          <button class="calc-button" onclick="calculateFlashClampTonnage()">ê³„ì‚°í•˜ê¸°</button>
          <button class="calc-button" onclick="clearFlashInputs('clamp')">ì´ˆê¸°í™”</button>
          <div class="calc-result" id="flash-clamp-result" style="display:none;">
            <h4>ê³„ì‚° ê²°ê³¼</h4>
            <div class="calc-result-value" id="flash-clamp-value"></div>
            <p id="flash-clamp-recommendation"></p>
          </div>
        </div>

        <!-- Pressure Limit Calculator -->
        <div class="calculator">
          <h3 style="color:#1e3c72;margin-bottom:20px">2. V0 ì••ë ¥ ë¦¬ë°‹ ê³„ì‚°ê¸°</h3>
          <div class="calc-input-group">
            <label>í´ë¨í”„ í•œê³„ (ton-force):</label>
            <input type="number" id="flash-f-clamp" placeholder="ì˜ˆ: 1200" value="1200">
          </div>
          <div class="calc-input-group">
            <label>ì œí’ˆ íˆ¬ì˜ ë©´ì  A_proj (cmÂ²):</label>
            <input type="number" id="flash-a-proj-2" placeholder="ì˜ˆ: 2000" value="2000">
          </div>
          <div class="calc-input-group">
            <label>ì•ˆì „ ê³„ìˆ˜ (ê¶Œì¥: 0.8):</label>
            <input type="number" id="flash-safety-factor" placeholder="0.8" value="0.8" step="0.05">
          </div>
          <button class="calc-button" onclick="calculateFlashPressureLimit()">ê³„ì‚°í•˜ê¸°</button>
          <button class="calc-button" onclick="clearFlashInputs('pressure')">ì´ˆê¸°í™”</button>
          <div class="calc-result" id="flash-pressure-result" style="display:none;">
            <h4>V0 ì••ë ¥ ë¦¬ë°‹ ì„¤ì •ê°’</h4>
            <div class="calc-result-value" id="flash-pressure-value"></div>
            <p id="flash-pressure-recommendation"></p>
          </div>
        </div>

        <!-- Shear Rate Calculator -->
        <div class="calculator">
          <h3 style="color:#1e3c72;margin-bottom:20px">3. ëŸ¬ë„ˆ ì „ë‹¨ë¥  ê³„ì‚°ê¸°</h3>
          <div class="calc-input-group">
            <label>ì²´ì  ìœ ëŸ‰ Q (cmÂ³/s):</label>
            <input type="number" id="flash-flow-rate" placeholder="ì˜ˆ: 50" value="50">
          </div>
          <div class="calc-input-group">
            <label>ëŸ¬ë„ˆ ë°˜ê²½ R (cm):</label>
            <input type="number" id="flash-runner-radius" placeholder="ì˜ˆ: 0.4" value="0.4" step="0.1">
          </div>
          <button class="calc-button" onclick="calculateFlashShearRate()">ê³„ì‚°í•˜ê¸°</button>
          <button class="calc-button" onclick="clearFlashInputs('shear')">ì´ˆê¸°í™”</button>
          <div class="calc-result" id="flash-shear-result" style="display:none;">
            <h4>ëŸ¬ë„ˆ ë²½ë©´ ì „ë‹¨ë¥ </h4>
            <div class="calc-result-value" id="flash-shear-value"></div>
            <p id="flash-shear-recommendation"></p>
          </div>
        </div>

        <!-- Packing Pressure Calculator -->
        <div class="calculator">
          <h3 style="color:#1e3c72;margin-bottom:20px">4. ë³´ì•• ì„¤ì •ê°’ ê³„ì‚°ê¸°</h3>
          <div class="calc-input-group">
            <label>ìµœëŒ€ ì‚¬ì¶œì•• P_inj_peak (bar):</label>
            <input type="number" id="flash-p-inj-peak" placeholder="ì˜ˆ: 1500" value="1500">
          </div>
          <button class="calc-button" onclick="calculateFlashPackingPressure()">ê³„ì‚°í•˜ê¸°</button>
          <button class="calc-button" onclick="clearFlashInputs('packing')">ì´ˆê¸°í™”</button>
          <div class="calc-result" id="flash-packing-result" style="display:none;">
            <h4>ë³´ì•• ì„¤ì • ê¶Œì¥ê°’</h4>
            <div class="calc-result-value" id="flash-packing-value"></div>
            <p id="flash-packing-recommendation"></p>
          </div>
        </div>
      </div>

      <!-- Flash Tab 3: Process Flow -->
      <div class="flash-content" id="flash-tab-3">
        <h3 style="color:#1e3c72;margin-bottom:20px">í”„ë¡œì„¸ìŠ¤ í”Œë¡œìš° ë‹¤ì´ì–´ê·¸ë¨</h3>

        <div class="diagram">
          <h3 style="text-align:center;color:#1e3c72;margin-bottom:20px">4ë‹¨ ì œì–´ í”„ë¡œì„¸ìŠ¤ íë¦„ë„</h3>
          <svg viewBox="0 0 800 1200" xmlns="http://www.w3.org/2000/svg">
            <rect x="50" y="50" width="700" height="200" fill="#e3f2fd" stroke="#1e3c72" stroke-width="3" rx="10"/>
            <text x="400" y="90" text-anchor="middle" font-size="24" font-weight="bold" fill="#1e3c72">V0: Runner Protection</text>
            <text x="400" y="120" text-anchor="middle" font-size="16" fill="#333">ì••ë ¥ ì œí•œ ì¤‘ì† (0-90% ëŸ¬ë„ˆ)</text>
            <text x="400" y="145" text-anchor="middle" font-size="14" fill="#666">ì†ë„: 30-50 mm/s</text>
            <text x="400" y="170" text-anchor="middle" font-size="14" fill="#666">ì••ë ¥: 0.8 Ã— F_clamp/A_proj</text>
            <text x="400" y="195" text-anchor="middle" font-size="14" fill="#666">ëª©ì : ìŠ¤í”„ë£¨ í”Œë˜ì‹œ ë°©ì§€</text>
            <text x="400" y="220" text-anchor="middle" font-size="14" fill="#666">ì „ë‹¨ë°œì—´Â·ì ë„ë¶•ê´´ ì°¨ë‹¨</text>

            <path d="M 400 250 L 400 290" stroke="#1e3c72" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>

            <rect x="50" y="290" width="700" height="200" fill="#fff3e0" stroke="#ff6f00" stroke-width="3" rx="10"/>
            <text x="400" y="330" text-anchor="middle" font-size="24" font-weight="bold" fill="#ff6f00">V1: High-Speed Cavity Fill</text>
            <text x="400" y="360" text-anchor="middle" font-size="16" fill="#333">ìºë¹„í‹° ê³ ì† ì¶©ì „ (90-96%)</text>
            <text x="400" y="385" text-anchor="middle" font-size="14" fill="#666">ì†ë„: 80-150 mm/s</text>
            <text x="400" y="410" text-anchor="middle" font-size="14" fill="#666">ì „í™˜: ìºë¹„í‹°ì•• dP/dt í”¼í¬</text>
            <text x="400" y="435" text-anchor="middle" font-size="14" fill="#666">ëª©ì : ì–‡ì€ë²½ ì¶©ì „ì„± í™•ë³´</text>
            <text x="400" y="460" text-anchor="middle" font-size="14" fill="#666">ì••ë ¥ ìƒí•œ ìœ ì§€</text>

            <path d="M 400 490 L 400 530" stroke="#1e3c72" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>

            <rect x="50" y="530" width="700" height="200" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="3" rx="10"/>
            <text x="400" y="570" text-anchor="middle" font-size="24" font-weight="bold" fill="#7b1fa2">V2: End-of-Fill Deceleration</text>
            <text x="400" y="600" text-anchor="middle" font-size="16" fill="#333">ì¶©ì „ ë ê°ì† (96-100%)</text>
            <text x="400" y="625" text-anchor="middle" font-size="14" fill="#666">ì†ë„: 20-40 mm/s (ì„ í˜• ê°ì†)</text>
            <text x="400" y="650" text-anchor="middle" font-size="14" fill="#666">ì‹œì‘: EoF -4~-8 mm</text>
            <text x="400" y="675" text-anchor="middle" font-size="14" fill="#666">ëª©ì : ì••ë ¥ ì˜¤ë²„ìŠˆíŠ¸ ì œê±°</text>
            <text x="400" y="700" text-anchor="middle" font-size="14" fill="#666">í”Œë˜ì‹œ ë°©ì§€</text>

            <path d="M 400 730 L 400 770" stroke="#1e3c72" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>

            <rect x="50" y="770" width="700" height="240" fill="#e8f5e9" stroke="#2e7d32" stroke-width="3" rx="10"/>
            <text x="400" y="810" text-anchor="middle" font-size="24" font-weight="bold" fill="#2e7d32">V3: Packing Pressure Control</text>
            <text x="400" y="840" text-anchor="middle" font-size="16" fill="#333">ë³´ì•• ë¨í”„-ì¸/ì¡°ê¸° ì¢…ë£Œ</text>
            <text x="400" y="865" text-anchor="middle" font-size="14" fill="#666">P1: 30-45% Ã— P_peak (0.1-0.3ì´ˆ)</text>
            <text x="400" y="890" text-anchor="middle" font-size="14" fill="#666">P2: 15-30% Ã— P_peak (ê²Œì´íŠ¸ ë™ê²°ê¹Œì§€)</text>
            <text x="400" y="915" text-anchor="middle" font-size="14" fill="#666">ì¢…ë£Œ: ìµœí›„ ë™ê²° ìºë¹„í‹° ê¸°ì¤€</text>
            <text x="400" y="940" text-anchor="middle" font-size="14" fill="#666">ëª©ì : ê³¼ë³´ì•• ë°©ì§€</text>
            <text x="400" y="965" text-anchor="middle" font-size="14" fill="#666">ê²Œì´íŠ¸ ì‹œì¼ ì‹œí—˜ìœ¼ë¡œ ìµœì í™”</text>
            <text x="400" y="990" text-anchor="middle" font-size="14" fill="#666">ì¤‘ëŸ‰-ì‹œê°„ ê³¡ì„  í™œìš©</text>

            <defs>
              <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="5" refY="5" orient="auto">
                <polygon points="0 0, 10 5, 0 10" fill="#1e3c72"/>
              </marker>
            </defs>
          </svg>
        </div>

        <div class="info-box">
          <h3>ğŸ“Š ê·¸ë˜í”„ í•´ì„</h3>
          <p><strong>V0 êµ¬ê°„:</strong> ì••ë ¥ì´ ë¦¬ë°‹ ì•„ë˜ì—ì„œ ì™„ë§Œí•˜ê²Œ ìƒìŠ¹í•©ë‹ˆë‹¤. ëŸ¬ë„ˆ ë³´í˜¸ ë‹¨ê³„ë¡œ ê³¼ì••ì„ êµ¬ì¡°ì ìœ¼ë¡œ ì°¨ë‹¨í•©ë‹ˆë‹¤.</p>
          <p><strong>V1 êµ¬ê°„:</strong> ê³ ì† ì¶©ì „ìœ¼ë¡œ ì••ë ¥ì´ ê¸‰ìƒìŠ¹í•˜ì§€ë§Œ ì—¬ì „íˆ ë¦¬ë°‹ ì´ë‚´ë¥¼ ìœ ì§€í•©ë‹ˆë‹¤.</p>
          <p><strong>V2 êµ¬ê°„:</strong> ê°ì†ìœ¼ë¡œ ì••ë ¥ ìŠ¤íŒŒì´í¬ê°€ ì œì–´ë˜ë©° ì™„ë§Œí•˜ê²Œ í”¼í¬ì— ë„ë‹¬í•©ë‹ˆë‹¤.</p>
          <p><strong>V3 êµ¬ê°„:</strong> ë³´ì•• ë‹¨ê³„ë¡œ ì••ë ¥ì´ ì ì§„ì ìœ¼ë¡œ ê°ì†Œí•˜ë©° ê²Œì´íŠ¸ ë™ê²° í›„ ì¢…ë£Œë©ë‹ˆë‹¤.</p>
        </div>
      </div>

      <!-- Flash Tab 4: Checklist -->
      <div class="flash-content" id="flash-tab-4">
        <h3 style="color:#1e3c72;margin-bottom:20px">í˜„ì¥ ì‘ì—… ì²´í¬ë¦¬ìŠ¤íŠ¸</h3>
        <button class="print-button" onclick="window.print()">ğŸ–¨ï¸ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì¸ì‡„</button>

        <div class="checklist">
          <h3 style="color:#1e3c72;margin-bottom:15px">ì¤€ë¹„ ë‹¨ê³„ (Pre-Setup)</h3>
          <div class="checklist-item">
            <input type="checkbox" class="checklist-checkbox">
            <div class="checklist-text"><strong>ì¬ë£Œ ê±´ì¡° í™•ì¸:</strong> PHA í ë ›ì„ 65-80Â°Cì—ì„œ 6-24ì‹œê°„ ê±´ì¡°í–ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</div>
          </div>
          <div class="checklist-item">
            <input type="checkbox" class="checklist-checkbox">
            <div class="checklist-text"><strong>ëŸ¬ë„ˆ ì²´ì  ê³„ì‚°:</strong> CAD ë˜ëŠ” ê¸ˆí˜• ë„ë©´ì—ì„œ ëŸ¬ë„ˆ ì´ ì²´ì (V_runner)ì„ ê³„ì‚°í•˜ê³  90% ì§€ì ì„ ìŠ¤í¬ë¥˜ ìœ„ì¹˜ë¡œ í™˜ì‚°í•©ë‹ˆë‹¤.</div>
          </div>
          <div class="checklist-item">
            <input type="checkbox" class="checklist-checkbox">
            <div class="checklist-text"><strong>íˆ¬ì˜ ë©´ì  ì¸¡ì •:</strong> 36ê°œ ìºë¹„í‹°ì˜ ì´ íˆ¬ì˜ ë©´ì (A_proj)ì„ ê³„ì‚°í•©ë‹ˆë‹¤.</div>
          </div>
          <div class="checklist-item">
            <input type="checkbox" class="checklist-checkbox">
            <div class="checklist-text"><strong>í´ë¨í”„ í†¤ìˆ˜ í™•ì¸:</strong> ê³„ì‚°ê¸°ë¥¼ ì´ìš©í•´ í•„ìš” í†¤ìˆ˜ë¥¼ ì‚°ì¶œí•˜ê³  í˜„ì¬ ê¸°ê³„ ì‚¬ì–‘ê³¼ ë¹„êµí•©ë‹ˆë‹¤.</div>
          </div>
        </div>

        <div class="checklist">
          <h3 style="color:#1e3c72;margin-bottom:15px">V0 ë‹¨ê³„ ì„¤ì • (Runner Protection)</h3>
          <div class="checklist-item">
            <input type="checkbox" class="checklist-checkbox">
            <div class="checklist-text"><strong>V0 ì†ë„ ì„¤ì •:</strong> 30-50 mm/s ë²”ìœ„ì—ì„œ ì¤‘ì†ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.</div>
          </div>
          <div class="checklist-item">
            <input type="checkbox" class="checklist-checkbox">
            <div class="checklist-text"><strong>ì••ë ¥ ë¦¬ë°‹ ì„¤ì •:</strong> ê³„ì‚°ê¸°ì—ì„œ ì‚°ì¶œí•œ ê°’(0.8 Ã— F_clamp/A_proj)ì„ ê¸°ê³„ì— ì…ë ¥í•©ë‹ˆë‹¤.</div>
          </div>
          <div class="checklist-item">
            <input type="checkbox" class="checklist-checkbox">
            <div class="checklist-text"><strong>V0â†’V1 ì „í™˜ì  ì„¤ì •:</strong> ëŸ¬ë„ˆ ì²´ì ì˜ 90% ì§€ì ì„ ìŠ¤í¬ë¥˜ ìœ„ì¹˜ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.</div>
          </div>
        </div>

        <div class="checklist">
          <h3 style="color:#1e3c72;margin-bottom:15px">V1 ë‹¨ê³„ ì„¤ì • (High-Speed Fill)</h3>
          <div class="checklist-item">
            <input type="checkbox" class="checklist-checkbox">
            <div class="checklist-text"><strong>V1 ì†ë„ ì„¤ì •:</strong> ì–‡ì€ë²½ ì¶©ì „ì„ ìœ„í•´ 80-150 mm/s ë²”ìœ„ì—ì„œ ê³ ì†ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.</div>
          </div>
          <div class="checklist-item">
            <input type="checkbox" class="checklist-checkbox">
            <div class="checklist-text"><strong>ì‚¬ì¶œì•• ìƒí•œ ìœ ì§€:</strong> V0ì—ì„œ ì„¤ì •í•œ ì••ë ¥ ë¦¬ë°‹ì´ V1ì—ì„œë„ ì ìš©ë˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</div>
          </div>
        </div>

        <div class="checklist">
          <h3 style="color:#1e3c72;margin-bottom:15px">ê²€ì¦ ë‹¨ê³„ (Verification)</h3>
          <div class="checklist-item">
            <input type="checkbox" class="checklist-checkbox">
            <div class="checklist-text"><strong>í”Œë˜ì‹œ ì¸¡ì •:</strong> íŒŒíŒ…ë¼ì¸ê³¼ ìŠ¤í”„ë£¨ ì£¼ë³€ì—ì„œ í”Œë˜ì‹œ ë†’ì´ë¥¼ ì¸¡ì •í•©ë‹ˆë‹¤. ëª©í‘œëŠ” 0.02mm ì´í•˜ì…ë‹ˆë‹¤.</div>
          </div>
          <div class="checklist-item">
            <input type="checkbox" class="checklist-checkbox">
            <div class="checklist-text"><strong>ì œí’ˆ ë¬´ê²Œ í™•ì¸:</strong> 36ê°œ ìºë¹„í‹°ì˜ ì œí’ˆ ë¬´ê²Œë¥¼ ì¸¡ì •í•˜ê³  ë³€ë™ì´ Â±1% ì´ë‚´ì¸ì§€ í™•ì¸í•©ë‹ˆë‹¤.</div>
          </div>
          <div class="checklist-item">
            <input type="checkbox" class="checklist-checkbox">
            <div class="checklist-text"><strong>ì¹˜ìˆ˜ ì¸¡ì •:</strong> í•µì‹¬ ì¹˜ìˆ˜ë¥¼ ì¸¡ì •í•˜ê³  ê·œê²© ë‚´ì— ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</div>
          </div>
        </div>
      </div>

      <!-- Flash Tab 5: Troubleshooting -->
      <div class="flash-content" id="flash-tab-5">
        <h3 style="color:#1e3c72;margin-bottom:20px">ë¬¸ì œ í•´ê²° ê°€ì´ë“œ</h3>

        <div class="warning-box">
          <h3>ğŸ”´ ë¬¸ì œ: ìŠ¤í”„ë£¨/ëŸ¬ë„ˆ ê·¼ì²˜ì— í”Œë˜ì‹œ ë°œìƒ</h3>
          <p><strong>ê°€ëŠ¥ ì›ì¸ê³¼ í•´ê²°ì±…:</strong></p>
          <ul style="margin-left:20px;margin-top:10px">
            <li><strong>V0 ì••ë ¥ ë¦¬ë°‹ì´ ë„ˆë¬´ ë†’ìŒ</strong> â†’ ì••ë ¥ ë¦¬ë°‹ì„ 70%ë¡œ ë‚®ì¶”ê³  ì¬ì‹œí—˜í•©ë‹ˆë‹¤</li>
            <li><strong>í´ë¨í”„ í†¤ìˆ˜ ë¶€ì¡±</strong> â†’ ê³„ì‚°ê¸°ë¡œ ì¬í™•ì¸í•˜ê³  ë” í° ê¸°ê³„ë¡œ ì „í™˜ ê²€í† í•©ë‹ˆë‹¤</li>
            <li><strong>ìŠ¤í”„ë£¨ ë¶€ì‹± ë§ˆëª¨/ì†ìƒ</strong> â†’ ìŠ¤í”„ë£¨ ë¶€ì‹±ì„ êµì²´í•˜ê³  ì‹œíŠ¸ í˜•ìƒì„ ì ê²€í•©ë‹ˆë‹¤</li>
            <li><strong>íŒŒíŒ…ë¼ì¸ ì˜¨ë„ê°€ ë†’ìŒ</strong> â†’ êµ­ë¶€ ëƒ‰ê°ì„ -5Â°Cê¹Œì§€ ê°•í™”í•©ë‹ˆë‹¤</li>
            <li><strong>ëŸ¬ë„ˆ ì „ë‹¨ë°œì—´</strong> â†’ V0 ì†ë„ë¥¼ ë‚®ì¶”ê±°ë‚˜ ëŸ¬ë„ˆ ì§ê²½ì„ ì¦ëŒ€í•©ë‹ˆë‹¤</li>
          </ul>
        </div>

        <div class="warning-box">
          <h3>ğŸŸ  ë¬¸ì œ: ìºë¹„í‹° ì¶©ì „ ë¶ˆì™„ì „ (Short Shot)</h3>
          <p><strong>ê°€ëŠ¥ ì›ì¸ê³¼ í•´ê²°ì±…:</strong></p>
          <ul style="margin-left:20px;margin-top:10px">
            <li><strong>V1 ì†ë„ê°€ ë„ˆë¬´ ë‚®ìŒ</strong> â†’ V1 ì†ë„ë¥¼ ë‹¨ê³„ì ìœ¼ë¡œ ì¦ê°€ì‹œí‚µë‹ˆë‹¤</li>
            <li><strong>V0 êµ¬ê°„ì´ ë„ˆë¬´ ê¸¸ìŒ</strong> â†’ V0â†’V1 ì „í™˜ì ì„ 85%ë¡œ ì•ë‹¹ê¹ë‹ˆë‹¤</li>
            <li><strong>ì¬ë£Œ ì˜¨ë„ê°€ ë„ˆë¬´ ë‚®ìŒ</strong> â†’ ì‹¤ë¦°ë” ì˜¨ë„ë¥¼ 5-10Â°C ìƒìŠ¹ì‹œí‚µë‹ˆë‹¤</li>
            <li><strong>ê¸ˆí˜• ì˜¨ë„ê°€ ë„ˆë¬´ ë‚®ìŒ</strong> â†’ ìºë¹„í‹° ì˜¨ë„ë¥¼ ìƒìŠ¹ì‹œí‚µë‹ˆë‹¤(ë‹¨, ìŠ¤í”„ë£¨ëŠ” ì €ì˜¨ ìœ ì§€)</li>
            <li><strong>ê²Œì´íŠ¸ í¬ê¸° ë¶€ì¡±</strong> â†’ ê²Œì´íŠ¸ ì§ê²½ì„ 0.1-0.2mm ì¦ëŒ€ ê²€í† í•©ë‹ˆë‹¤</li>
          </ul>
        </div>

        <div class="warning-box">
          <h3>ğŸŸ¡ ë¬¸ì œ: EoFì—ì„œ ì••ë ¥ ìŠ¤íŒŒì´í¬ ë°œìƒ</h3>
          <p><strong>ê°€ëŠ¥ ì›ì¸ê³¼ í•´ê²°ì±…:</strong></p>
          <ul style="margin-left:20px;margin-top:10px">
            <li><strong>V2 ê°ì†ì´ ì—†ê±°ë‚˜ ë¶ˆì¶©ë¶„</strong> â†’ V2 ê°ì† êµ¬ê°„ì„ 8mmë¡œ ì—°ì¥í•©ë‹ˆë‹¤</li>
            <li><strong>ê°ì† í”„ë¡œíŒŒì¼ì´ ê¸‰ê²©í•¨</strong> â†’ ì„ í˜• ë¨í”„ê°€ ì•„ë‹Œ ê²½ìš° ì„¤ì •ì„ ë³€ê²½í•©ë‹ˆë‹¤</li>
            <li><strong>V1 ì†ë„ê°€ ê³¼ë„í•˜ê²Œ ë†’ìŒ</strong> â†’ V1 ì†ë„ë¥¼ 10-20% ê°ì†Œì‹œí‚µë‹ˆë‹¤</li>
            <li><strong>ê³µê¸° í¬íš(Air Trap)</strong> â†’ ë²¤íŠ¸ ìœ„ì¹˜ì™€ í¬ê¸°ë¥¼ ì ê²€í•©ë‹ˆë‹¤</li>
          </ul>
        </div>

        <div class="warning-box">
          <h3>ğŸŸ¢ ë¬¸ì œ: ìºë¹„í‹° ê°„ ë¬´ê²Œ í¸ì°¨ê°€ í¼</h3>
          <p><strong>ê°€ëŠ¥ ì›ì¸ê³¼ í•´ê²°ì±…:</strong></p>
          <ul style="margin-left:20px;margin-top:10px">
            <li><strong>ëŸ¬ë„ˆ ë°¸ëŸ°ì‹± ë¶ˆëŸ‰</strong> â†’ ëŸ¬ë„ˆ ì„¤ê³„ë¥¼ ì¬ê²€í† í•˜ê±°ë‚˜ ê²Œì´íŠ¸ êµ¬ê²½ì„ ë¯¸ì„¸ ì¡°ì •í•©ë‹ˆë‹¤</li>
            <li><strong>ê²Œì´íŠ¸ ë™ê²° ì‹œê°„ í¸ì°¨</strong> â†’ ê²Œì´íŠ¸ êµ¬ê²½ì„ Â±0.02mm ë‹¨ìœ„ë¡œ ì¡°ì •í•˜ì—¬ ë™ê²° ì‹œê°„ì„ ê· ì§ˆí™”í•©ë‹ˆë‹¤</li>
            <li><strong>ê¸ˆí˜• ì˜¨ë„ ë¶ˆê· ì¼</strong> â†’ ê° êµ¬ì—­ì˜ ì‹¤ì œ ì˜¨ë„ë¥¼ ì¸¡ì •í•˜ê³  ê· ì¼í™”í•©ë‹ˆë‹¤</li>
            <li><strong>ë³´ì•• ì‹œê°„ì´ ìµœí›„ ë™ê²° ìºë¹„í‹° ê¸°ì¤€ì´ ì•„ë‹˜</strong> â†’ ê²Œì´íŠ¸ ì‹œì¼ ì‹œí—˜ì„ ì¬ìˆ˜í–‰í•©ë‹ˆë‹¤</li>
          </ul>
        </div>

        <div class="warning-box">
          <h3>ğŸ”µ ë¬¸ì œ: PHA ì¬ë£Œ ì—´í™” ì§•í›„ (ë³€ìƒ‰, ê°€ìŠ¤ ë°œìƒ)</h3>
          <p><strong>ê°€ëŠ¥ ì›ì¸ê³¼ í•´ê²°ì±…:</strong></p>
          <ul style="margin-left:20px;margin-top:10px">
            <li><strong>ì‹¤ë¦°ë” ì˜¨ë„ê°€ ê³¼ë„í•¨</strong> â†’ í›„ë°©ëŒ€ ì˜¨ë„ë¥¼ 5-10Â°C ë‚®ì¶¥ë‹ˆë‹¤</li>
            <li><strong>ì²´ë¥˜ì‹œê°„ì´ ê¸¸ìŒ</strong> â†’ ìƒ· í¬ê¸°ë¥¼ ì¦ëŒ€í•˜ê±°ë‚˜ ì‚¬ì´í´ íƒ€ì„ì„ ë‹¨ì¶•í•©ë‹ˆë‹¤</li>
            <li><strong>ìŠ¤í¬ë¥˜ rpmì´ ë†’ìŒ</strong> â†’ rpmì„ 30-50% ê°ì†Œì‹œí‚µë‹ˆë‹¤</li>
            <li><strong>ë°°ì••ì´ ê³¼ë„í•¨</strong> â†’ ë°°ì••ì„ ìµœì†Œ(5-10 bar)ë¡œ ë‚®ì¶¥ë‹ˆë‹¤</li>
            <li><strong>ì¬ë£Œ ê±´ì¡° ë¶ˆì¶©ë¶„</strong> â†’ ê±´ì¡° ì‹œê°„ì„ ì—°ì¥í•˜ê³  ì˜¨ë„ë¥¼ í™•ì¸í•©ë‹ˆë‹¤</li>
          </ul>
        </div>

        <div class="info-box">
          <h3>ğŸ’¡ ì˜ˆë°© ì¡°ì¹˜ (Preventive Actions)</h3>
          <p><strong>ì •ê¸°ì ìœ¼ë¡œ ìˆ˜í–‰í•´ì•¼ í•  ì‘ì—…:</strong></p>
          <ul style="margin-left:20px;margin-top:10px">
            <li>ì£¼ 1íšŒ: ìŠ¤í”„ë£¨ ë¶€ì‹±ê³¼ íŒŒíŒ…ë¼ì¸ì˜ ë§ˆëª¨/ì†ìƒ ì ê²€</li>
            <li>ì£¼ 1íšŒ: íƒ€ì´ë°” ë³€í˜• ì¸¡ì • ë° í´ë¨í”„ í†¤ìˆ˜ ì¬í™•ì¸</li>
            <li>ì¼ 2íšŒ: ì œí’ˆ ë¬´ê²Œì™€ ì¹˜ìˆ˜ ìƒ˜í”Œë§ (ì‹œì‘/ì¢…ë£Œ ì‹œ)</li>
            <li>ì¼ 1íšŒ: ìºë¹„í‹° ì••ë ¥ ë°ì´í„° ê²€í†  ë° íŠ¸ë Œë“œ ë¶„ì„</li>
            <li>êµëŒ€ ì‹œ: ê¸ˆí˜• ì˜¨ë„ ì‹¤ì¸¡ê°’ í™•ì¸</li>
            <li>ë¡œíŠ¸ ë³€ê²½ ì‹œ: ì¬ë£Œ ê±´ì¡° ìƒíƒœ ì¬í™•ì¸</li>
          </ul>
        </div>
      </div>

      <!-- Flash Tab 6: Process Log -->
      <div class="flash-content" id="flash-tab-6">
        <h3 style="color:#1e3c72;margin-bottom:20px">ê³µì • ì¡°ê±´ í˜„ì¥ ê¸°ë¡ ë¡œê·¸</h3>

        <div class="success-box">
          <h3>ğŸ“‹ í˜„ì¥ í‰ê°€ ë° ì¡°ê±´ ê¸°ë¡</h3>
          <p><strong>ê³µì • ì¡°ê±´ê³¼ í˜„ìƒì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ê¸°ë¡í•˜ì—¬ ë¬¸ì œ í•´ê²°ê³¼ ìµœì í™”ì— í™œìš©í•˜ì„¸ìš”.</strong></p>
          <p>ê° íŒŒë¼ë¯¸í„°ëŠ” ì§ì ‘ ì…ë ¥í•˜ê±°ë‚˜ +/- ë²„íŠ¼ìœ¼ë¡œ ì¡°ì •í•  ìˆ˜ ìˆìœ¼ë©°, ëª¨ë“  ë°ì´í„°ëŠ” ìë™ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤.</p>
        </div>

        <!-- Search and Filter -->
        <div class="filter-container">
          <h4 style="color:#1e3c72;margin-bottom:10px">ğŸ” ê²€ìƒ‰ ë° í•„í„°</h4>
          <div class="filter-row">
            <input type="text" id="filterKeyword" class="filter-input" placeholder="ë¹„ê³ ë€ í‚¤ì›Œë“œ ê²€ìƒ‰..." onkeyup="filterProcessLog()">
            <input type="date" id="filterDateFrom" class="filter-input" style="max-width:180px" onchange="filterProcessLog()">
            <span style="white-space:nowrap">~</span>
            <input type="date" id="filterDateTo" class="filter-input" style="max-width:180px" onchange="filterProcessLog()">
            <button class="btn-filter" onclick="clearFilter()">í•„í„° ì´ˆê¸°í™”</button>
          </div>
        </div>

        <!-- Template Management -->
        <div class="template-container">
          <h4 style="color:#1e3c72;margin-bottom:5px">ğŸ“‹ í…œí”Œë¦¿ ê´€ë¦¬</h4>
          <p style="font-size:13px;color:#6b7280;margin-bottom:10px">ìì£¼ ì‚¬ìš©í•˜ëŠ” ê³µì • ì¡°ê±´ì„ í…œí”Œë¦¿ìœ¼ë¡œ ì €ì¥í•˜ì—¬ ë¹ ë¥´ê²Œ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
          <div class="template-buttons">
            <button class="btn-template" onclick="saveTemplate()">ğŸ’¾ í˜„ì¬ ì¡°ê±´ í…œí”Œë¦¿ ì €ì¥</button>
            <button class="btn-template load" onclick="loadTemplate()">ğŸ“¥ í…œí”Œë¦¿ ë¶ˆëŸ¬ì˜¤ê¸°</button>
            <button class="btn-template delete" onclick="manageTemplates()">ğŸ—‘ï¸ í…œí”Œë¦¿ ê´€ë¦¬</button>
          </div>
        </div>

        <!-- Weight Measurement and Shot Calculator -->
        <div class="calc-recommendation">
          <h4>âš–ï¸ ë¬´ê²Œ ì¸¡ì • ë° ê³„ëŸ‰ ê³„ì‚°ê¸°</h4>
          <p style="font-size:14px;margin-bottom:15px">ì œí’ˆê³¼ ëŸ¬ë„ˆ ë¬´ê²Œë¥¼ ì¸¡ì •í•˜ì—¬ ìƒ· ê³„ëŸ‰ì–‘ê³¼ í”Œë˜ì‹œ ì €ê° ì¡°ê±´ì„ ìë™ ì‚°ì¶œí•©ë‹ˆë‹¤.</p>

          <div class="weight-calc-grid">
            <div class="weight-input-box">
              <label>ì œí’ˆ 1ê°œ ë¬´ê²Œ (g)</label>
              <input type="number" id="partWeight" step="0.01" placeholder="0.00" onchange="calculateShotWeight()">
            </div>
            <div class="weight-input-box">
              <label>ëŸ¬ë„ˆ ë¬´ê²Œ (g)</label>
              <input type="number" id="runnerWeight" step="0.01" placeholder="0.00" onchange="calculateShotWeight()">
            </div>
            <div class="weight-input-box">
              <label>ìºë¹„í‹° ìˆ˜</label>
              <input type="number" id="cavityCount" value="36" step="1" onchange="calculateShotWeight()">
            </div>
            <div class="weight-input-box">
              <label>ì¬ë£Œ ë°€ë„ (g/cmÂ³)</label>
              <input type="number" id="materialDensity" value="1.25" step="0.01" placeholder="1.25" onchange="calculateShotWeight()">
              <button class="btn-filter" style="margin-top:8px;width:100%;padding:6px" onclick="loadDensityFromGrade()">Gradeì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
            </div>
          </div>

          <div id="shotWeightResult" style="display:none;margin-top:15px">
            <div class="density-display">
              ì´ ìƒ· ê³„ëŸ‰: <span id="totalShotWeight">0.00</span> g (<span id="shotVolume">0.00</span> cmÂ³)
            </div>
            <button class="btn-log-action btn-add-log" style="width:100%;margin-top:10px" onclick="applyWeightToLog()">
              â¬‡ï¸ ìµœì‹  ë¡œê·¸ì— ë¬´ê²Œ ì ìš©
            </button>
          </div>
        </div>

        <!-- Flash Reduction Recommendations -->
        <div id="flashRecommendations" style="display:none">
          <div class="calc-recommendation">
            <h4>ğŸ’¡ í”Œë˜ì‹œ ì €ê° ê³µì • ì¡°ê±´ ì¶”ì²œ</h4>
            <p style="font-size:14px;margin-bottom:15px">í˜„ì¬ ê³µì • ì¡°ê±´ì„ ë¶„ì„í•˜ì—¬ í”Œë˜ì‹œ ë°œìƒì„ ì¤„ì´ê¸° ìœ„í•œ ìµœì í™” ë°©ì•ˆì„ ì œì‹œí•©ë‹ˆë‹¤.</p>
            <div id="recommendationContent"></div>
          </div>
        </div>

        <!-- Chart Visualization -->
        <div class="chart-container">
          <div class="chart-controls">
            <h4 style="color:#1e3c72;margin:0;flex:1">ğŸ“Š ê³µì • ì¡°ê±´ íŠ¸ë Œë“œ ì°¨íŠ¸</h4>
            <button class="chart-toggle-btn active" onclick="showChart('temp')" id="chartBtnTemp">ì˜¨ë„</button>
            <button class="chart-toggle-btn" onclick="showChart('pressure')" id="chartBtnPressure">ì••ë ¥</button>
            <button class="chart-toggle-btn" onclick="showChart('weight')" id="chartBtnWeight">ë¬´ê²Œ</button>
            <button class="chart-toggle-btn" onclick="showChart('time')" id="chartBtnTime">ì‹œê°„</button>
          </div>
          <div style="position:relative;height:300px">
            <canvas id="processChart"></canvas>
          </div>
          <p style="font-size:12px;color:#6b7280;margin-top:10px;text-align:center">
            ìµœê·¼ 20ê°œ ë¡œê·¸ ë°ì´í„°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ íŠ¸ë Œë“œë¥¼ í‘œì‹œí•©ë‹ˆë‹¤. ë¡œê·¸ê°€ ì¶”ê°€ë ìˆ˜ë¡ ìë™ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.
          </p>
        </div>

        <div class="log-container">
          <div class="log-header">
            <h4 style="color:#1e3c72;margin:0">ğŸ“ ê³µì • ì¡°ê±´ ë¡œê·¸</h4>
            <div style="display:flex;gap:10px;flex-wrap:wrap">
              <button class="btn-log-action btn-add-log" onclick="addProcessLogEntry()">â• ë¡œê·¸ ì¶”ê°€</button>
              <button class="btn-log-action btn-export-log" onclick="exportProcessLog()">ğŸ“¥ CSV ë‚´ë³´ë‚´ê¸°</button>
              <button class="btn-log-action btn-clear-log" onclick="clearProcessLog()">ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ</button>
            </div>
          </div>

          <div style="overflow-x:auto">
            <table class="log-table" id="processLogTable">
              <thead>
                <tr>
                  <th style="min-width:140px">ì¼ì‹œ</th>
                  <th style="min-width:120px">ì‹¤ë¦°ë” ì˜¨ë„ (Â°C)</th>
                  <th style="min-width:120px">ê¸ˆí˜• ì˜¨ë„ (Â°C)</th>
                  <th style="min-width:130px">ì‚¬ì¶œì†ë„ (mm/s)</th>
                  <th style="min-width:120px">ì‚¬ì¶œì••ë ¥ (bar)</th>
                  <th style="min-width:120px">ë³´ì•• (bar)</th>
                  <th style="min-width:130px">ë³´ì••ì‹œê°„ (s)</th>
                  <th style="min-width:130px">ëƒ‰ê°ì‹œê°„ (s)</th>
                  <th style="min-width:120px">ì œí’ˆ ë¬´ê²Œ (g)</th>
                  <th style="min-width:120px">ëŸ¬ë„ˆ ë¬´ê²Œ (g)</th>
                  <th style="min-width:130px">ì´ ë¬´ê²Œ (g)</th>
                  <th style="min-width:200px">ë¹„ê³ /í˜„ìƒ</th>
                  <th style="min-width:100px">ì‚¬ì§„</th>
                  <th style="min-width:80px">ë™ì‘</th>
                </tr>
              </thead>
              <tbody id="processLogBody">
                <tr>
                  <td colspan="14" class="log-empty">ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤. "â• ë¡œê·¸ ì¶”ê°€" ë²„íŠ¼ì„ ëˆŒëŸ¬ ì²« ê¸°ë¡ì„ ì‹œì‘í•˜ì„¸ìš”.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="info-box" style="margin-top:30px">
          <h3>ğŸ’¡ ì‚¬ìš© ì•ˆë‚´</h3>
          <ul style="margin-left:20px;margin-top:10px">
            <li><strong>ë¡œê·¸ ì¶”ê°€:</strong> "â• ë¡œê·¸ ì¶”ê°€" ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ìƒˆë¡œìš´ ê¸°ë¡ í–‰ì´ ì¶”ê°€ë©ë‹ˆë‹¤</li>
            <li><strong>ê°’ ì…ë ¥:</strong> ìˆ«ìë¥¼ ì§ì ‘ ì…ë ¥í•˜ê±°ë‚˜ +/- ë²„íŠ¼ìœ¼ë¡œ ì¡°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
            <li><strong>ë¬´ê²Œ ì¸¡ì •:</strong> ì œí’ˆê³¼ ëŸ¬ë„ˆ ë¬´ê²Œë¥¼ ì…ë ¥í•˜ë©´ ìƒ· ê³„ëŸ‰ê³¼ í”Œë˜ì‹œ ì €ê° ì¡°ê±´ì´ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤</li>
            <li><strong>ê²€ìƒ‰/í•„í„°:</strong> ë‚ ì§œ ë²”ìœ„ì™€ í‚¤ì›Œë“œë¡œ ì›í•˜ëŠ” ë¡œê·¸ë¥¼ ë¹ ë¥´ê²Œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
            <li><strong>í…œí”Œë¦¿:</strong> ìì£¼ ì‚¬ìš©í•˜ëŠ” ê³µì • ì¡°ê±´ì„ ì €ì¥í•˜ì—¬ ë¹ ë¥´ê²Œ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
            <li><strong>ì‚¬ì§„ ì²¨ë¶€:</strong> ê° ë¡œê·¸ì— ë¶ˆëŸ‰í’ˆ ë˜ëŠ” ì œí’ˆ ì‚¬ì§„ì„ ì²¨ë¶€í•˜ì—¬ ì‹œê°ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
            <li><strong>ì°¨íŠ¸ ë·°:</strong> ì˜¨ë„, ì••ë ¥, ë¬´ê²Œ, ì‹œê°„ íŒŒë¼ë¯¸í„°ì˜ íŠ¸ë Œë“œë¥¼ ì‹¤ì‹œê°„ ì°¨íŠ¸ë¡œ í™•ì¸í•˜ì„¸ìš”</li>
            <li><strong>ëª¨ë°”ì¼ ì‚¬ìš©:</strong> PCì™€ íœ´ëŒ€í° ëª¨ë‘ì—ì„œ í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ìµœì í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤</li>
            <li><strong>ìë™ ì €ì¥:</strong> ì…ë ¥í•œ ê°’ì€ ìë™ìœ¼ë¡œ ë¸Œë¼ìš°ì €ì— ì €ì¥ë©ë‹ˆë‹¤</li>
            <li><strong>CSV ë‚´ë³´ë‚´ê¸°:</strong> ê¸°ë¡í•œ ë°ì´í„°ë¥¼ CSV íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
            <li><strong>ë¹„ê³ ë€ í™œìš©:</strong> í˜„ìƒ, ë¶ˆëŸ‰ ìœ í˜•, íŠ¹ì´ì‚¬í•­ ë“±ì„ ììœ ë¡­ê²Œ ê¸°ë¡í•˜ì„¸ìš”</li>
          </ul>
        </div>

        <div class="warning-box" style="margin-top:20px">
          <h3>âš ï¸ ì£¼ì˜ì‚¬í•­</h3>
          <ul style="margin-left:20px;margin-top:10px">
            <li>ë°ì´í„°ëŠ” ë¸Œë¼ìš°ì €ì— ì €ì¥ë˜ë¯€ë¡œ <strong>ë¸Œë¼ìš°ì € ìºì‹œë¥¼ ì‚­ì œí•˜ë©´ ë°ì´í„°ê°€ ì†ì‹¤</strong>ë©ë‹ˆë‹¤</li>
            <li>ì¤‘ìš”í•œ ë°ì´í„°ëŠ” ì •ê¸°ì ìœ¼ë¡œ <strong>CSV ë‚´ë³´ë‚´ê¸°</strong>ë¥¼ í†µí•´ ë°±ì—…í•˜ì„¸ìš”</li>
            <li>ë‹¤ë¥¸ ê¸°ê¸°ë‚˜ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ë°ì´í„°ê°€ ê³µìœ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤</li>
          </ul>
        </div>
      </div>

      <!-- Flash Tab 7: Documentation -->
      <div class="flash-content" id="flash-tab-7">
        <h3 style="color:#1e3c72;margin-bottom:20px">ğŸ“– PHA Process Optimizer & Convertor - ì‚¬ìš© ì„¤ëª…ì„œ</h3>

        <div class="success-box">
          <h3>ğŸ¯ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œìš”</h3>
          <p><strong>PHA Process Optimizer & Convertor</strong>ëŠ” PHA(Polyhydroxyalkanoate) ë°”ì´ì˜¤í”Œë¼ìŠ¤í‹± ì‚¬ì¶œ ì„±í˜• ê³µì •ì˜ í˜„ì¥ ì—”ì§€ë‹ˆì–´ì™€ í’ˆì§ˆ ê´€ë¦¬ìë¥¼ ìœ„í•œ ì¢…í•© ë„êµ¬ì…ë‹ˆë‹¤.</p>
          <p style="margin-top:10px"><strong>ë²„ì „:</strong> 1.0.0 | <strong>ìœ í˜•:</strong> ì •ì  ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ (ì„œë²„ ë¶ˆí•„ìš”) | <strong>ì €ì¥:</strong> ë¸Œë¼ìš°ì € ë¡œì»¬ ì €ì¥ì†Œ</p>
        </div>

        <h4 style="color:#1e3c72;margin-top:30px;margin-bottom:15px">ğŸ“‹ ì£¼ìš” ê¸°ëŠ¥</h4>

        <table>
          <thead>
            <tr>
              <th style="min-width:150px">ê¸°ëŠ¥</th>
              <th>ì„¤ëª…</th>
              <th style="min-width:120px">ìœ„ì¹˜</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>ë‹¨ìœ„ ë³€í™˜ê¸°</strong></td>
              <td>ì••ë ¥(bar/MPa/psi), ì˜¨ë„(Â°C/Â°F/K), ê¸¸ì´, ì†ë„ ë‹¨ìœ„ ì‹¤ì‹œê°„ ë³€í™˜</td>
              <td>ë©”ì¸ íƒ­ 1</td>
            </tr>
            <tr>
              <td><strong>í´ë¨í”„ í†¤ìˆ˜ ê³„ì‚°</strong></td>
              <td>36 ìºë¹„í‹° ê¸ˆí˜•ì˜ ìµœì  í´ë¨í”„ í†¤ìˆ˜ ìë™ ì‚°ì¶œ (ì•ˆì „ê³„ìˆ˜ 1.2 í¬í•¨)</td>
              <td>ë©”ì¸ íƒ­ 2</td>
            </tr>
            <tr>
              <td><strong>í”Œë˜ì‹œ ì €ê° ê°€ì´ë“œ</strong></td>
              <td>ì²´ê³„ì ì¸ ì‚¬ì¶œì†ë„, ì••ë ¥, ì˜¨ë„ ìµœì í™” ë°©ë²•ë¡  (6ê°œ ì„œë¸Œíƒ­)</td>
              <td>ë©”ì¸ íƒ­ 3</td>
            </tr>
            <tr>
              <td><strong>ê³µì • ì¡°ê±´ ë¡œê·¸</strong></td>
              <td>ì‹¤ì‹œê°„ ê³µì • ê¸°ë¡, ì°¨íŠ¸ ì‹œê°í™”, ê²€ìƒ‰/í•„í„°, í…œí”Œë¦¿, ì‚¬ì§„ ì²¨ë¶€</td>
              <td>í”Œë˜ì‹œ íƒ­ 6</td>
            </tr>
            <tr>
              <td><strong>í”Œë˜ì‹œ ì €ê° ì¶”ì²œ</strong></td>
              <td>í˜„ì¬ ê³µì • ì¡°ê±´ ë¶„ì„ ë° ìµœì í™” ë°©ì•ˆ ìë™ ì œì‹œ</td>
              <td>í”Œë˜ì‹œ íƒ­ 6</td>
            </tr>
            <tr>
              <td><strong>ë¬´ê²Œ ê³„ì‚°ê¸°</strong></td>
              <td>ì œí’ˆ/ëŸ¬ë„ˆ ë¬´ê²Œ ê¸°ë°˜ ìƒ· ê³„ëŸ‰ ë° ìš©ì  ê³„ì‚°</td>
              <td>í”Œë˜ì‹œ íƒ­ 6</td>
            </tr>
          </tbody>
        </table>

        <h4 style="color:#1e3c72;margin-top:30px;margin-bottom:15px">ğŸ” í”Œë˜ì‹œ ì €ê° ì¶”ì²œ ì—”ì§„ ìƒì„¸</h4>

        <div class="info-box">
          <h3>ğŸ’¡ ë¶„ì„ ê¸°ì¤€ ë° ì¶”ì²œ ë¡œì§</h3>
          <p>ìµœì‹  ë¡œê·¸ ë°ì´í„°ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ë¶„ì„í•˜ì—¬ 5ê°€ì§€ ì£¼ìš” íŒŒë¼ë¯¸í„°ì— ëŒ€í•œ í”Œë˜ì‹œ ì €ê° ë°©ì•ˆì„ ìë™ ì œì‹œí•©ë‹ˆë‹¤.</p>
        </div>

        <table style="margin-top:15px">
          <thead>
            <tr>
              <th>íŒŒë¼ë¯¸í„°</th>
              <th>ê¸°ì¤€ê°’</th>
              <th>ì¶”ì²œ ì¡°ì¹˜</th>
              <th>ê¸°ìˆ ì  ê·¼ê±°</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>ì‚¬ì¶œì••ë ¥</strong></td>
              <td>&gt; 900 bar</td>
              <td>-50 bar ê°ì†Œ</td>
              <td>ê³¼ë„í•œ ì••ë ¥ â†’ íŒŒíŒ…ë¼ì¸ ë²Œì–´ì§ â†’ í”Œë˜ì‹œ ë°œìƒ</td>
            </tr>
            <tr>
              <td><strong>ì‹¤ë¦°ë” ì˜¨ë„</strong></td>
              <td>&gt; 185Â°C</td>
              <td>-5Â°C ê°ì†Œ</td>
              <td>ê³ ì˜¨ â†’ ì ë„ ê°ì†Œ â†’ ë¯¸ì„¸ í‹ˆìƒˆ ì¹¨íˆ¬ ì¦ê°€</td>
            </tr>
            <tr>
              <td><strong>ì‚¬ì¶œì†ë„</strong></td>
              <td>&gt; 180 mm/s</td>
              <td>-20 mm/s ê°ì†Œ</td>
              <td>ê³ ì† â†’ ì••ë ¥ ìŠ¤íŒŒì´í¬ â†’ í”Œë˜ì‹œ ìœ„í—˜ ì¦ê°€</td>
            </tr>
            <tr>
              <td><strong>ë³´ì••</strong></td>
              <td>&gt; 700 bar</td>
              <td>-50 bar ê°ì†Œ</td>
              <td>ê³¼ë„í•œ ë³´ì•• â†’ ì§€ì†ì  ì••ë ¥ â†’ í”Œë˜ì‹œ ì•…í™”</td>
            </tr>
            <tr>
              <td><strong>ëƒ‰ê°ì‹œê°„</strong></td>
              <td>&lt; 12ì´ˆ</td>
              <td>+2ì´ˆ ì¦ê°€</td>
              <td>ë¶ˆì¶©ë¶„í•œ ëƒ‰ê° â†’ ì·¨ì¶œ ì‹œ ë³€í˜• â†’ ì¹˜ìˆ˜ ë¶ˆì•ˆì •</td>
            </tr>
          </tbody>
        </table>

        <div class="warning-box" style="margin-top:15px">
          <h3>ğŸ”´ ì¶”ì²œ ì‹¬ê°ë„ êµ¬ë¶„</h3>
          <ul style="margin-left:20px;margin-top:10px">
            <li><strong>ğŸ”´ warning (ë¹¨ê°„ìƒ‰):</strong> ì¦‰ì‹œ ì¡°ì¹˜ í•„ìš” - ì‚¬ì¶œì••ë ¥ ê³¼ë‹¤</li>
            <li><strong>ğŸŸ¡ caution (ë…¸ë€ìƒ‰):</strong> ì£¼ì˜ ë° ê°œì„  ê¶Œì¥ - ì˜¨ë„/ì†ë„/ë³´ì•• ê³¼ë‹¤</li>
            <li><strong>ğŸŸ¢ suggestion (ë…¹ìƒ‰):</strong> í’ˆì§ˆ í–¥ìƒ ì œì•ˆ - ëƒ‰ê°ì‹œê°„ ì¦ê°€</li>
          </ul>
        </div>

        <h4 style="color:#1e3c72;margin-top:30px;margin-bottom:15px">ğŸ“Š ì°¨íŠ¸ ì‹œê°í™” ê¸°ëŠ¥</h4>

        <div class="info-box">
          <h3>ğŸ“ˆ 4ê°€ì§€ ì°¨íŠ¸ ìœ í˜• (Chart.js 4.4.0 ê¸°ë°˜)</h3>
          <table style="margin-top:10px">
            <thead>
              <tr>
                <th>ì°¨íŠ¸ ìœ í˜•</th>
                <th>í‘œì‹œ í•­ëª©</th>
                <th>í™œìš©</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>ì˜¨ë„ ì°¨íŠ¸</strong></td>
                <td>ì‹¤ë¦°ë” ì˜¨ë„ + ê¸ˆí˜• ì˜¨ë„</td>
                <td>ì˜¨ë„ íŠ¸ë Œë“œ ë¶„ì„, ì—´ ê´€ë¦¬ ìµœì í™”</td>
              </tr>
              <tr>
                <td><strong>ì••ë ¥ ì°¨íŠ¸</strong></td>
                <td>ì‚¬ì¶œì••ë ¥ + ë³´ì••</td>
                <td>ì••ë ¥ í”„ë¡œíŒŒì¼ ë¶„ì„, í”Œë˜ì‹œ ë°œìƒ ìƒê´€ê´€ê³„</td>
              </tr>
              <tr>
                <td><strong>ë¬´ê²Œ ì°¨íŠ¸</strong></td>
                <td>ì œí’ˆ ë¬´ê²Œ + ëŸ¬ë„ˆ ë¬´ê²Œ + ì´ ë¬´ê²Œ</td>
                <td>ìƒ· ê°„ ë³€ë™ì„± ë¶„ì„, ê³µì • ì•ˆì •ì„± í‰ê°€</td>
              </tr>
              <tr>
                <td><strong>ì‹œê°„ ì°¨íŠ¸</strong></td>
                <td>ë³´ì••ì‹œê°„ + ëƒ‰ê°ì‹œê°„</td>
                <td>ì‚¬ì´í´ íƒ€ì„ ìµœì í™”, ìƒì‚°ì„± í–¥ìƒ</td>
              </tr>
            </tbody>
          </table>
          <p style="margin-top:10px"><strong>íŠ¹ì§•:</strong> ìµœê·¼ 20ê°œ ë°ì´í„° í‘œì‹œ | ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ | ì¸í„°ë™í‹°ë¸Œ ì¤Œ/íŒ¬ | ë°˜ì‘í˜• ë””ìì¸</p>
        </div>

        <h4 style="color:#1e3c72;margin-top:30px;margin-bottom:15px">âš–ï¸ ë¬´ê²Œ ì¸¡ì • ê³„ì‚°ê¸° ì‚¬ìš©ë²•</h4>

        <div class="success-box">
          <h3>ê³„ì‚° í”„ë¡œì„¸ìŠ¤</h3>
          <ol style="margin-left:20px;margin-top:10px">
            <li><strong>ì œí’ˆ 1ê°œ ë¬´ê²Œ ì¸¡ì •:</strong> ì €ìš¸ë¡œ ë‹¨ì¼ ìºë¹„í‹° ì œí’ˆ ë¬´ê²Œ ì¸¡ì • (g ë‹¨ìœ„)</li>
            <li><strong>ëŸ¬ë„ˆ ë¬´ê²Œ ì¸¡ì •:</strong> ëŸ¬ë„ˆ ì‹œìŠ¤í…œ ì „ì²´ ë¬´ê²Œ ì¸¡ì • (g ë‹¨ìœ„)</li>
            <li><strong>ìºë¹„í‹° ìˆ˜ í™•ì¸:</strong> ê¸°ë³¸ê°’ 36 (í•„ìš” ì‹œ ìˆ˜ì • ê°€ëŠ¥)</li>
            <li><strong>ì¬ë£Œ ë°€ë„ ì…ë ¥:</strong> "Gradeì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°" ë²„íŠ¼ìœ¼ë¡œ ìë™ ì¡°íšŒ ë˜ëŠ” ìˆ˜ë™ ì…ë ¥</li>
            <li><strong>ìë™ ê³„ì‚°:</strong> ì´ ìƒ· ê³„ëŸ‰(g) ë° ìƒ· ìš©ì (cmÂ³) ìë™ í‘œì‹œ</li>
            <li><strong>ë¡œê·¸ ì ìš©:</strong> "â¬‡ï¸ ìµœì‹  ë¡œê·¸ì— ë¬´ê²Œ ì ìš©" ë²„íŠ¼ í´ë¦­</li>
          </ol>
        </div>

        <h4 style="color:#1e3c72;margin-top:30px;margin-bottom:15px">ğŸ“‹ PHA ì¬ë£Œ ë°€ë„ ë°ì´í„°ë² ì´ìŠ¤</h4>

        <table>
          <thead>
            <tr>
              <th>Grade</th>
              <th>ë°€ë„ (g/cmÂ³)</th>
              <th>íŠ¹ì§•</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>CA1180P</strong></td>
              <td>1.25</td>
              <td>ë²”ìš© ë“±ê¸‰</td>
            </tr>
            <tr>
              <td><strong>S1000P</strong></td>
              <td>1.24</td>
              <td>í‘œì¤€ ë“±ê¸‰</td>
            </tr>
            <tr>
              <td><strong>A1000P</strong></td>
              <td>1.23</td>
              <td>ê°œì„  ë“±ê¸‰</td>
            </tr>
            <tr>
              <td><strong>P3HB</strong></td>
              <td>1.25</td>
              <td>ìˆœìˆ˜ PHB</td>
            </tr>
            <tr>
              <td><strong>P3HB4HB</strong></td>
              <td>1.22</td>
              <td>ì½”í´ë¦¬ë¨¸</td>
            </tr>
            <tr>
              <td><strong>PHB</strong></td>
              <td>1.26</td>
              <td>ê³ ë°€ë„ ë“±ê¸‰</td>
            </tr>
            <tr>
              <td><strong>ê¸°ë³¸ê°’</strong></td>
              <td>1.25</td>
              <td>Grade ë¯¸ì„ íƒ ì‹œ</td>
            </tr>
          </tbody>
        </table>

        <h4 style="color:#1e3c72;margin-top:30px;margin-bottom:15px">ğŸ” ê²€ìƒ‰ ë° í•„í„° ê¸°ëŠ¥</h4>

        <div class="info-box">
          <h3>3ê°€ì§€ í•„í„°ë§ ë°©ì‹</h3>
          <table style="margin-top:10px">
            <thead>
              <tr>
                <th>ë°©ì‹</th>
                <th>ì„¤ëª…</th>
                <th>ì‚¬ìš© ì˜ˆì‹œ</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>í‚¤ì›Œë“œ ê²€ìƒ‰</strong></td>
                <td>ë¹„ê³ ë€ í…ìŠ¤íŠ¸ ì‹¤ì‹œê°„ ê²€ìƒ‰</td>
                <td>"í”Œë˜ì‹œ", "ë¶ˆëŸ‰", "ì •ìƒ"</td>
              </tr>
              <tr>
                <td><strong>ë‚ ì§œ ë²”ìœ„</strong></td>
                <td>ì‹œì‘ì¼ ~ ì¢…ë£Œì¼ ë²”ìœ„ ì„ íƒ</td>
                <td>2025-10-01 ~ 2025-10-31</td>
              </tr>
              <tr>
                <td><strong>ë³µí•© í•„í„°</strong></td>
                <td>í‚¤ì›Œë“œ + ë‚ ì§œ ë™ì‹œ ì ìš©</td>
                <td>"í”Œë˜ì‹œ" + 10ì›” ë°ì´í„°</td>
              </tr>
            </tbody>
          </table>
          <p style="margin-top:10px"><strong>íŠ¹ì§•:</strong> í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ ì²˜ë¦¬ (ë¹ ë¥¸ ì‘ë‹µ) | ì‹¤ì‹œê°„ í•„í„°ë§ | "í•„í„° ì´ˆê¸°í™”" ë²„íŠ¼ìœ¼ë¡œ ì „ì²´ ë³µì›</p>
        </div>

        <h4 style="color:#1e3c72;margin-top:30px;margin-bottom:15px">ğŸ“¸ ì‚¬ì§„ ì²¨ë¶€ ê¸°ëŠ¥</h4>

        <div class="info-box">
          <h3>IndexedDB ê¸°ë°˜ ì‚¬ì§„ ì €ì¥</h3>
          <p><strong>ì§€ì› í˜•ì‹:</strong> JPEG, PNG, GIF, WebP | <strong>ìµœëŒ€ í¬ê¸°:</strong> 5MB per file | <strong>ë‹¤ì¤‘ ì—…ë¡œë“œ:</strong> í•œ ë²ˆì— ì—¬ëŸ¬ ì¥ ì²¨ë¶€ ê°€ëŠ¥</p>
          <p style="margin-top:10px"><strong>ì‚¬ìš© ë°©ë²•:</strong></p>
          <ol style="margin-left:20px;margin-top:5px">
            <li>ë¡œê·¸ í…Œì´ë¸”ì˜ "ì‚¬ì§„" ì—´ì—ì„œ "ğŸ“· ì²¨ë¶€" ë²„íŠ¼ í´ë¦­</li>
            <li>íŒŒì¼ ì„ íƒ ë‹¤ì´ì–¼ë¡œê·¸ì—ì„œ ì´ë¯¸ì§€ ì„ íƒ (Ctrl+í´ë¦­ìœ¼ë¡œ ë‹¤ì¤‘ ì„ íƒ)</li>
            <li>ì—…ë¡œë“œ ì™„ë£Œ í›„ "ğŸ“· ì‚¬ì§„ (Nê°œ)" í˜•íƒœë¡œ í‘œì‹œ</li>
            <li>í´ë¦­í•˜ì—¬ ì²¨ë¶€ëœ ì‚¬ì§„ í™•ì¸</li>
          </ol>
        </div>

        <div class="warning-box" style="margin-top:15px">
          <h3>âš ï¸ ì‚¬ì§„ ì €ì¥ ì£¼ì˜ì‚¬í•­</h3>
          <ul style="margin-left:20px;margin-top:10px">
            <li>IndexedDBëŠ” ë¸Œë¼ìš°ì €ë³„ ì €ì¥ ìš©ëŸ‰ ì œí•œì´ ìˆìŠµë‹ˆë‹¤ (ì¼ë°˜ì ìœ¼ë¡œ 50MB+)</li>
            <li>ë¸Œë¼ìš°ì € ìºì‹œ ì‚­ì œ ì‹œ ì‚¬ì§„ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤</li>
            <li>ì¤‘ìš” ì‚¬ì§„ì€ ë³„ë„ ë°±ì—…ì„ ê¶Œì¥í•©ë‹ˆë‹¤</li>
            <li>5MB ì´ˆê³¼ íŒŒì¼ì€ ë¦¬ì‚¬ì´ì¦ˆ íˆ´ ì‚¬ìš© (TinyPNG, ImageOptim ë“±)</li>
          </ul>
        </div>

        <h4 style="color:#1e3c72;margin-top:30px;margin-bottom:15px">ğŸ“‹ í…œí”Œë¦¿ ì‹œìŠ¤í…œ</h4>

        <div class="success-box">
          <h3>ìì£¼ ì‚¬ìš©í•˜ëŠ” ê³µì • ì¡°ê±´ ì €ì¥ ë° ì¬ì‚¬ìš©</h3>
          <p><strong>ì €ì¥ í•­ëª©:</strong> ì‹¤ë¦°ë” ì˜¨ë„, ê¸ˆí˜• ì˜¨ë„, ì‚¬ì¶œì†ë„, ì‚¬ì¶œì••ë ¥, ë³´ì••, ë³´ì••ì‹œê°„, ëƒ‰ê°ì‹œê°„, ì €ì¥ ì¼ì‹œ</p>
          <p style="margin-top:10px"><strong>ì‚¬ìš© ì‚¬ë¡€:</strong></p>
          <ul style="margin-left:20px;margin-top:5px">
            <li>í‘œì¤€ ê³µì • ì¡°ê±´ í…œí”Œë¦¿ (ì˜ˆ: "í‘œì¤€_CA1180P")</li>
            <li>ê³„ì ˆë³„ ì¡°ê±´ í…œí”Œë¦¿ (ì˜ˆ: "ì—¬ë¦„ìš©_ì €ì˜¨", "ê²¨ìš¸ìš©_ê³ ì˜¨")</li>
            <li>ì œí’ˆë³„ ì¡°ê±´ í…œí”Œë¦¿ (ì˜ˆ: "ì œí’ˆA_ìµœì ì¡°ê±´")</li>
          </ul>
          <p style="margin-top:10px"><strong>ê¸°ëŠ¥:</strong></p>
          <ul style="margin-left:20px;margin-top:5px">
            <li><strong>ğŸ’¾ í…œí”Œë¦¿ ì €ì¥:</strong> í˜„ì¬ ìµœì‹  ë¡œê·¸ì˜ ì¡°ê±´ì„ í…œí”Œë¦¿ìœ¼ë¡œ ì €ì¥</li>
            <li><strong>ğŸ“¥ í…œí”Œë¦¿ ë¶ˆëŸ¬ì˜¤ê¸°:</strong> ì €ì¥ëœ í…œí”Œë¦¿ ëª©ë¡ì—ì„œ ì„ íƒí•˜ì—¬ ë¡œê·¸ì— ì ìš©</li>
            <li><strong>ğŸ—‘ï¸ í…œí”Œë¦¿ ê´€ë¦¬:</strong> ì €ì¥ëœ í…œí”Œë¦¿ ëª©ë¡ í™•ì¸ ë° ì‚­ì œ</li>
          </ul>
        </div>

        <h4 style="color:#1e3c72;margin-top:30px;margin-bottom:15px">â“ ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ (FAQ)</h4>

        <div class="warning-box">
          <h3>Q1: ë¡œê·¸ ë°ì´í„°ê°€ ì‚¬ë¼ì¡Œì–´ìš”</h3>
          <p><strong>ì›ì¸:</strong> ë¸Œë¼ìš°ì € ìºì‹œ/ì¿ í‚¤ ì‚­ì œ, ì‹œí¬ë¦¿ ëª¨ë“œ ì‚¬ìš©, ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ "ì‚¬ì´íŠ¸ ë°ì´í„° ì‚­ì œ" ì‹¤í–‰</p>
          <p><strong>í•´ê²°:</strong></p>
          <ul style="margin-left:20px;margin-top:5px">
            <li>ì •ê¸°ì ìœ¼ë¡œ "CSV ë‹¤ìš´ë¡œë“œ" ë²„íŠ¼ìœ¼ë¡œ ë°±ì—…</li>
            <li>ì¤‘ìš” ë°ì´í„°ëŠ” ì™¸ë¶€ ì €ì¥ì†Œì— ë³´ê´€</li>
            <li>ì‹œí¬ë¦¿ ëª¨ë“œ ì‚¬ìš© ìì œ</li>
          </ul>
          <p><strong>ì˜ˆë°©:</strong> ì£¼ 1íšŒ CSV ë°±ì—… ì‹¤í–‰, ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ localStorage ë³´ì¡´ ì„¤ì •</p>
        </div>

        <div class="warning-box" style="margin-top:15px">
          <h3>Q2: ì°¨íŠ¸ê°€ í‘œì‹œë˜ì§€ ì•Šì•„ìš”</h3>
          <p><strong>ì›ì¸:</strong> Chart.js CDN ë¡œë”© ì‹¤íŒ¨, ì¸í„°ë„· ì—°ê²° ë¬¸ì œ, ë¸Œë¼ìš°ì € Canvas API ë¯¸ì§€ì›</p>
          <p><strong>í•´ê²°:</strong></p>
          <ul style="margin-left:20px;margin-top:5px">
            <li>ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸</li>
            <li>F12 â†’ Network íƒ­ì—ì„œ Chart.js CDN ë¡œë”© í™•ì¸</li>
            <li>ë¸Œë¼ìš°ì € ìºì‹œ ì‚­ì œ í›„ ìƒˆë¡œê³ ì¹¨ (Ctrl + Shift + R)</li>
          </ul>
        </div>

        <div class="warning-box" style="margin-top:15px">
          <h3>Q3: CSV ë‹¤ìš´ë¡œë“œ ì‹œ í•œê¸€ì´ ê¹¨ì ¸ìš”</h3>
          <p><strong>ì›ì¸:</strong> ì—‘ì…€ì˜ ê¸°ë³¸ ì¸ì½”ë”©(ANSI)ê³¼ CSV ì¸ì½”ë”©(UTF-8) ë¶ˆì¼ì¹˜</p>
          <p><strong>í•´ê²°:</strong> ì´ ì•±ì€ <strong>UTF-8 BOM</strong>ì„ ìë™ ì¶”ê°€í•˜ì—¬ ì—‘ì…€ì—ì„œ í•œê¸€ ì •ìƒ í‘œì‹œë©ë‹ˆë‹¤</p>
          <p><strong>ê·¸ë˜ë„ ê¹¨ì§ˆ ê²½ìš°:</strong></p>
          <ol style="margin-left:20px;margin-top:5px">
            <li>ë©”ëª¨ì¥ì—ì„œ CSV ì—´ê¸°</li>
            <li>"ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ì €ì¥" â†’ ì¸ì½”ë”©: UTF-8</li>
            <li>ì—‘ì…€ì—ì„œ "ë°ì´í„° â†’ í…ìŠ¤íŠ¸ íŒŒì¼ ê°€ì ¸ì˜¤ê¸°"</li>
          </ol>
        </div>

        <div class="warning-box" style="margin-top:15px">
          <h3>Q4: ì˜¤í”„ë¼ì¸ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œê°€ìš”?</h3>
          <p><strong>ë¶€ë¶„ ê°€ëŠ¥:</strong> ì¼ë‹¨ í˜ì´ì§€ë¥¼ ë¡œë“œí•˜ë©´ ëŒ€ë¶€ë¶„ ê¸°ëŠ¥ ì‚¬ìš© ê°€ëŠ¥</p>
          <p><strong>ì œì•½:</strong> Chart.js CDNì€ ì˜¤í”„ë¼ì¸ì—ì„œ ë¯¸ì‘ë™ (ì°¨íŠ¸ ê¸°ëŠ¥ë§Œ ì œí•œ)</p>
          <p><strong>ì™„ì „ ì˜¤í”„ë¼ì¸ ì‚¬ìš©:</strong> Chart.jsë¥¼ ë¡œì»¬ì— ë³µì‚¬í•˜ì—¬ `&lt;script src="./chart.min.js"&gt;`ë¡œ ë³€ê²½ í•„ìš”</p>
        </div>

        <div class="warning-box" style="margin-top:15px">
          <h3>Q5: ì—¬ëŸ¬ ì‚¬ëŒì´ ë™ì‹œì— ì‚¬ìš©í•  ìˆ˜ ìˆë‚˜ìš”?</h3>
          <p><strong>ë¶ˆê°€ëŠ¥:</strong> localStorageëŠ” ë¸Œë¼ìš°ì €ë³„ë¡œ ë…ë¦½ì </p>
          <p><strong>ëŒ€ì•ˆ:</strong></p>
          <ul style="margin-left:20px;margin-top:5px">
            <li>ê° ì‚¬ìš©ìê°€ CSVë¡œ ë‚´ë³´ë‚´ê¸° â†’ ê³µìœ  í´ë”ì— ì €ì¥</li>
            <li>Google Sheets ë“± í´ë¼ìš°ë“œ ë„êµ¬ì™€ ë³‘í–‰ ì‚¬ìš©</li>
            <li>ì„œë²„ ê¸°ë°˜ ë°±ì—”ë“œ ì¶”ê°€ (í–¥í›„ ê°œì„  ì‚¬í•­)</li>
          </ul>
        </div>

        <h4 style="color:#1e3c72;margin-top:30px;margin-bottom:15px">ğŸŒ ë¸Œë¼ìš°ì € í˜¸í™˜ì„±</h4>

        <table>
          <thead>
            <tr>
              <th>í”Œë«í¼</th>
              <th>ì§€ì› ë¸Œë¼ìš°ì €</th>
              <th>ìµœì†Œ ë²„ì „</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>ë°ìŠ¤í¬í†±</strong></td>
              <td>Chrome, Edge, Firefox, Safari</td>
              <td>Chrome 90+, Edge 90+, Firefox 88+, Safari 14+</td>
            </tr>
            <tr>
              <td><strong>ëª¨ë°”ì¼</strong></td>
              <td>Chrome Android, Safari iOS, Samsung Internet</td>
              <td>Chrome 90+, Safari iOS 14+, Samsung 14+</td>
            </tr>
            <tr>
              <td><strong>ë¯¸ì§€ì›</strong></td>
              <td>Internet Explorer 11</td>
              <td>ES6 ë¯¸ì§€ì›ìœ¼ë¡œ ì¸í•œ í˜¸í™˜ì„± ë¶€ì¡±</td>
            </tr>
          </tbody>
        </table>

        <h4 style="color:#1e3c72;margin-top:30px;margin-bottom:15px">ğŸ“„ ê¸°ìˆ  ìŠ¤íƒ</h4>

        <div class="info-box">
          <h3>í•µì‹¬ ê¸°ìˆ </h3>
          <p><strong>í”„ë¡ íŠ¸ì—”ë“œ:</strong> HTML5, CSS3 (Flexbox, Grid), JavaScript ES6+</p>
          <p><strong>ë¼ì´ë¸ŒëŸ¬ë¦¬:</strong> Chart.js 4.4.0 (CDN)</p>
          <p><strong>ë¸Œë¼ìš°ì € API:</strong> localStorage (ì˜êµ¬ ì €ì¥), IndexedDB (ì‚¬ì§„ ì €ì¥), FileReader API, Blob API</p>
          <p><strong>ë°°í¬:</strong> Netlify (ìë™ ë°°í¬) | <strong>ë¹Œë“œ:</strong> Node.js + build.js</p>
          <p><strong>íŠ¹ì§•:</strong> ì™„ì „ ì •ì  ì›¹ì‚¬ì´íŠ¸ (ì„œë²„ ë¶ˆí•„ìš”) | ë°˜ì‘í˜• ë””ìì¸ (ëª¨ë°”ì¼ ìµœì í™”)</p>
        </div>

        <div class="success-box" style="margin-top:30px">
          <h3>ğŸ“ ì¶”ê°€ ì§€ì› ë° ìƒì„¸ ë¬¸ì„œ</h3>
          <p>ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì „ì²´ ê¸°ìˆ  ë¬¸ì„œ, API ë ˆí¼ëŸ°ìŠ¤, íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê°€ì´ë“œëŠ” í”„ë¡œì íŠ¸ ë£¨íŠ¸ì˜ <strong>README.md</strong> íŒŒì¼ì„ ì°¸ì¡°í•˜ì„¸ìš”.</p>
          <p style="margin-top:10px"><strong>ë²„ì „:</strong> 1.0.0 | <strong>ìµœì¢… ì—…ë°ì´íŠ¸:</strong> 2025-11-01 | <strong>ë¹Œë“œ:</strong> production</p>
        </div>
      </div>
    </section>
  </div>
</div>

<button class="fab" title="Quick Save" onclick="saveEntry()">ğŸ’¾</button>

<!-- Simple modal for reco editor -->
<div id="modal" style="position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;z-index:9999">
  <div style="background:#fff;max-width:720px;width:92%;border-radius:12px;box-shadow:var(--shadow);padding:16px">
    <div class="row" style="justify-content:space-between;align-items:center">
      <h3>ê¶Œì¥ ê°€ì´ë“œ ìˆ˜ì •</h3>
      <button class="btn secondary" onclick="closeModal()">ë‹«ê¸°</button>
    </div>
    <div id="modalBody" class="grid" style="margin-top:8px"></div>
    <div class="row" style="margin-top:8px">
      <button class="btn primary" onclick="saveRecoOverrides()">ì €ì¥</button>
      <button class="btn secondary" onclick="resetOverridesCurrent()">í˜„ì¬ ê³µì • ì´ˆê¸°í™”</button>
      <button class="btn secondary" onclick="resetOverridesAll()">ì „ì²´ ì´ˆê¸°í™”</button>
    </div>
  </div>
</div>

<script>
/* ========= i18n ========= */
const I18N = {
  ko:{title:"PHA ê³µì • ìµœì í™” ë„êµ¬",tab_proc:"ê³µì • ì¡°ê±´",tab_ts:"íŠ¸ëŸ¬ë¸”ìŠˆíŒ…",tab_hist:"ì´ë ¥ ê´€ë¦¬",tab_ana:"ë°ì´í„° ë¶„ì„",tab_calc:"ê³„ì‚°ê¸°",tab_props:"ë¬¼ì„± DB",tab_photos:"ì‚¬ì§„",tab_flash:"í”Œë˜ì‹œ ì œì–´",
      series:"ìƒ˜í”Œ ì‹œë¦¬ì¦ˆ",process:"ê°€ê³µ ìœ í˜•",notes:"ğŸ“ íŠ¹ì´ì‚¬í•­ ë©”ëª¨",save:"ì €ì¥ ë° ë¶„ì„",export:"ë°ì´í„° ë‚´ë³´ë‚´ê¸°",reset:"ì´ˆê¸°í™”",
      param:"íŒŒë¼ë¯¸í„°",current:"í˜„ì¬ê°’",range:"ê¶Œì¥ ë²”ìœ„",status:"ìƒíƒœ",ok:"ì •ìƒ",warn:"ì£¼ì˜",crit:"ìœ„í—˜",when:"ë‚ ì§œ/ì‹œê°„",h_grade:"ìƒ˜í”Œ",h_proc:"ê³µì •",h_key:"ì£¼ìš” íŒŒë¼ë¯¸í„°",h_result:"ê²°ê³¼",h_note:"ë©”ëª¨",
      ana_head:"ë°ì´í„° ë¶„ì„",saved:"ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.",last:"ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸",resetQ:"ëª¨ë“  ì…ë ¥ì„ ì´ˆê¸°í™”í• ê¹Œìš”?",
      photos_head:"ì‚¬ì§„ ê´€ë¦¬"
  },
  en:{title:"PHA Process Optimizer",tab_proc:"Process Conditions",tab_ts:"Troubleshooting",tab_hist:"History",tab_ana:"Data Analysis",tab_calc:"Calculators",tab_props:"Materials DB",tab_photos:"Photos",tab_flash:"Flash Control",
      series:"Sample Series",process:"Process Type",notes:"ğŸ“ Process Notes",save:"Save & Analyze",export:"Export Data",reset:"Reset",
      param:"Parameter",current:"Current",range:"Recommended",status:"Status",ok:"Normal",warn:"Warning",crit:"Critical",when:"Date/Time",h_grade:"Sample",h_proc:"Process",h_key:"Main Parameters",h_result:"Result",h_note:"Memo",
      ana_head:"Data Analysis",saved:"Saved successfully.",last:"Last Update",resetQ:"Reset all inputs?",
      photos_head:"Photo Manager"
  }
};
let LANG = 'ko';

/* ========= Base profiles ========= */
const BASE={PHA_SEMI:'PHA_SEMI',PHA_AMOR:'PHA_AMOR',PLA:'PLA',PBAT:'PBAT',PBS:'PBS',PBSA:'PBSA',PHA_PLA:'PHA_PLA',PHA_PBS:'PHA_PBS',PHA_PBAT:'PHA_PBAT'};

/* ========= Grade list ========= */
const GRADES=[
  {value:'S1000P',label:'S1000P (Semi-crystalline, 2â€“5% 4HB)',profile:BASE.PHA_SEMI},
  {value:'A1000P',label:'A1000P (Amorphous, 30% 4HB)',profile:BASE.PHA_AMOR},
  {value:'CB0400A',label:'CB0400A (P34HB series) â€“ ë‚´ë¶€ê°€ì´ë“œ',profile:BASE.PHA_SEMI},
  {value:'CB0104A',label:'CB0104A (P34HB series) â€“ ë‚´ë¶€ê°€ì´ë“œ',profile:BASE.PHA_AMOR},
  /* PLA/aPHA family (from website TDS list mentioned) */
  {value:'CA1180P',label:'CA1180P (PLA/aPHA â€“ Injection)',profile:BASE.PHA_PLA},
  {value:'CA1170A',label:'CA1170A (PLA/aPHA â€“ Injection)',profile:BASE.PHA_PLA},
  {value:'CA1165A',label:'CA1165A (PLA/aPHA â€“ Injection)',profile:BASE.PHA_PLA},
  {value:'CA1670P',label:'CA1670P (PLA/aPHA â€“ Sheet/Blow Molding)',profile:BASE.PHA_PLA},
  {value:'CA1680', label:'CA1680 (PLA/aPHA â€“ Sheet/Blow Molding)',profile:BASE.PHA_PLA},
  {value:'CA1270P',label:'CA1270P (PLA/aPHA â€“ Sheet)',profile:BASE.PHA_PLA},
  /* blends + commodity */
  {value:'PLA_aPHA_90_10',label:'PLA/aPHA (A1000P 10%)',profile:BASE.PHA_PLA},
  {value:'PLA_aPHA_80_20',label:'PLA/aPHA (A1000P 20%)',profile:BASE.PHA_PLA},
  {value:'PHA_PBSA_70_30',label:'PHA/PBSA (70/30)',profile:BASE.PBSA},
  {value:'PHA_PBSA_50_50',label:'PHA/PBSA (50/50)',profile:BASE.PBSA},
  {value:'PHA_PBS_70_30',label:'PHA/PBS (70/30)',profile:BASE.PHA_PBS},
  {value:'PHA_PBS_50_50',label:'PHA/PBS (50/50)',profile:BASE.PHA_PBS},
  {value:'PHA_PBAT_70_30',label:'PHA/PBAT (70/30)',profile:BASE.PHA_PBAT},
  {value:'PHA_PBAT_50_50',label:'PHA/PBAT (50/50)',profile:BASE.PHA_PBAT},
  {value:'PLA',label:'PLA',profile:BASE.PLA},
  {value:'PBAT',label:'PBAT',profile:BASE.PBAT},
  {value:'PBS',label:'PBS',profile:BASE.PBS},
  {value:'PBSA',label:'PBSA',profile:BASE.PBSA},
];

/* ========= Recommended ranges ========= */
const GRADE_JSON={"CA1180P":"data/grades/CA1180P_talc10_wax0p3.json"};
const RECO={
  [BASE.PHA_SEMI]:{
    extrusion:{zone1:[140,155],zone2:[150,165],zone3:[160,170],zone4:[165,175],die:[165,180],screwRPM:[40,90],meltPressBar:[60,150],coolingRoll:[15,25],lineSpeed:[5,30]},
    sheet:{zone1:[140,155],zone2:[150,165],zone3:[160,170],zone4:[165,175],zone5:[165,180],die:[170,180],chillTop:[15,25],chillMid:[15,25],chillBot:[15,25],rollRPM:[10,40],lineSpeed:[5,30],targetThickness:[200,2000],meltPressBar:[60,150]},
    injection:{barrel1:[150,160],barrel2:[155,165],barrel3:[160,170],nozzle:[165,175],mold:[25,45],injSpeed:[30,120],injPressMPa:[60,120],packPressMPa:[30,70],packTime:[5,20],coolTime:[10,40],backPressBar:[30,80],screwRPM:[30,100],hold1P:[30,60],hold1T:[2,10],hold2P:[20,50],hold2T:[2,10]},
    blownfilm:{zone1:[145,155],zone2:[155,165],zone3:[160,170],zone4:[165,175],die:[165,175],bur:[1.8,3.0],flh:[200,600],takeup:[10,60],dieGap:[0.8,1.5],meltPressBar:[80,180],airTemp:[15,25]},
    blowmolding:{zone1:[150,160],zone2:[155,165],zone3:[160,170],head:[165,175],die:[165,175],accHead:[165,175],blowPressBar:[6,12],preBlowBar:[2,6],mold:[20,35],coolTime:[20,80]},
    castfilm:{zone1:[150,160],zone2:[155,165],zone3:[160,170],die:[170,180],chillTop:[10,18],lineSpeed:[10,50],targetThickness:[20,200],meltPressBar:[60,150]}
  },
  [BASE.PHA_AMOR]:{
    extrusion:{zone1:[130,145],zone2:[140,155],zone3:[150,165],zone4:[155,170],die:[160,170],screwRPM:[40,90],meltPressBar:[50,130],coolingRoll:[15,25],lineSpeed:[5,30]},
    sheet:{zone1:[130,145],zone2:[140,155],zone3:[150,160],zone4:[155,165],zone5:[155,170],die:[160,170],chillTop:[15,25],chillMid:[15,25],chillBot:[15,25],rollRPM:[10,35],lineSpeed:[5,30],targetThickness:[200,2000],meltPressBar:[50,130]},
    injection:{barrel1:[140,155],barrel2:[150,160],barrel3:[155,165],nozzle:[160,170],mold:[20,40],injSpeed:[30,120],injPressMPa:[50,100],packPressMPa:[25,60],packTime:[5,20],coolTime:[8,35],backPressBar:[20,60],screwRPM:[30,90],hold1P:[25,55],hold1T:[2,10],hold2P:[15,45],hold2T:[2,10]},
    blownfilm:{zone1:[135,145],zone2:[145,155],zone3:[150,160],zone4:[155,165],die:[160,165],bur:[1.8,3.0],flh:[200,600],takeup:[10,60],dieGap:[0.8,1.5],meltPressBar:[70,160],airTemp:[15,25]},
    blowmolding:{zone1:[140,150],zone2:[150,160],zone3:[155,165],head:[160,170],die:[160,170],accHead:[160,170],blowPressBar:[6,12],preBlowBar:[2,6],mold:[20,35],coolTime:[20,70]},
    castfilm:{zone1:[140,150],zone2:[145,155],zone3:[150,160],die:[160,170],chillTop:[10,18],lineSpeed:[10,50],targetThickness:[20,200],meltPressBar:[50,130]}
  },
  [BASE.PLA]:{
    extrusion:{zone1:[170,180],zone2:[180,190],zone3:[190,200],zone4:[195,205],die:[195,210],screwRPM:[40,80],meltPressBar:[70,150],coolingRoll:[15,25],lineSpeed:[5,30]},
    sheet:{zone1:[170,180],zone2:[180,190],zone3:[190,200],zone4:[195,205],zone5:[195,210],die:[200,210],chillTop:[15,25],chillMid:[15,25],chillBot:[15,25],rollRPM:[10,35],lineSpeed:[5,25],targetThickness:[200,2000],meltPressBar:[70,150]},
    injection:{barrel1:[180,190],barrel2:[190,200],barrel3:[195,205],nozzle:[200,210],mold:[20,35],injSpeed:[30,120],injPressMPa:[70,130],packPressMPa:[40,80],packTime:[5,20],coolTime:[10,40],backPressBar:[30,90],screwRPM:[30,90],hold1P:[40,80],hold1T:[2,10],hold2P:[30,70],hold2T:[2,10]},
    blownfilm:{zone1:[175,185],zone2:[185,195],zone3:[190,200],zone4:[195,205],die:[200,210],bur:[1.8,3.0],flh:[200,600],takeup:[10,60],dieGap:[0.8,1.5],meltPressBar:[80,180],airTemp:[15,25]},
    blowmolding:{zone1:[175,185],zone2:[185,195],zone3:[190,200],head:[200,210],die:[200,210],accHead:[200,210],blowPressBar:[6,12],preBlowBar:[2,6],mold:[15,25],coolTime:[20,80]},
    castfilm:{zone1:[180,190],zone2:[190,200],zone3:[195,205],die:[200,210],chillTop:[10,18],lineSpeed:[10,40],targetThickness:[20,200],meltPressBar:[70,150]}
  },
  [BASE.PBAT]:{
    extrusion:{zone1:[110,125],zone2:[120,135],zone3:[130,145],zone4:[135,150],die:[135,150],screwRPM:[40,90],meltPressBar:[50,120],coolingRoll:[15,25],lineSpeed:[5,30]},
    sheet:{zone1:[110,125],zone2:[120,135],zone3:[130,145],zone4:[135,150],zone5:[135,150],die:[135,150],chillTop:[15,25],chillMid:[15,25],chillBot:[15,25],rollRPM:[10,35],lineSpeed:[5,30],targetThickness:[200,2000],meltPressBar:[50,120]},
    injection:{barrel1:[120,130],barrel2:[130,140],barrel3:[135,145],nozzle:[140,150],mold:[20,35],injSpeed:[30,120],injPressMPa:[50,100],packPressMPa:[25,60],packTime:[5,18],coolTime:[8,30],backPressBar:[20,60],screwRPM:[30,90],hold1P:[25,60],hold1T:[2,10],hold2P:[15,45],hold2T:[2,10]},
    blownfilm:{zone1:[115,125],zone2:[125,135],zone3:[135,145],zone4:[140,150],die:[140,150],bur:[1.8,3.0],flh:[200,600],takeup:[10,60],dieGap:[0.8,1.5],meltPressBar:[70,150],airTemp:[15,25]},
    blowmolding:{zone1:[120,130],zone2:[130,140],zone3:[135,145],head:[140,150],die:[140,150],accHead:[140,150],blowPressBar:[5,10],preBlowBar:[2,5],mold:[20,30],coolTime:[20,60]},
    castfilm:{zone1:[120,130],zone2:[130,140],zone3:[135,145],die:[140,150],chillTop:[10,18],lineSpeed:[10,40],targetThickness:[20,200],meltPressBar:[50,120]}
  },
  [BASE.PBS]:{
    extrusion:{zone1:[140,150],zone2:[150,160],zone3:[155,165],zone4:[160,170],die:[160,170],screwRPM:[40,80],meltPressBar:[60,130],coolingRoll:[15,25],lineSpeed:[5,30]},
    sheet:{zone1:[140,150],zone2:[150,160],zone3:[155,165],zone4:[160,170],zone5:[160,170],die:[165,170],chillTop:[15,25],chillMid:[15,25],chillBot:[15,25],rollRPM:[10,35],lineSpeed:[5,30],targetThickness:[200,2000],meltPressBar:[60,130]},
    injection:{barrel1:[150,160],barrel2:[155,165],barrel3:[160,170],nozzle:[165,170],mold:[20,35],injSpeed:[30,120],injPressMPa:[60,110],packPressMPa:[30,70],packTime:[5,18],coolTime:[8,35],backPressBar:[20,60],screwRPM:[30,90],hold1P:[35,70],hold1T:[2,10],hold2P:[25,60],hold2T:[2,10]},
    blownfilm:{zone1:[145,155],zone2:[150,160],zone3:[155,165],zone4:[160,170],die:[165,170],bur:[1.8,3.0],flh:[200,600],takeup:[10,60],dieGap:[0.8,1.5],meltPressBar:[70,150],airTemp:[15,25]},
    blowmolding:{zone1:[150,160],zone2:[155,165],zone3:[160,170],head:[165,170],die:[165,170],accHead:[165,170],blowPressBar:[6,12],preBlowBar:[2,6],mold:[20,30],coolTime:[20,70]},
    castfilm:{zone1:[150,160],zone2:[155,165],zone3:[160,170],die:[165,170],chillTop:[10,18],lineSpeed:[10,40],targetThickness:[20,200],meltPressBar:[60,130]}
  },
  [BASE.PBSA]:{
    extrusion:{zone1:[125,135],zone2:[135,145],zone3:[140,150],zone4:[145,155],die:[150,160],screwRPM:[40,80],meltPressBar:[50,120],coolingRoll:[15,25],lineSpeed:[5,30]},
    sheet:{zone1:[125,135],zone2:[135,145],zone3:[140,150],zone4:[145,155],zone5:[145,160],die:[150,160],chillTop:[15,25],chillMid:[15,25],chillBot:[15,25],rollRPM:[10,35],lineSpeed:[5,30],targetThickness:[200,2000],meltPressBar:[50,120]},
    injection:{barrel1:[135,145],barrel2:[140,150],barrel3:[145,155],nozzle:[150,160],mold:[20,35],injSpeed:[30,120],injPressMPa:[50,90],packPressMPa:[25,60],packTime:[5,18],coolTime:[8,30],backPressBar:[20,60],screwRPM:[30,90],hold1P:[25,55],hold1T:[2,10],hold2P:[15,45],hold2T:[2,10]},
    blownfilm:{zone1:[130,140],zone2:[140,150],zone3:[145,155],zone4:[150,160],die:[150,160],bur:[1.8,3.0],flh:[200,600],takeup:[10,60],dieGap:[0.8,1.5],meltPressBar:[60,140],airTemp:[15,25]},
    blowmolding:{zone1:[135,145],zone2:[140,150],zone3:[145,155],head:[150,160],die:[150,160],accHead:[150,160],blowPressBar:[5,10],preBlowBar:[2,5],mold:[20,30],coolTime:[20,60]},
    castfilm:{zone1:[135,145],zone2:[140,150],zone3:[145,155],die:[150,160],chillTop:[10,18],lineSpeed:[10,40],targetThickness:[20,200],meltPressBar:[50,120]}
  },
  [BASE.PHA_PLA]:{},[BASE.PHA_PBS]:{},[BASE.PHA_PBAT]:{}
};

/* ========= Schemas ========= */
function f(id,ko,en,unit){return {id,ko,en,unit};}
const SCHEMAS={
  extrusion:[f('zone1','Zone 1 ì˜¨ë„','Zone 1 Temp','Â°C'),f('zone2','Zone 2 ì˜¨ë„','Â°C'),
             f('zone3','Zone 3 ì˜¨ë„','Â°C'),f('zone4','Zone 4 ì˜¨ë„','Â°C'),f('die','ë‹¤ì´ ì˜¨ë„','Â°C'),
             f('screwRPM','ìŠ¤í¬ë¥˜ ì†ë„','RPM'),f('meltPressBar','ìš©ìœµ ì••ë ¥','bar'),
             f('coolingRoll','ì¿¨ë§ë¡¤ ì˜¨ë„','Â°C'),f('lineSpeed','ë¼ì¸ ì†ë„','m/min')],
  sheet:[f('zone1','Zone 1 ì˜¨ë„','Â°C'),f('zone2','Zone 2 ì˜¨ë„','Â°C'),f('zone3','Zone 3 ì˜¨ë„','Â°C'),
         f('zone4','Zone 4 ì˜¨ë„','Â°C'),f('zone5','Zone 5 ì˜¨ë„','Â°C'),f('die','ë‹¤ì´ ì˜¨ë„','Â°C'),
         f('chillTop','ì¹ ë¡¤ ìƒë‹¨','Â°C'),f('chillMid','ì¹ ë¡¤ ì¤‘ë‹¨','Â°C'),f('chillBot','ì¹ ë¡¤ í•˜ë‹¨','Â°C'),
         f('rollRPM','ë¡¤ íšŒì „ìˆ˜','RPM'),f('lineSpeed','ë¼ì¸ ì†ë„','m/min'),f('targetThickness','ëª©í‘œ ë‘ê»˜','Âµm'),f('meltPressBar','ìš©ìœµ ì••ë ¥','bar')],
  injection:[f('barrel1','ë°°ëŸ´ 1','Â°C'),f('barrel2','ë°°ëŸ´ 2','Â°C'),f('barrel3','ë°°ëŸ´ 3','Â°C'),f('nozzle','ë…¸ì¦','Â°C'),
             f('mold','ê¸ˆí˜• ì˜¨ë„','Â°C'),f('injSpeed','ì‚¬ì¶œ ì†ë„','mm/s'),f('injPressMPa','ì‚¬ì¶œ ì••ë ¥','MPa'),f('packPressMPa','ë³´ì••','MPa'),
             f('packTime','ë³´ì•• ì‹œê°„','s'),f('coolTime','ëƒ‰ê° ì‹œê°„','s'),f('backPressBar','ë°±í”„ë ˆì…”','bar'),f('screwRPM','ìŠ¤í¬ë¥˜ íšŒì „ìˆ˜','RPM'),
             f('hold1P','ë³´ì••1 ì••ë ¥','MPa'),f('hold1T','ë³´ì••1 ì‹œê°„','s'),f('hold2P','ë³´ì••2 ì••ë ¥','MPa'),f('hold2T','ë³´ì••2 ì‹œê°„','s')],
  blownfilm:[f('zone1','Zone 1 ì˜¨ë„','Â°C'),f('zone2','Zone 2 ì˜¨ë„','Â°C'),f('zone3','Zone 3 ì˜¨ë„','Â°C'),f('zone4','Zone 4 ì˜¨ë„','Â°C'),
             f('die','ë‹¤ì´ ì˜¨ë„','Â°C'),f('bur','BUR','â€“'),f('flh','FLH','mm'),f('takeup','í…Œì´í¬ì—… ì†ë„','m/min'),
             f('dieGap','ë‹¤ì´ ê°­','mm'),f('meltPressBar','ìš©ìœµ ì••ë ¥','bar'),f('airTemp','ëƒ‰ê° ê³µê¸° ì˜¨ë„','Â°C')],
  blowmolding:[f('zone1','Zone 1 ì˜¨ë„','Â°C'),f('zone2','Zone 2 ì˜¨ë„','Â°C'),f('zone3','Zone 3 ì˜¨ë„','Â°C'),
               f('head','í—¤ë“œ ì˜¨ë„','Â°C'),f('die','ë‹¤ì´ ì˜¨ë„','Â°C'),f('accHead','ì–´íë®¬ë ˆì´í„° í—¤ë“œ','Â°C'),
               f('blowPressBar','ë¸”ë¡œìš° ì••ë ¥','bar'),f('preBlowBar','í”„ë¦¬ë¸”ë¡œìš° ì••ë ¥','bar'),f('mold','ê¸ˆí˜• ì˜¨ë„','Â°C'),f('coolTime','ëƒ‰ê° ì‹œê°„','s')],
  castfilm:[f('zone1','Zone 1 ì˜¨ë„','Â°C'),f('zone2','Zone 2 ì˜¨ë„','Â°C'),f('zone3','Zone 3 ì˜¨ë„','Â°C'),
            f('die','ë‹¤ì´ ì˜¨ë„','Â°C'),f('chillTop','ì¹ ë¡¤ ì˜¨ë„','Â°C'),f('lineSpeed','ë¼ì¸ ì†ë„','m/min'),f('targetThickness','ëª©í‘œ ë‘ê»˜','Âµm'),f('meltPressBar','ìš©ìœµ ì••ë ¥','bar')]
};

/* ========= Troubleshooting content ========= */
const TS={
  ko:[{title:"ğŸ”´ í‘œë©´ ê²°í•¨",items:[["ìƒ¤í¬ìŠ¤í‚¨","ë‹¤ì´ ì˜¨ë„ +5~10Â°C, ì••ë ¥ ë‚®ì¶¤, ê°€ê³µì¡°ì œ ê²€í† "],["ë©œíŠ¸ í”„ë™ì²˜","ì „ë‹¨ì†ë„ ë‚®ì¶¤, ì˜¨ë„ í”„ë¡œíŒŒì¼ ìµœì í™”, ë‹¤ì´ ê°­ ì¡°ì •"],["ë‹¤ì´ ë¼ì¸","ë‹¤ì´ ì²­ì†Œ/ì˜¨ë„ ê· ì¼í™”, ì••ë ¥ ì•ˆì •í™”"]]},
      {title:"ğŸŸ¡ ê¸°ê³„ì  ë¬¼ì„± ì €í•˜",items:[["ì¸ì¥ê°•ë„ ë¶€ì¡±","ë¶„ìëŸ‰ ì €í•˜ í™•ì¸, ê°€ê³µì˜¨ë„â†“, ì²´ë¥˜ì‹œê°„â†“"],["ì‹ ìœ¨ ê°ì†Œ","ê°€ì†Œì œ/ë¸”ë Œë“œ ë¹„ìœ¨ ì¡°ì •, ëƒ‰ê° ì†ë„ ìµœì í™”"],["ì¶©ê²© ì €í•˜","ìƒìš©í™”ì œ, ì–´ë‹ë§"]]},
      {title:"ğŸ”µ ê°€ê³µì„± ë¬¸ì œ",items:[["í† ì¶œ ë¶ˆì•ˆì •","ìŠ¤í¬ë¥˜ ì†ë„ ì•ˆì •í™”, ê±´ì¡°/ê³µê¸‰ í™•ì¸, ì˜¨ë„ ê· ì¼í™”"],["ì••ë ¥ ë³€ë™","ìŠ¤í¬ë¥˜/í•„í„° ì ê²€, ê±´ì¡°/ìˆ˜ë¶„ê´€ë¦¬"],["ìƒ‰ìƒ ë¶ˆê· ì¼","MB ë¶„ì‚° ê°œì„ , í˜¼í•© ì‹œê°„ ì¦ê°€, ì˜¨ë„ ì¬ì¡°ì •"]]},
      {title:"ğŸŸ¢ ì—´ì  íŠ¹ì„± ì´ìŠˆ",items:[["ì—´ë³€í˜• ë‚®ìŒ","ê²°ì •í™”ë„â†‘, í•µì œ, ì–´ë‹ë§ ìµœì í™”"],["ìš©ìœµ ê±°ë™ ì´ìƒ","DSC, ë¸”ë Œë“œ ê· ì¼ì„± í™•ì¸, ì´ë ¥ ê²€í† "],["ì—´ì•ˆì •ì„± ë¶€ì¡±","AO íŒ¨í‚¤ì§€ ë³´ê°•, ì˜¨ë„/ì²´ë¥˜ ìµœì†Œí™”"]]}],
  en:[{title:"ğŸ”´ Surface Defects",items:[["Sharkskin","Raise die temp +5â€“10Â°C, reduce pressure, processing aid"],["Melt Fracture","Lower shear rate, optimize temp profile, adjust die gap"],["Die Lines","Clean die / improve temperature uniformity / stabilize pressure"]]},
      {title:"ğŸŸ¡ Mechanical",items:[["Low Tensile","Check MW degradation; lower temp; shorten residence"],["Low Elongation","Tune plasticizer/blend; optimize cooling"],["Low Impact","Compatibilizer; anneal"]]},
      {title:"ğŸ”µ Processability",items:[["Output Instability","Stabilize screw speed; dry feed; improve uniformity"],["Pressure Variation","Inspect screw/filter; drying & moisture control"],["Color Inconsistency","Improve MB dispersion; longer mixing; retune"]]},
      {title:"ğŸŸ¢ Thermal",items:[["Low HDT","Increase crystallinity; nucleating agent; anneal"],["Abnormal Melting","DSC; blend uniformity; history review"],["Poor Thermal Stability","Reinforce AO; minimize temp/residence"]]}
]};

/* ========= Materials DB (editable, import/export) ========= */
const MAT_DEFAULT={
  "S1000P":{"density_g_cm3":1.24,"MFR_g_10min_190_2_16":null,"Tg_C":null,"Tm_C":170,"Tc_C":null,"tensile_MPa":null,"elongation_%":null,"izod_kJ_m2":null,"HDT_C":null},
  "A1000P":{"density_g_cm3":1.18,"MFR_g_10min_190_2_16":null,"Tg_C":null,"Tm_C":160,"Tc_C":null,"tensile_MPa":null,"elongation_%":null,"izod_kJ_m2":null,"HDT_C":null},
  "CB0400A":{},"CB0104A":{},
  "CA1180P":{"density_g_cm3":1.26,"MFR_g_10min_190_2_16":7,"Tg_C":-15,"Tm_C":162,"tensile_MPa":52,"elongation_%":23,"izod_kJ_m2":63,"HDT_C":51},"CA1170A":{},"CA1165A":{},"CA1670P":{},"CA1680":{},"CA1270P":{}
};
const MAT_KEY_ORDER=[
  ["density_g_cm3","ë°€ë„","g/cmÂ³"],["MFR_g_10min_190_2_16","MFR","g/10min @190Â°C/2.16kg"],
  ["Tg_C","Tg","Â°C"],["Tm_C","Tm","Â°C"],["Tc_C","Tc","Â°C"],
  ["tensile_MPa","ì¸ì¥ê°•ë„","MPa"],["elongation_%","ì‹ ìœ¨","%"],["izod_kJ_m2","ì•„ì´ì¡°ë“œ","kJ/mÂ²"],["HDT_C","HDT","Â°C"]
];

/* ========= Utilities ========= */
function $(id){return document.getElementById(id)}; function allSel(s){return Array.from(document.querySelectorAll(s))};
function setView(v){document.querySelector('.container').style.maxWidth=(v==='mobile'?'100%':'1400px');$('btnDesktop').classList.toggle('active',v==='desktop');$('btnMobile').classList.toggle('active',v==='mobile')}
function i18nApply(){allSel('[data-i18n]').forEach(el=>{const k=el.dataset.i18n; if(I18N[LANG][k]) el.textContent=I18N[LANG][k];});
  $('notes').placeholder=(LANG==='ko'?'ê°€ê³µ ì¤‘ íŠ¹ì´ì‚¬í•­/ê°œì„  ì•„ì´ë””ì–´ ê¸°ë¡':'Record anomalies or ideas');
  $('tsHint').textContent=(LANG==='ko'?I18N.ko.last:I18N.en.last)+': '+new Date().toLocaleString(LANG==='ko'?'ko-KR':'en-US'); renderTS(); renderHistory(); refreshParamTable(); renderMat()}
function renderTS(){
  const cont = $('tsContainer');
  cont.innerHTML = '';
  // Use dynamic troubleshooting data if available
  if (window.tsData && Array.isArray(window.tsData)) {
    const groups = {};
    window.tsData.forEach(item => {
      const proc = item.process || 'general';
      if (!groups[proc]) groups[proc] = [];
      groups[proc].push(item);
    });
    Object.keys(groups).forEach(proc => {
      const card = document.createElement('div');
      card.className = 'card';
      const procName = proc.charAt(0).toUpperCase() + proc.slice(1);
      let html = `<h3 style="margin-bottom:8px">${procName}</h3>`;
      groups[proc].forEach(item => {
        html += `<h4 style="margin-top:12px">${item.symptom}</h4>`;
        if (item.likely_causes && item.likely_causes.length) {
          html += `<strong>Likely causes:</strong><ul>` + item.likely_causes.map(x => `<li>${x}</li>`).join('') + `</ul>`;
        }
        if (item.diagnostics) {
          html += `<strong>Diagnostics:</strong><p>${item.diagnostics}</p>`;
        }
        if (item.quick_fixes && item.quick_fixes.length) {
          html += `<strong>Quick fixes:</strong><ul>` + item.quick_fixes.map(x => `<li>${x}</li>`).join('') + `</ul>`;
        }
        if (item.root_fixes && item.root_fixes.length) {
          html += `<strong>Root fixes:</strong><ul>` + item.root_fixes.map(x => `<li>${x}</li>`).join('') + `</ul>`;
        }
        if (item.control_knobs && item.control_knobs.length) {
          html += `<strong>Control knobs:</strong><p>${item.control_knobs.join(', ')}</p>`;
        }
        if (item.notes) {
          html += `<p><em>${item.notes}</em></p>`;
        }
      });
      card.innerHTML = html;
      cont.appendChild(card);
    });
    return;
  }
  // fallback to legacy categories if no dynamic data
  for (const b of TS[LANG]) {
    const d = document.createElement('div');
    d.className = 'card';
    let html = `<h3 style="margin-bottom:8px">${b.title}</h3><ul style="list-style:none;padding-left:0">`;
    for (const [n, s] of b.items) {
      html += `<li style="margin:6px 0"><b>${n}:</b> ${s}</li>`;
    }
    html += '</ul>';
    d.innerHTML = html;
    cont.appendChild(d);
  }
}

/* ========= Grade & profile helpers ========= */
function buildGradeOptions(){const sel=$('grade'); sel.innerHTML=''; GRADES.forEach(g=>{const o=document.createElement('option');o.value=g.value;o.textContent=g.label;sel.appendChild(o)});
  const msel=$('mat_grade'); msel.innerHTML=''; GRADES.forEach(g=>{const o=document.createElement('option');o.value=g.value;o.textContent=g.value;msel.appendChild(o)});}
function profileOf(grade){const g=GRADES.find(x=>x.value===grade); return g?g.profile:BASE.PHA_SEMI}
function mixReco(a,b,alpha){const out={}; for(const k of Object.keys(a)){if(!b[k]){out[k]=a[k];continue} out[k]=[ Math.round(a[k][0]*(1-alpha)+b[k][0]*alpha), Math.round(a[k][1]*(1-alpha)+b[k][1]*alpha) ];} return out}
function getReco(profile,proc){
  // overrides
  const ov = JSON.parse(localStorage.getItem('reco_overrides')||'{}');
  let base;
  if(RECO[profile] && RECO[profile][proc]) base=RECO[profile][proc];
  else if(profile===BASE.PHA_PLA) base=mixReco(RECO[BASE.PHA_AMOR][proc],RECO[BASE.PLA][proc],.5);
  else if(profile===BASE.PHA_PBS) base=mixReco(RECO[BASE.PHA_SEMI][proc],RECO[BASE.PBS][proc],.5);
  else if(profile===BASE.PHA_PBAT) base=mixReco(RECO[BASE.PHA_AMOR][proc],RECO[BASE.PBAT][proc],.5);
  else base=RECO[BASE.PHA_SEMI][proc];
  // apply overrides
  const key=profile+'__'+proc; if(ov[key]){base={...base,...ov[key]}}
  return base;
}

/* ========= Dynamic form ========= */
function rebuildForm(){
  const proc=$('process').value, grade=$('grade').value, profile=profileOf(grade), schema=SCHEMAS[proc], rec=getReco(profile,proc);
  const wrap=$('dynamicFields'); wrap.innerHTML='';
  for(const fld of schema){
    const id='f_'+fld.id, label = fld.ko + (fld.unit?` (${fld.unit})`:''); const div=document.createElement('div'); div.className='group';
    div.innerHTML=`<label for="${id}">${label}</label><input id="${id}" type="number" inputmode="decimal" placeholder="${rec[fld.id]?rec[fld.id][0]+'-'+rec[fld.id][1]:''}">`;
    wrap.appendChild(div);
  }
  refreshParamTable();
}

/* ========= Table/status ========= */
function statusOf(v,r){if(v===''||v==null||isNaN(v)) return 'warn'; const x=parseFloat(v); if(x>=r[0]&&x<=r[1])return'ok'; if(x<r[0]-10||x>r[1]+10)return'crit'; return'warn'}
function refreshParamTable(){
  const proc=$('process').value, grade=$('grade').value, profile=profileOf(grade), schema=SCHEMAS[proc], rec=getReco(profile,proc);
  const tb=$('paramTable'); tb.innerHTML='';
  schema.forEach(f=>{const val=$('f_'+f.id)?.value||''; const range=rec[f.id]||['-','-']; const s=statusOf(val,range);
    const cls=s==='ok'?'ok':(s==='crit'?'crit':'warn'); const sText=(LANG==='ko'?(s==='ok'?'ì •ìƒ':s==='crit'?'ìœ„í—˜':'ì£¼ì˜'):(s==='ok'?'Normal':s==='crit'?'Critical':'Warning'));
    const tr=document.createElement('tr'); tr.innerHTML=`<td>${f.ko}${f.unit?' ('+f.unit+')':''}</td><td>${val||'-'}</td><td>${range[0]}-${range[1]}</td><td><span class="badge ${cls}">${sText}</span></td>`; tb.appendChild(tr);
  });
}

/* ========= Save/History/Import/Export ========= */
function collectEntry(){const proc=$('process').value, grade=$('grade').value, schema=SCHEMAS[proc]; const data={ts:new Date().toISOString(),proc,grade,params:{},notes:$('notes').value};
  schema.forEach(f=> data.params[f.id]=$('f_'+f.id)?.value||''); return data;}
function saveEntry(){const data=collectEntry(); const hist=JSON.parse(localStorage.getItem('pha_hist')||'[]'); hist.push(data); localStorage.setItem('pha_hist',JSON.stringify(hist)); alert(I18N[LANG].saved); renderHistory(); analyze();}
function exportHistory(){const hist=JSON.parse(localStorage.getItem('pha_hist')||'[]'); const blob=new Blob([JSON.stringify(hist,null,2)],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=`pha_history_${new Date().toISOString().slice(0,10)}.json`; a.click();}
function renderHistory(){const hist=JSON.parse(localStorage.getItem('pha_hist')||'[]').slice().reverse(); const tb=$('histBody'); tb.innerHTML='';
  hist.slice(0,200).forEach(r=>{const k=Object.entries(r.params).filter(([,v])=>v).slice(0,4).map(([k,v])=>k+':'+v).join(', ');
    const tr=document.createElement('tr'); tr.innerHTML=`<td>${new Date(r.ts).toLocaleString(LANG==='ko'?'ko-KR':'en-US')}</td><td>${r.grade}</td><td>${r.proc}</td><td>${k}</td><td><span class="badge ok">${LANG==='ko'?'ì™„ë£Œ':'Complete'}</span></td><td>${r.notes||'-'}</td>`; tb.appendChild(tr);});}
function triggerImport(type){(type==='csv'?$('importCSV'):$('importJSON')).click();}
$('importCSV').addEventListener('change', e=>{const f=e.target.files[0]; if(!f) return; const r=new FileReader(); r.onload=()=>importCSV(r.result); r.readAsText(f,'utf-8'); e.target.value='';});
$('importJSON').addEventListener('change', e=>{const f=e.target.files[0]; if(!f) return; const r=new FileReader(); r.onload=()=>{try{const arr=JSON.parse(r.result); if(Array.isArray(arr)){ const hist=JSON.parse(localStorage.getItem('pha_hist')||'[]'); hist.push(...arr); localStorage.setItem('pha_hist',JSON.stringify(hist)); renderHistory(); alert('JSON import ì™„ë£Œ'); } else alert('JSON í˜•ì‹ ì˜¤ë¥˜'); }catch(err){alert('JSON íŒŒì‹± ì‹¤íŒ¨')}}; r.readAsText(f,'utf-8'); e.target.value='';});
function importCSV(text){const lines=text.trim().split(/\r?\n/); const head=lines[0].split(',').map(s=>s.trim()); const hist=JSON.parse(localStorage.getItem('pha_hist')||'[]');
  for(let i=1;i<lines.length;i++){const cols=lines[i].split(','); if(cols.length<3) continue; const obj={ts:cols[head.indexOf('ts')]||new Date().toISOString(),grade:cols[head.indexOf('grade')]||'S1000P',proc:cols[head.indexOf('proc')]||'extrusion',params:{},notes:cols[head.indexOf('notes')]||''};
    head.forEach((h,idx)=>{if(!['ts','grade','proc','notes'].includes(h)) obj.params[h]=cols[idx]}); hist.push(obj);}
  localStorage.setItem('pha_hist',JSON.stringify(hist)); renderHistory(); alert('CSV import ì™„ë£Œ')}

/* ========= Reco editor (overrides) ========= */
function openRecoEditor(){const proc=$('process').value, grade=$('grade').value, profile=profileOf(grade), rec=getReco(profile,proc), schema=SCHEMAS[proc];
  const body=$('modalBody'); body.innerHTML=''; schema.forEach(f=>{const r=rec[f.id]||['','']; const div=document.createElement('div'); div.className='group';
    div.innerHTML=`<label>${f.ko}${f.unit?' ('+f.unit+')':''}</label><div class="row"><input id="ov_${f.id}_min" type="number" placeholder="min" value="${r[0]}"><input id="ov_${f.id}_max" type="number" placeholder="max" value="${r[1]}"></div>`; body.appendChild(div);});
  $('modal').style.display='flex';}
function closeModal(){$('modal').style.display='none'}
function saveRecoOverrides(){const proc=$('process').value, profile=profileOf($('grade').value), schema=SCHEMAS[proc]; const key=profile+'__'+proc;
  const ov=JSON.parse(localStorage.getItem('reco_overrides')||'{}'); ov[key]=ov[key]||{}; schema.forEach(f=>{const min=parseFloat($('ov_'+f.id+'_min').value); const max=parseFloat($('ov_'+f.id+'_max').value); if(!isNaN(min)&&!isNaN(max)) ov[key][f.id]=[min,max];}); localStorage.setItem('reco_overrides',JSON.stringify(ov)); closeModal(); rebuildForm();}
function resetOverridesCurrent(){const proc=$('process').value, profile=profileOf($('grade').value); const key=profile+'__'+proc; const ov=JSON.parse(localStorage.getItem('reco_overrides')||'{}'); delete ov[key]; localStorage.setItem('reco_overrides',JSON.stringify(ov)); rebuildForm(); alert('í˜„ì¬ ê³µì •ì˜ ìˆ˜ì •ê°’ì„ ì´ˆê¸°í™”í–ˆìŠµë‹ˆë‹¤.')}
function resetOverridesAll(){localStorage.removeItem('reco_overrides'); rebuildForm(); alert('ëª¨ë“  ìˆ˜ì •ê°’ ì´ˆê¸°í™” ì™„ë£Œ')}

/* ========= Calculators ========= */
function calcResidence(){const rho=parseFloat($('kpi_rho').value||'0'); const vL=parseFloat($('kpi_holdVol').value||'0'); let m=parseFloat($('kpi_holdMass').value||'0'); const rate=parseFloat($('kpi_rate').value||'0');
  if(!m && rho && vL){m=rho*(vL/1000)} if(!m||!rate){$('kpi_res_out').textContent='ì…ë ¥ ë¶€ì¡±'; return} const t_min=60*m/rate; $('kpi_res_out').textContent=`ì²´ë¥˜ì‹œê°„ â‰ˆ ${t_min.toFixed(2)} ë¶„`}
function calcCooling(){const t=parseFloat($('cool_t').value||'0'); const a=parseFloat($('cool_alpha').value||'0'); const Tm=parseFloat($('cool_Tm').value||'0'); const Tmold=parseFloat($('cool_Tmold').value||'0'); const Te=parseFloat($('cool_Te').value||'0');
  if(!t||!a||!Tm||!Tmold||!Te){$('cool_out').textContent='ì…ë ¥ ë¶€ì¡±'; return} const num=Math.max( (Tm-Tmold)/(Te-Tmold), 1.0001); const tc=( (t*t)/(Math.PI*Math.PI*a) ) * Math.log(num); $('cool_out').textContent=`ëƒ‰ê°ì‹œê°„ â‰ˆ ${tc.toFixed(1)} s`}
function calcBlownFilm(){const Q=parseFloat($('bf_Q').value||'0'); const rho=parseFloat($('bf_rho').value||'0'); const Dmm=parseFloat($('bf_D').value||'0'); const BUR=parseFloat($('bf_BUR').value||'0'); const v=parseFloat($('bf_v').value||'0'); const gap=parseFloat($('bf_gap').value||'0');
  if(!Q||!rho||!Dmm||!BUR||!v){$('bf_out').textContent='ì…ë ¥ ë¶€ì¡±'; return} const Qm3s=(Q/rho)/3600; const D=Dmm/1000; const vs=v/60; const t_m=Qm3s/(Math.PI*D*BUR*vs); const t_um=t_m*1e6;
  let txt=`í‰ê·  ë‘ê»˜ â‰ˆ ${t_um.toFixed(1)} Âµm`; if(gap){const t0=gap/2/1000; const A= Math.PI*D*(gap/1000); const v_exit=Qm3s/A; const DDR=vs/v_exit; const t2_um=(t0/(BUR*DDR))*1e6; txt += ` / ê°­-ê¸°ë°˜ ì¶”ì • â‰ˆ ${t2_um.toFixed(1)} Âµm (DDR=${DDR.toFixed(2)})`;} $('bf_out').textContent=txt}

/* ========= Materials DB ========= */
function getMatDB(){const raw=localStorage.getItem('mat_db'); if(raw) return JSON.parse(raw); return JSON.parse(JSON.stringify(MAT_DEFAULT));}
function setMatDB(db){localStorage.setItem('mat_db',JSON.stringify(db))}
function renderMat(){const db=getMatDB(); const g=$('mat_grade').value||'S1000P'; const rec=db[g]||{}; const tb=$('mat_tbody'); tb.innerHTML='';
  MAT_KEY_ORDER.forEach(([k,nm,unit])=>{const tr=document.createElement('tr'); tr.innerHTML=`<td>${nm}</td><td>${rec[k]??''}</td><td class="muted">${unit}</td>`; tb.appendChild(tr);});}
$('mat_grade').addEventListener('change',renderMat);
function importMatJSON(){const inp=$('mat_file'); inp.onchange=(e)=>{const f=e.target.files[0]; if(!f) return; const r=new FileReader(); r.onload=()=>{try{const obj=JSON.parse(r.result); const db=getMatDB(); Object.assign(db,obj); setMatDB(db); renderMat(); alert('ë¬¼ì„± DB import ì™„ë£Œ');}catch(err){alert('JSON íŒŒì‹± ì‹¤íŒ¨')}}; r.readAsText(f,'utf-8'); inp.value='';}; inp.click();}
function exportMatJSON(){const blob=new Blob([JSON.stringify(getMatDB(),null,2)],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='materials_db.json'; a.click();}
function editMat(){const db=getMatDB(); const g=$('mat_grade').value||'S1000P'; const rec=Object.assign({},db[g]||{}); const vals={}; let html='<div class="grid">';
  MAT_KEY_ORDER.forEach(([k,nm])=>{const v=rec[k]??''; html+=`<div class="group"><label>${nm}</label><input id="mat_${k}" type="number" step="any" value="${v}"></div>`}); html+='</div>';
  const body=$('modalBody'); body.innerHTML=html; $('modal').style.display='flex';
  // Replace modal buttons temporarily
  const save=window.saveRecoOverrides; const resetC=window.resetOverridesCurrent; const resetA=window.resetOverridesAll;
  window.saveRecoOverrides=function(){const rec2={}; MAT_KEY_ORDER.forEach(([k])=>{const v=$('mat_'+k).value; if(v!=='') rec2[k]=parseFloat(v)}); db[g]=rec2; setMatDB(db); renderMat(); alert('ì €ì¥ ì™„ë£Œ'); closeModal(); window.saveRecoOverrides=save; window.resetOverridesCurrent=resetC; window.resetOverridesAll=resetA;};
  window.resetOverridesCurrent=function(){db[g]={}; setMatDB(db); renderMat(); alert('ì´ˆê¸°í™” ì™„ë£Œ')};
  window.resetOverridesAll=function(){localStorage.removeItem('mat_db'); renderMat(); alert('ì „ì²´ ì´ˆê¸°í™” ì™„ë£Œ')};
}

/* ========= Tabs & events ========= */
allSel('.tab').forEach(btn=> btn.addEventListener('click', e=>{const to=e.currentTarget.dataset.tab; allSel('.tab').forEach(b=>b.classList.remove('active')); e.currentTarget.classList.add('active'); allSel('.tabpage').forEach(p=>p.classList.remove('active')); $(to).classList.add('active');}));
document.addEventListener('input', e=>{ if(e.target && e.target.id && e.target.id.startsWith('f_')) refreshParamTable(); });
$('language').addEventListener('change',e=>{LANG=e.target.value; i18nApply();});

/* ========= Init ========= */
(function init(){
  buildGradeOptions();
  $('grade').value='S1000P'; $('process').value='extrusion'; rebuildForm(); i18nApply(); renderHistory(); analyze(); renderMat();
})();
function analyze(){const hist=JSON.parse(localStorage.getItem('pha_hist')||'[]'); const n=hist.length; const t=(n? (LANG==='ko'?'ìµœê·¼ ì €ì¥: ':'Last: ')+new Date(hist[n-1].ts).toLocaleString(LANG==='ko'?'ko-KR':'en-US')+' Â· '+hist[n-1].grade+' Â· '+hist[n-1].proc : (LANG==='ko'?'ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.':'No data yet.')); $('anaText').textContent=t;}
function resetForm(){if(!confirm(I18N[LANG].resetQ)) return; $('notes').value=''; rebuildForm();}

/* ========= Flash Control Functions ========= */
function showFlashTab(index) {
  const tabs = document.querySelectorAll('.flash-tab');
  const contents = document.querySelectorAll('.flash-content');
  tabs.forEach((tab, i) => {
    if (i === index) {
      tab.classList.add('active');
    } else {
      tab.classList.remove('active');
    }
  });
  contents.forEach((content, i) => {
    if (i === index) {
      content.classList.add('active');
    } else {
      content.classList.remove('active');
    }
  });
}

function calculateFlashClampTonnage() {
  const pAvg = parseFloat($('flash-p-avg').value);
  const aProj = parseFloat($('flash-a-proj').value);
  if (isNaN(pAvg) || isNaN(aProj)) {
    alert('ëª¨ë“  ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  const tonnage = (pAvg * aProj) / 1000;
  const recommended = tonnage * 1.2;
  $('flash-clamp-result').style.display = 'block';
  $('flash-clamp-value').textContent = tonnage.toFixed(1) + ' tf';
  $('flash-clamp-recommendation').innerHTML =
    `<strong>ê¶Œì¥ í´ë¨í”„ í†¤ìˆ˜ (20% ì—¬ìœ ):</strong> ${recommended.toFixed(1)} tf<br>` +
    `í˜„ì¬ ê¸°ê³„ì˜ í´ë¨í”„ í†¤ìˆ˜ê°€ ${recommended.toFixed(1)} tf ì´ìƒì¸ì§€ í™•ì¸í•˜ì„¸ìš”.`;
}

function calculateFlashPressureLimit() {
  const fClamp = parseFloat($('flash-f-clamp').value);
  const aProj = parseFloat($('flash-a-proj-2').value);
  const safetyFactor = parseFloat($('flash-safety-factor').value);
  if (isNaN(fClamp) || isNaN(aProj) || isNaN(safetyFactor)) {
    alert('ëª¨ë“  ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  const pressureLimit = (safetyFactor * fClamp * 1000) / aProj;
  $('flash-pressure-result').style.display = 'block';
  $('flash-pressure-value').textContent = pressureLimit.toFixed(1) + ' bar';
  $('flash-pressure-recommendation').innerHTML =
    `<strong>V0 ë‹¨ê³„ì—ì„œ ì´ ê°’ì„ ì••ë ¥ ë¦¬ë°‹ìœ¼ë¡œ ì„¤ì •í•˜ì„¸ìš”.</strong><br>` +
    `ì´ ê°’ì€ í´ë¨í”„ í•œê³„ì˜ ${(safetyFactor * 100).toFixed(0)}%ë¡œ ê³„ì‚°ë˜ì–´ ìŠ¤í”„ë£¨ í”Œë˜ì‹œë¥¼ ë°©ì§€í•©ë‹ˆë‹¤.`;
}

function calculateFlashShearRate() {
  const Q = parseFloat($('flash-flow-rate').value);
  const R = parseFloat($('flash-runner-radius').value);
  if (isNaN(Q) || isNaN(R)) {
    alert('ëª¨ë“  ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  const shearRate = (4 * Q) / (Math.PI * Math.pow(R, 3));
  let recommendation = '';
  if (shearRate > 50000) {
    recommendation = 'âš ï¸ <strong>ê²½ê³ :</strong> ì „ë‹¨ë¥ ì´ ë§¤ìš° ë†’ìŠµë‹ˆë‹¤ (>50,000 sâ»Â¹). V0 ì†ë„ë¥¼ ë‚®ì¶”ê±°ë‚˜ ëŸ¬ë„ˆ ì§ê²½ì„ ì¦ëŒ€í•˜ì„¸ìš”.';
  } else if (shearRate > 20000) {
    recommendation = 'âš¡ <strong>ì£¼ì˜:</strong> ì „ë‹¨ë¥ ì´ ë†’ì€ í¸ì…ë‹ˆë‹¤ (>20,000 sâ»Â¹). ëª¨ë‹ˆí„°ë§ì´ í•„ìš”í•©ë‹ˆë‹¤.';
  } else {
    recommendation = 'âœ… <strong>ì–‘í˜¸:</strong> ì „ë‹¨ë¥ ì´ ì ì • ë²”ìœ„ì…ë‹ˆë‹¤.';
  }
  $('flash-shear-result').style.display = 'block';
  $('flash-shear-value').textContent = shearRate.toFixed(0) + ' sâ»Â¹';
  $('flash-shear-recommendation').innerHTML = recommendation;
}

function calculateFlashPackingPressure() {
  const pInjPeak = parseFloat($('flash-p-inj-peak').value);
  if (isNaN(pInjPeak)) {
    alert('ìµœëŒ€ ì‚¬ì¶œì••ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  const p1Min = pInjPeak * 0.30;
  const p1Max = pInjPeak * 0.45;
  const p2Min = pInjPeak * 0.15;
  const p2Max = pInjPeak * 0.30;
  $('flash-packing-result').style.display = 'block';
  $('flash-packing-value').innerHTML =
    `P1: ${p1Min.toFixed(0)} - ${p1Max.toFixed(0)} bar<br>` +
    `P2: ${p2Min.toFixed(0)} - ${p2Max.toFixed(0)} bar`;
  $('flash-packing-recommendation').innerHTML =
    `<strong>P1 ë‹¨ê³„:</strong> ${p1Min.toFixed(0)}-${p1Max.toFixed(0)} barë¥¼ 0.1-0.3ì´ˆê°„ ìœ ì§€í•©ë‹ˆë‹¤.<br>` +
    `<strong>P2 ë‹¨ê³„:</strong> ${p2Min.toFixed(0)}-${p2Max.toFixed(0)} barë¥¼ ê²Œì´íŠ¸ ë™ê²°ê¹Œì§€ ìœ ì§€í•©ë‹ˆë‹¤.<br>` +
    `ê²Œì´íŠ¸ ì‹œì¼ ì‹œí—˜ìœ¼ë¡œ ì •í™•í•œ ì¢…ë£Œ ì‹œì ì„ ê²°ì •í•˜ì„¸ìš”.`;
}

function clearFlashInputs(type) {
  if (type === 'clamp') {
    $('flash-p-avg').value = '';
    $('flash-a-proj').value = '';
    $('flash-clamp-result').style.display = 'none';
  } else if (type === 'pressure') {
    $('flash-f-clamp').value = '';
    $('flash-a-proj-2').value = '';
    $('flash-safety-factor').value = '0.8';
    $('flash-pressure-result').style.display = 'none';
  } else if (type === 'shear') {
    $('flash-flow-rate').value = '';
    $('flash-runner-radius').value = '';
    $('flash-shear-result').style.display = 'none';
  } else if (type === 'packing') {
    $('flash-p-inj-peak').value = '';
    $('flash-packing-result').style.display = 'none';
  }
}
</script>
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('sw.js').catch(console.error);
  });
}
</script>

<script>
(function(){
  function ensureCA1180PMat(){
    try{
      const raw=localStorage.getItem('mat_db'); const db = raw? JSON.parse(raw): {};
      if(!db['CA1180P'] || Object.keys(db['CA1180P']).length===0){
        db['CA1180P']={"density_g_cm3":1.26,"MFR_g_10min_190_2_16":7,"Tg_C":-15,"Tm_C":162,"tensile_MPa":52,"elongation_%":23,"izod_kJ_m2":63,"HDT_C":51};
        localStorage.setItem('mat_db', JSON.stringify(db));
      }
    }catch(e){console.warn(e);}
  }
  async function applyCA1180P(){
    ensureCA1180PMat();
    const url = (window.GRADE_JSON && GRADE_JSON['CA1180P']) || 'data/grades/CA1180P_talc10_wax0p3.json';
    try{
      const res = await fetch(url + '?v=' + Date.now());
      if(!res.ok) return;
      const prof = await res.json();
      const ov = JSON.parse(localStorage.getItem('reco_overrides')||'{}');
      const key = 'PHA_PLA__injection';
      ov[key]=ov[key]||{};
      const t=prof.processing?.temps_c||{};
      function setR(name,obj){ if(!obj) return; ov[key][name]=[Number(obj.min), Number(obj.max)]; }
      setR('barrel1', t.zone1); setR('barrel2', t.zone2); setR('barrel3', t.zone3||t.zone3_meter); setR('nozzle', t.nozzle);
      const mold=prof.processing?.mold_temp_c?.lowHDT; if(mold){ ov[key]['mold']=[mold.min, mold.max]; }
      const inj=prof.processing?.injection?.speed_mm_s; if(inj){ const a=Math.min(inj.stage1||inj.stage2, inj.stage2||inj.stage1); const b=Math.max(inj.stage1||inj.stage2, inj.stage2||inj.stage1); ov[key]['injSpeed']=[a,b]; }
      const hold=prof.processing?.holding_profile||[];
      if(hold[0]?.pressure_bar!=null){ const p=hold[0].pressure_bar*0.1; ov[key]['hold1P']=[p*0.9,p*1.1]; ov[key]['hold1T']=[hold[0].time_s,hold[0].time_s]; }
      if(hold[1]?.pressure_bar!=null){ const p=hold[1].pressure_bar*0.1; ov[key]['hold2P']=[p*0.9,p*1.1]; ov[key]['hold2T']=[hold[1].time_s,hold[1].time_s]; }
      const screw=prof.processing?.screw||{};
      if(screw.back_pressure_bar!=null){ ov[key]['backPressBar']=[Math.max(1,screw.back_pressure_bar-2), screw.back_pressure_bar+2]; }
      if(screw.rpm!=null){ ov[key]['screwRPM']=[Math.max(20,screw.rpm-20), screw.rpm+20]; }
      localStorage.setItem('reco_overrides', JSON.stringify(ov));
      console.log('CA1180P profile applied');
      if(window.rebuildForm) rebuildForm();
    }catch(e){ console.warn('CA1180P load failed', e); }
  }
  window.addEventListener('load', ()=>{
    const g=$('grade'); if(g){ g.value='CA1180P'; }
    const p=$('process'); if(p){ p.value='injection'; }
    applyCA1180P();
    loadProcessLog();
  });
})();

// Process Log Functions
let processLogData = [];

function loadProcessLog() {
  const saved = localStorage.getItem('processLog');
  if (saved) {
    try {
      processLogData = JSON.parse(saved);
      renderProcessLog();
    } catch (e) {
      console.warn('Failed to load process log:', e);
      processLogData = [];
    }
  }
}

function saveProcessLog() {
  localStorage.setItem('processLog', JSON.stringify(processLogData));
}

function renderProcessLog() {
  const tbody = document.getElementById('processLogBody');
  if (!tbody) return;

  if (processLogData.length === 0) {
    tbody.innerHTML = '<tr><td colspan="10" class="log-empty">ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤. "â• ë¡œê·¸ ì¶”ê°€" ë²„íŠ¼ì„ ëˆŒëŸ¬ ì²« ê¸°ë¡ì„ ì‹œì‘í•˜ì„¸ìš”.</td></tr>';
    return;
  }

  tbody.innerHTML = processLogData.map((entry, index) => `
    <tr>
      <td>
        <div class="log-timestamp">${entry.timestamp}</div>
      </td>
      <td>${createNumberInput(index, 'cylinderTemp', entry.cylinderTemp, 1)}</td>
      <td>${createNumberInput(index, 'moldTemp', entry.moldTemp, 1)}</td>
      <td>${createNumberInput(index, 'injectionSpeed', entry.injectionSpeed, 1)}</td>
      <td>${createNumberInput(index, 'injectionPressure', entry.injectionPressure, 5)}</td>
      <td>${createNumberInput(index, 'holdingPressure', entry.holdingPressure, 5)}</td>
      <td>${createNumberInput(index, 'holdingTime', entry.holdingTime, 0.1)}</td>
      <td>${createNumberInput(index, 'coolingTime', entry.coolingTime, 0.5)}</td>
      <td>
        <textarea class="log-note-input"
                  onchange="updateProcessLogNote(${index}, this.value)"
                  placeholder="í˜„ìƒ, ë¶ˆëŸ‰, íŠ¹ì´ì‚¬í•­ ê¸°ë¡...">${entry.note || ''}</textarea>
      </td>
      <td>
        <button class="btn-delete-log" onclick="deleteProcessLogEntry(${index})" title="ì‚­ì œ">ğŸ—‘ï¸</button>
      </td>
    </tr>
  `).join('');
}

function createNumberInput(entryIndex, field, value, step) {
  const val = value || 0;
  return `
    <div class="number-input-group">
      <button class="btn-increment" onclick="adjustProcessLogValue(${entryIndex}, '${field}', ${-step})">âˆ’</button>
      <input type="number"
             step="${step}"
             value="${val}"
             onchange="updateProcessLogValue(${entryIndex}, '${field}', this.value)"
             onclick="this.select()">
      <button class="btn-increment" onclick="adjustProcessLogValue(${entryIndex}, '${field}', ${step})">+</button>
    </div>
  `;
}

function addProcessLogEntry() {
  const now = new Date();
  const timestamp = now.toLocaleString('ko-KR', {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit',
    hour12: false
  });

  const newEntry = {
    timestamp: timestamp,
    cylinderTemp: 0,
    moldTemp: 0,
    injectionSpeed: 0,
    injectionPressure: 0,
    holdingPressure: 0,
    holdingTime: 0,
    coolingTime: 0,
    note: ''
  };

  processLogData.unshift(newEntry);
  saveProcessLog();
  renderProcessLog();
}

function updateProcessLogValue(index, field, value) {
  if (processLogData[index]) {
    processLogData[index][field] = parseFloat(value) || 0;
    saveProcessLog();
    // Trigger flash recommendations if modifying the first (latest) log
    if (index === 0) {
      generateFlashRecommendations();
    }
    updateCharts();
  }
}

function adjustProcessLogValue(index, field, delta) {
  if (processLogData[index]) {
    const currentValue = processLogData[index][field] || 0;
    processLogData[index][field] = Math.max(0, currentValue + delta);
    saveProcessLog();
    renderProcessLog();
    // Trigger flash recommendations if modifying the first (latest) log
    if (index === 0) {
      generateFlashRecommendations();
    }
    updateCharts();
  }
}

function updateProcessLogNote(index, value) {
  if (processLogData[index]) {
    processLogData[index].note = value;
    saveProcessLog();
  }
}

function deleteProcessLogEntry(index) {
  if (confirm('ì´ ë¡œê·¸ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
    processLogData.splice(index, 1);
    saveProcessLog();
    renderProcessLog();
  }
}

function clearProcessLog() {
  if (confirm('ëª¨ë“  ë¡œê·¸ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
    if (confirm('ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? CSVë¡œ ë°±ì—…í•˜ì…¨ë‚˜ìš”?')) {
      processLogData = [];
      saveProcessLog();
      renderProcessLog();
    }
  }
}

function exportProcessLog() {
  if (processLogData.length === 0) {
    alert('ë‚´ë³´ë‚¼ ë¡œê·¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
    return;
  }

  // CSV í—¤ë”
  const headers = [
    'ì¼ì‹œ',
    'ì‹¤ë¦°ë” ì˜¨ë„ (Â°C)',
    'ê¸ˆí˜• ì˜¨ë„ (Â°C)',
    'ì‚¬ì¶œì†ë„ (mm/s)',
    'ì‚¬ì¶œì••ë ¥ (bar)',
    'ë³´ì•• (bar)',
    'ë³´ì••ì‹œê°„ (s)',
    'ëƒ‰ê°ì‹œê°„ (s)',
    'ì œí’ˆ ë¬´ê²Œ (g)',
    'ëŸ¬ë„ˆ ë¬´ê²Œ (g)',
    'ì´ ë¬´ê²Œ (g)',
    'ë¹„ê³ /í˜„ìƒ'
  ];

  // CSV ë°ì´í„° ìƒì„±
  let csv = '\uFEFF'; // UTF-8 BOM for Excel
  csv += headers.join(',') + '\n';

  processLogData.forEach(entry => {
    const row = [
      entry.timestamp,
      entry.cylinderTemp,
      entry.moldTemp,
      entry.injectionSpeed,
      entry.injectionPressure,
      entry.holdingPressure,
      entry.holdingTime,
      entry.coolingTime,
      entry.partWeight || 0,
      entry.runnerWeight || 0,
      entry.totalWeight || 0,
      '"' + (entry.note || '').replace(/"/g, '""') + '"'
    ];
    csv += row.join(',') + '\n';
  });

  // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const link = document.createElement('a');
  const url = URL.createObjectURL(blob);
  const timestamp = new Date().toISOString().slice(0, 10);
  link.setAttribute('href', url);
  link.setAttribute('download', `PHA_ê³µì •ë¡œê·¸_${timestamp}.csv`);
  link.style.visibility = 'hidden';
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

// Updated functions to support weight fields
function addProcessLogEntry() {
  const now = new Date();
  const timestamp = now.toLocaleString('ko-KR', {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit',
    hour12: false
  });

  const newEntry = {
    timestamp: timestamp,
    cylinderTemp: 0,
    moldTemp: 0,
    injectionSpeed: 0,
    injectionPressure: 0,
    holdingPressure: 0,
    holdingTime: 0,
    coolingTime: 0,
    partWeight: 0,
    runnerWeight: 0,
    totalWeight: 0,
    note: '',
    photos: []
  };

  processLogData.unshift(newEntry);
  saveProcessLog();
  renderProcessLog();
  updateCharts();

  // Show flash recommendations area (will be populated when values are entered)
  document.getElementById('flashRecommendations').style.display = 'none';
}

function renderProcessLog() {
  const tbody = document.getElementById('processLogBody');
  if (!tbody) return;

  let displayData = filteredLogData.length > 0 ? filteredLogData : processLogData;

  if (displayData.length === 0) {
    tbody.innerHTML = '<tr><td colspan="14" class="log-empty">ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤. "â• ë¡œê·¸ ì¶”ê°€" ë²„íŠ¼ì„ ëˆŒëŸ¬ ì²« ê¸°ë¡ì„ ì‹œì‘í•˜ì„¸ìš”.</td></tr>';
    return;
  }

  tbody.innerHTML = displayData.map((entry, index) => {
    const realIndex = processLogData.indexOf(entry);
    return `
    <tr>
      <td><div class="log-timestamp">${entry.timestamp}</div></td>
      <td>${createNumberInput(realIndex, 'cylinderTemp', entry.cylinderTemp, 1)}</td>
      <td>${createNumberInput(realIndex, 'moldTemp', entry.moldTemp, 1)}</td>
      <td>${createNumberInput(realIndex, 'injectionSpeed', entry.injectionSpeed, 1)}</td>
      <td>${createNumberInput(realIndex, 'injectionPressure', entry.injectionPressure, 5)}</td>
      <td>${createNumberInput(realIndex, 'holdingPressure', entry.holdingPressure, 5)}</td>
      <td>${createNumberInput(realIndex, 'holdingTime', entry.holdingTime, 0.1)}</td>
      <td>${createNumberInput(realIndex, 'coolingTime', entry.coolingTime, 0.5)}</td>
      <td>${createNumberInput(realIndex, 'partWeight', entry.partWeight, 0.01)}</td>
      <td>${createNumberInput(realIndex, 'runnerWeight', entry.runnerWeight, 0.01)}</td>
      <td>${createNumberInput(realIndex, 'totalWeight', entry.totalWeight, 0.01)}</td>
      <td>
        <textarea class="log-note-input"
                  onchange="updateProcessLogNote(${realIndex}, this.value)"
                  placeholder="í˜„ìƒ, ë¶ˆëŸ‰, íŠ¹ì´ì‚¬í•­ ê¸°ë¡...">${entry.note || ''}</textarea>
      </td>
      <td>
        <button class="btn-template" style="font-size:11px;padding:4px 8px" onclick="attachPhoto(${realIndex})">ğŸ“· ì¶”ê°€</button>
        ${(entry.photos && entry.photos.length > 0) ? `<div style="font-size:11px;color:#6b7280;margin-top:4px">${entry.photos.length}ì¥</div>` : ''}
      </td>
      <td>
        <button class="btn-delete-log" onclick="deleteProcessLogEntry(${realIndex})" title="ì‚­ì œ">ğŸ—‘ï¸</button>
      </td>
    </tr>
  `}).join('');
}

// Search and Filter Functions
let filteredLogData = [];

function filterProcessLog() {
  const keyword = document.getElementById('filterKeyword').value.toLowerCase();
  const dateFrom = document.getElementById('filterDateFrom').value;
  const dateTo = document.getElementById('filterDateTo').value;

  filteredLogData = processLogData.filter(entry => {
    // Keyword filter
    if (keyword && !entry.note.toLowerCase().includes(keyword)) {
      return false;
    }

    // Date filter
    if (dateFrom || dateTo) {
      const entryDate = new Date(entry.timestamp).toISOString().slice(0, 10);
      if (dateFrom && entryDate < dateFrom) return false;
      if (dateTo && entryDate > dateTo) return false;
    }

    return true;
  });

  renderProcessLog();
}

function clearFilter() {
  document.getElementById('filterKeyword').value = '';
  document.getElementById('filterDateFrom').value = '';
  document.getElementById('filterDateTo').value = '';
  filteredLogData = [];
  renderProcessLog();
}

// Template Management Functions
let processTemplates = [];

function loadTemplatesFromStorage() {
  const saved = localStorage.getItem('processTemplates');
  if (saved) {
    try {
      processTemplates = JSON.parse(saved);
    } catch (e) {
      processTemplates = [];
    }
  }
}

function saveTemplatesToStorage() {
  localStorage.setItem('processTemplates', JSON.stringify(processTemplates));
}

function saveTemplate() {
  const templateName = prompt('í…œí”Œë¦¿ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:');
  if (!templateName) return;

  if (processLogData.length === 0) {
    alert('ì €ì¥í•  ë¡œê·¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
    return;
  }

  const latestEntry = processLogData[0];
  const template = {
    name: templateName,
    cylinderTemp: latestEntry.cylinderTemp,
    moldTemp: latestEntry.moldTemp,
    injectionSpeed: latestEntry.injectionSpeed,
    injectionPressure: latestEntry.injectionPressure,
    holdingPressure: latestEntry.holdingPressure,
    holdingTime: latestEntry.holdingTime,
    coolingTime: latestEntry.coolingTime,
    savedAt: new Date().toLocaleString('ko-KR')
  };

  processTemplates.push(template);
  saveTemplatesToStorage();
  alert(`í…œí”Œë¦¿ "${templateName}"ì´(ê°€) ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
}

function loadTemplate() {
  loadTemplatesFromStorage();

  if (processTemplates.length === 0) {
    alert('ì €ì¥ëœ í…œí”Œë¦¿ì´ ì—†ìŠµë‹ˆë‹¤.');
    return;
  }

  const options = processTemplates.map((t, i) => `${i + 1}. ${t.name} (${t.savedAt})`).join('\n');
  const selection = prompt(`ë¶ˆëŸ¬ì˜¬ í…œí”Œë¦¿ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:\n\n${options}`);

  if (!selection) return;

  const index = parseInt(selection) - 1;
  if (index >= 0 && index < processTemplates.length) {
    const template = processTemplates[index];
    const newEntry = {
      timestamp: new Date().toLocaleString('ko-KR', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: false
      }),
      cylinderTemp: template.cylinderTemp,
      moldTemp: template.moldTemp,
      injectionSpeed: template.injectionSpeed,
      injectionPressure: template.injectionPressure,
      holdingPressure: template.holdingPressure,
      holdingTime: template.holdingTime,
      coolingTime: template.coolingTime,
      partWeight: 0,
      runnerWeight: 0,
      totalWeight: 0,
      note: `í…œí”Œë¦¿ "${template.name}" ì ìš©`,
      photos: []
    };

    processLogData.unshift(newEntry);
    saveProcessLog();
    renderProcessLog();
    alert(`í…œí”Œë¦¿ "${template.name}"ì´(ê°€) ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.`);
  } else {
    alert('ì˜¬ë°”ë¥¸ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
  }
}

function manageTemplates() {
  loadTemplatesFromStorage();

  if (processTemplates.length === 0) {
    alert('ì €ì¥ëœ í…œí”Œë¦¿ì´ ì—†ìŠµë‹ˆë‹¤.');
    return;
  }

  const options = processTemplates.map((t, i) => `${i + 1}. ${t.name} (${t.savedAt})`).join('\n');
  const selection = prompt(`ì‚­ì œí•  í…œí”Œë¦¿ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì·¨ì†Œ: ë¹ˆì¹¸):\n\n${options}`);

  if (!selection) return;

  const index = parseInt(selection) - 1;
  if (index >= 0 && index < processTemplates.length) {
    const templateName = processTemplates[index].name;
    if (confirm(`"${templateName}" í…œí”Œë¦¿ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
      processTemplates.splice(index, 1);
      saveTemplatesToStorage();
      alert('í…œí”Œë¦¿ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
  }
}

// Weight Calculation Functions
function calculateShotWeight() {
  const partWeight = parseFloat(document.getElementById('partWeight').value) || 0;
  const runnerWeight = parseFloat(document.getElementById('runnerWeight').value) || 0;
  const cavityCount = parseInt(document.getElementById('cavityCount').value) || 36;
  const density = parseFloat(document.getElementById('materialDensity').value) || 1.25;

  const totalWeight = (partWeight * cavityCount) + runnerWeight;
  const volume = totalWeight / density;

  document.getElementById('totalShotWeight').textContent = totalWeight.toFixed(2);
  document.getElementById('shotVolume').textContent = volume.toFixed(2);
  document.getElementById('shotWeightResult').style.display = 'block';

  // Trigger flash reduction recommendations if we have log data
  if (processLogData.length > 0) {
    generateFlashRecommendations();
  }
}

function applyWeightToLog() {
  if (processLogData.length === 0) {
    alert('ë¨¼ì € ë¡œê·¸ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”.');
    return;
  }

  const partWeight = parseFloat(document.getElementById('partWeight').value) || 0;
  const runnerWeight = parseFloat(document.getElementById('runnerWeight').value) || 0;
  const cavityCount = parseInt(document.getElementById('cavityCount').value) || 36;
  const totalWeight = (partWeight * cavityCount) + runnerWeight;

  // Apply to the latest log (index 0)
  processLogData[0].partWeight = partWeight;
  processLogData[0].runnerWeight = runnerWeight;
  processLogData[0].totalWeight = totalWeight;

  saveProcessLog();
  renderProcessLog();
  generateFlashRecommendations();
  updateCharts();

  alert('ë¬´ê²Œ ë°ì´í„°ê°€ ìµœì‹  ë¡œê·¸ì— ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!');
}

function loadDensityFromGrade() {
  // PHA density database
  const densityDB = {
    'CA1180P': 1.25,
    'S1000P': 1.24,
    'A1000P': 1.23,
    'P3HB': 1.25,
    'P3HB4HB': 1.22,
    'PHB': 1.26,
    'default': 1.25
  };

  const gradeSelect = document.getElementById('grade');
  let density = densityDB.default;

  if (gradeSelect && gradeSelect.value) {
    const grade = gradeSelect.value;
    density = densityDB[grade] || densityDB.default;
  }

  document.getElementById('materialDensity').value = density;
  calculateShotWeight();
}

// Flash Reduction Recommendation Engine
function generateFlashRecommendations() {
  if (processLogData.length === 0) return;

  const latest = processLogData[0];
  const recommendations = [];

  // Analyze conditions and generate recommendations
  if (latest.injectionPressure > 900) {
    recommendations.push({
      type: 'warning',
      title: 'ì‚¬ì¶œì••ë ¥ ê³¼ë‹¤',
      message: `í˜„ì¬ ì‚¬ì¶œì••ë ¥ì´ ${latest.injectionPressure} barë¡œ ë†’ìŠµë‹ˆë‹¤.`,
      solution: `ì‚¬ì¶œì••ë ¥ì„ ${(latest.injectionPressure - 50).toFixed(0)} barë¡œ ê°ì†Œì‹œí‚¤ì„¸ìš”. (ì•½ -50 bar)`
    });
  }

  if (latest.cylinderTemp > 185) {
    recommendations.push({
      type: 'caution',
      title: 'ì‹¤ë¦°ë” ì˜¨ë„ ê³¼ë‹¤',
      message: `í˜„ì¬ ì‹¤ë¦°ë” ì˜¨ë„ê°€ ${latest.cylinderTemp}Â°Cë¡œ ë†’ìŠµë‹ˆë‹¤.`,
      solution: `ì‹¤ë¦°ë” ì˜¨ë„ë¥¼ ${(latest.cylinderTemp - 5).toFixed(0)}Â°Cë¡œ ê°ì†Œì‹œí‚¤ì„¸ìš”. (ì•½ -5Â°C, ì ë„ ì¦ê°€ë¡œ í”Œë˜ì‹œ ê°ì†Œ)`
    });
  }

  if (latest.injectionSpeed > 180) {
    recommendations.push({
      type: 'caution',
      title: 'ì‚¬ì¶œì†ë„ ê³¼ë‹¤',
      message: `í˜„ì¬ ì‚¬ì¶œì†ë„ê°€ ${latest.injectionSpeed} mm/së¡œ ë†’ìŠµë‹ˆë‹¤.`,
      solution: `ì‚¬ì¶œì†ë„ë¥¼ ${(latest.injectionSpeed - 20).toFixed(0)} mm/së¡œ ê°ì†Œì‹œí‚¤ì„¸ìš”. (ì•½ -20 mm/s, í”¼í¬ ì••ë ¥ ê°ì†Œ)`
    });
  }

  if (latest.holdingPressure > 700) {
    recommendations.push({
      type: 'caution',
      title: 'ë³´ì•• ê³¼ë‹¤',
      message: `í˜„ì¬ ë³´ì••ì´ ${latest.holdingPressure} barë¡œ ë†’ìŠµë‹ˆë‹¤.`,
      solution: `ë³´ì••ì„ ${(latest.holdingPressure - 50).toFixed(0)} barë¡œ ê°ì†Œì‹œí‚¤ì„¸ìš”. (ì•½ -50 bar)`
    });
  }

  if (latest.coolingTime < 12) {
    recommendations.push({
      type: 'normal',
      title: 'ëƒ‰ê°ì‹œê°„ ë¶€ì¡±',
      message: `í˜„ì¬ ëƒ‰ê°ì‹œê°„ì´ ${latest.coolingTime}ì´ˆë¡œ ì§§ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`,
      solution: `ëƒ‰ê°ì‹œê°„ì„ ${(latest.coolingTime + 2).toFixed(1)}ì´ˆë¡œ ì¦ê°€ì‹œì¼œ ì„±í˜• ì•ˆì •ì„±ì„ ë†’ì´ì„¸ìš”. (ì•½ +2s)`
    });
  }

  // Display recommendations
  if (recommendations.length > 0) {
    const html = recommendations.map(rec => `
      <div class="recommendation-item ${rec.type}">
        <h5 style="margin:0 0 8px 0;color:#1e3c72">${rec.title}</h5>
        <p style="margin:0 0 8px 0;font-size:14px">${rec.message}</p>
        <p style="margin:0;font-weight:bold;color:#059669">ğŸ’¡ ${rec.solution}</p>
      </div>
    `).join('');

    document.getElementById('recommendationContent').innerHTML = html;
    document.getElementById('flashRecommendations').style.display = 'block';
  } else {
    document.getElementById('recommendationContent').innerHTML = `
      <div class="recommendation-item normal">
        <h5 style="margin:0 0 8px 0;color:#1e3c72">âœ… ê³µì • ì¡°ê±´ ì–‘í˜¸</h5>
        <p style="margin:0;font-size:14px">í˜„ì¬ ê³µì • ì¡°ê±´ì€ í”Œë˜ì‹œ ë°œìƒ ìœ„í—˜ì´ ë‚®ì€ ë²”ìœ„ì— ìˆìŠµë‹ˆë‹¤. ê³„ì† ëª¨ë‹ˆí„°ë§í•˜ì„¸ìš”.</p>
      </div>
    `;
    document.getElementById('flashRecommendations').style.display = 'block';
  }
}

// Photo Attachment (using IndexedDB)
let photoDB;

function initPhotoStorage() {
  const request = indexedDB.open('ProcessLogPhotos', 1);

  request.onerror = () => {
    console.warn('IndexedDB not available, photo storage disabled');
  };

  request.onsuccess = (event) => {
    photoDB = event.target.result;
  };

  request.onupgradeneeded = (event) => {
    const db = event.target.result;
    if (!db.objectStoreNames.contains('photos')) {
      db.createObjectStore('photos', { keyPath: 'id', autoIncrement: true });
    }
  };
}

function attachPhoto(logIndex) {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = 'image/*';
  input.multiple = true;

  input.onchange = (e) => {
    const files = Array.from(e.target.files);
    if (files.length === 0) return;

    files.forEach(file => {
      if (file.size > 5 * 1024 * 1024) {
        alert(`íŒŒì¼ ${file.name}ì´(ê°€) ë„ˆë¬´ í½ë‹ˆë‹¤ (ìµœëŒ€ 5MB)`);
        return;
      }

      const reader = new FileReader();
      reader.onload = (event) => {
        const photoData = {
          logIndex: logIndex,
          data: event.target.result,
          name: file.name,
          timestamp: new Date().toISOString()
        };

        if (photoDB) {
          const transaction = photoDB.transaction(['photos'], 'readwrite');
          const store = transaction.objectStore('photos');
          store.add(photoData);

          transaction.oncomplete = () => {
            if (!processLogData[logIndex].photos) {
              processLogData[logIndex].photos = [];
            }
            processLogData[logIndex].photos.push(photoData.name);
            saveProcessLog();
            renderProcessLog();
            alert('ì‚¬ì§„ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
          };
        }
      };

      reader.readAsDataURL(file);
    });
  };

  input.click();
}

// Chart Visualization
let processChart;
let currentChartType = 'temp';

function initChart() {
  const ctx = document.getElementById('processChart');
  if (!ctx) return;

  processChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: [],
      datasets: []
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          position: 'top'
        },
        tooltip: {
          mode: 'index',
          intersect: false
        }
      },
      scales: {
        x: {
          display: true,
          title: {
            display: true,
            text: 'ì‹œê°„'
          }
        },
        y: {
          display: true,
          title: {
            display: true,
            text: 'ê°’'
          }
        }
      }
    }
  });

  updateCharts();
}

function showChart(type) {
  currentChartType = type;

  // Update button states
  document.querySelectorAll('.chart-toggle-btn').forEach(btn => btn.classList.remove('active'));
  document.getElementById(`chartBtn${type.charAt(0).toUpperCase() + type.slice(1)}`).classList.add('active');

  updateCharts();
}

function updateCharts() {
  if (!processChart) return;

  const data = processLogData.slice(0, 20).reverse();
  const labels = data.map(entry => {
    const date = new Date(entry.timestamp);
    return date.toLocaleDateString('ko-KR', { month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' });
  });

  let datasets = [];

  switch (currentChartType) {
    case 'temp':
      datasets = [
        {
          label: 'ì‹¤ë¦°ë” ì˜¨ë„ (Â°C)',
          data: data.map(e => e.cylinderTemp),
          borderColor: '#ef4444',
          backgroundColor: 'rgba(239, 68, 68, 0.1)',
          tension: 0.3
        },
        {
          label: 'ê¸ˆí˜• ì˜¨ë„ (Â°C)',
          data: data.map(e => e.moldTemp),
          borderColor: '#3b82f6',
          backgroundColor: 'rgba(59, 130, 246, 0.1)',
          tension: 0.3
        }
      ];
      break;

    case 'pressure':
      datasets = [
        {
          label: 'ì‚¬ì¶œì••ë ¥ (bar)',
          data: data.map(e => e.injectionPressure),
          borderColor: '#8b5cf6',
          backgroundColor: 'rgba(139, 92, 246, 0.1)',
          tension: 0.3
        },
        {
          label: 'ë³´ì•• (bar)',
          data: data.map(e => e.holdingPressure),
          borderColor: '#10b981',
          backgroundColor: 'rgba(16, 185, 129, 0.1)',
          tension: 0.3
        }
      ];
      break;

    case 'weight':
      datasets = [
        {
          label: 'ì œí’ˆ ë¬´ê²Œ (g)',
          data: data.map(e => e.partWeight || 0),
          borderColor: '#f59e0b',
          backgroundColor: 'rgba(245, 158, 11, 0.1)',
          tension: 0.3
        },
        {
          label: 'ëŸ¬ë„ˆ ë¬´ê²Œ (g)',
          data: data.map(e => e.runnerWeight || 0),
          borderColor: '#6366f1',
          backgroundColor: 'rgba(99, 102, 241, 0.1)',
          tension: 0.3
        },
        {
          label: 'ì´ ë¬´ê²Œ (g)',
          data: data.map(e => e.totalWeight || 0),
          borderColor: '#ec4899',
          backgroundColor: 'rgba(236, 72, 153, 0.1)',
          tension: 0.3
        }
      ];
      break;

    case 'time':
      datasets = [
        {
          label: 'ë³´ì••ì‹œê°„ (s)',
          data: data.map(e => e.holdingTime),
          borderColor: '#14b8a6',
          backgroundColor: 'rgba(20, 184, 166, 0.1)',
          tension: 0.3
        },
        {
          label: 'ëƒ‰ê°ì‹œê°„ (s)',
          data: data.map(e => e.coolingTime),
          borderColor: '#0ea5e9',
          backgroundColor: 'rgba(14, 165, 233, 0.1)',
          tension: 0.3
        }
      ];
      break;
  }

  processChart.data.labels = labels;
  processChart.data.datasets = datasets;
  processChart.update();
}

// Initialize on load
window.addEventListener('load', () => {
  loadTemplatesFromStorage();
  initPhotoStorage();
  if (typeof Chart !== 'undefined') {
    initChart();
  }
});
</script>

<!-- Additional scripts for dynamic material loading, troubleshooting, and photo gallery -->
<!-- See custom.js for implementation -->

  <!-- Load external script containing material/troubleshooting/photo logic -->
  <script src="custom.js"></script>

</body>
</html>
